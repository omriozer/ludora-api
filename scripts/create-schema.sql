-- Ludora Database Schema - Consolidated Version
-- Generated: Mon Nov 24 12:46:41 +07 2025
-- Source: development database ludora_development
--
-- This schema represents the consolidated structure after all migrations
-- have been applied. It replaces the original create-schema.sql and the
-- complex migration chain with a single, clean schema definition.
--
-- DO NOT EDIT THIS FILE MANUALLY
-- This file is generated by the consolidation process

-- Ensure we're using the correct database
\connect ludora_development;
-- Started on 2025-11-24 12:46:41 +07

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;

--
-- TOC entry 4474 (class 0 OID 0)
-- Dependencies: 6
-- Name: SCHEMA public; Type: COMMENT; Schema: -; Owner: -
--

COMMENT ON SCHEMA public IS '';


--
-- TOC entry 2 (class 3079 OID 47054)
-- Name: uuid-ossp; Type: EXTENSION; Schema: -; Owner: -
--

CREATE EXTENSION IF NOT EXISTS "uuid-ossp" WITH SCHEMA public;


--
-- TOC entry 4475 (class 0 OID 0)
-- Dependencies: 2
-- Name: EXTENSION "uuid-ossp"; Type: COMMENT; Schema: -; Owner: -
--

COMMENT ON EXTENSION "uuid-ossp" IS 'generate universally unique identifiers (UUIDs)';


--
-- TOC entry 1059 (class 1247 OID 47186)
-- Name: enum_configuration_value_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_configuration_value_type AS ENUM (
    'string',
    'number',
    'boolean',
    'object',
    'array'
);


--
-- TOC entry 1029 (class 1247 OID 46843)
-- Name: enum_edu_content_element_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_edu_content_element_type AS ENUM (
    'playing_card_complete',
    'playing_card_bg',
    'data'
);


--
-- TOC entry 1035 (class 1247 OID 46858)
-- Name: enum_edu_content_use_use_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_edu_content_use_use_type AS ENUM (
    'single_content',
    'pair',
    'group',
    'mixed_edu_contents'
);


--
-- TOC entry 1011 (class 1247 OID 46609)
-- Name: enum_game_content_link_link_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_game_content_link_link_type AS ENUM (
    'content',
    'relation'
);


--
-- TOC entry 1008 (class 1247 OID 46579)
-- Name: enum_game_content_relation_items_role; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_game_content_relation_items_role AS ENUM (
    'source',
    'target',
    'question',
    'answer',
    'distractor',
    'pair_a',
    'pair_b'
);


--
-- TOC entry 1005 (class 1247 OID 46552)
-- Name: enum_game_content_relation_relation_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_game_content_relation_relation_type AS ENUM (
    'translation',
    'antonym',
    'synonym',
    'similar_meaning',
    'question_answer',
    'answer_question',
    'distractor'
);


--
-- TOC entry 891 (class 1247 OID 45887)
-- Name: enum_game_content_rule_instance_rule_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_game_content_rule_instance_rule_type AS ENUM (
    'attribute_based',
    'content_list',
    'complex_attribute',
    'relation_based'
);


--
-- TOC entry 894 (class 1247 OID 45896)
-- Name: enum_game_content_rule_rule_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_game_content_rule_rule_type AS ENUM (
    'attribute_based',
    'content_list',
    'complex_attribute',
    'relation_based'
);


--
-- TOC entry 897 (class 1247 OID 45906)
-- Name: enum_memory_pairing_rules_rule_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_memory_pairing_rules_rule_type AS ENUM (
    'manual_pairs',
    'attribute_match',
    'content_type_match',
    'semantic_match'
);


--
-- TOC entry 900 (class 1247 OID 45916)
-- Name: enum_product_marketing_video_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_product_marketing_video_type AS ENUM (
    'youtube',
    'uploaded'
);


--
-- TOC entry 1047 (class 1247 OID 46960)
-- Name: enum_settings_students_access; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_settings_students_access AS ENUM (
    'invite_only',
    'authed_only',
    'all'
);


--
-- TOC entry 903 (class 1247 OID 45922)
-- Name: enum_subscription_status; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_subscription_status AS ENUM (
    'pending',
    'active',
    'cancelled',
    'expired',
    'failed'
);


--
-- TOC entry 906 (class 1247 OID 45934)
-- Name: enum_subscriptionhistory_action_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_subscriptionhistory_action_type AS ENUM (
    'started',
    'upgraded',
    'downgraded',
    'cancelled',
    'renewed',
    'expired',
    'failed'
);


--
-- TOC entry 909 (class 1247 OID 45950)
-- Name: enum_transaction_environment; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_transaction_environment AS ENUM (
    'production',
    'staging',
    'development'
);


--
-- TOC entry 912 (class 1247 OID 45958)
-- Name: enum_transaction_final_environment; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_transaction_final_environment AS ENUM (
    'production',
    'staging'
);


--
-- TOC entry 915 (class 1247 OID 45964)
-- Name: enum_transaction_final_payment_status; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_transaction_final_payment_status AS ENUM (
    'pending',
    'completed',
    'failed',
    'cancelled',
    'refunded'
);


--
-- TOC entry 918 (class 1247 OID 45976)
-- Name: enum_transaction_payment_status; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_transaction_payment_status AS ENUM (
    'pending',
    'completed',
    'failed',
    'cancelled',
    'refunded'
);


--
-- TOC entry 921 (class 1247 OID 45988)
-- Name: enum_transaction_temp_environment; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_transaction_temp_environment AS ENUM (
    'production',
    'staging'
);


--
-- TOC entry 924 (class 1247 OID 45994)
-- Name: enum_transaction_temp_payment_status; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_transaction_temp_payment_status AS ENUM (
    'pending',
    'completed',
    'failed',
    'cancelled',
    'refunded'
);


SET default_tablespace = '';

SET default_table_access_method = heap;

--
-- TOC entry 217 (class 1259 OID 46005)
-- Name: SequelizeMeta; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public."SequelizeMeta" (
    name character varying(255) NOT NULL
);


--
-- TOC entry 218 (class 1259 OID 46008)
-- Name: audiofile; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.audiofile (
    id character varying(255) NOT NULL,
    name character varying(255),
    file_url character varying(500),
    duration numeric,
    volume numeric,
    file_size numeric,
    file_type character varying(255),
    is_default_for jsonb,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    has_file boolean DEFAULT false NOT NULL,
    file_filename character varying(255)
);


--
-- TOC entry 4476 (class 0 OID 0)
-- Dependencies: 218
-- Name: COLUMN audiofile.file_url; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.audiofile.file_url IS 'DEPRECATED: Use has_file and file_filename instead. Kept for backward compatibility.';


--
-- TOC entry 4477 (class 0 OID 0)
-- Dependencies: 218
-- Name: COLUMN audiofile.has_file; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.audiofile.has_file IS 'Clear boolean indicator for audio file existence';


--
-- TOC entry 4478 (class 0 OID 0)
-- Dependencies: 218
-- Name: COLUMN audiofile.file_filename; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.audiofile.file_filename IS 'Standardized audio filename storage (replaces file_url)';


--
-- TOC entry 219 (class 1259 OID 46015)
-- Name: category; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.category (
    id character varying(255) NOT NULL,
    name character varying(255),
    is_default boolean,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- TOC entry 220 (class 1259 OID 46022)
-- Name: classroom; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.classroom (
    id character varying(255) NOT NULL,
    name character varying(255),
    grade_level character varying(255),
    year character varying(255),
    teacher_id character varying(255),
    description character varying(255),
    is_active boolean,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    school_id character varying(255)
);


--
-- TOC entry 4479 (class 0 OID 0)
-- Dependencies: 220
-- Name: COLUMN classroom.school_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.classroom.school_id IS 'School that this classroom belongs to';


--
-- TOC entry 221 (class 1259 OID 46029)
-- Name: classroommembership; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.classroommembership (
    id character varying(255) NOT NULL,
    classroom_id character varying(255),
    student_user_id character varying(255),
    teacher_id character varying(255),
    joined_at character varying(255),
    status character varying(255),
    notes character varying(255),
    student_display_name character varying(255),
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- TOC entry 249 (class 1259 OID 46772)
-- Name: content_topic; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.content_topic (
    id character varying(255) NOT NULL,
    name character varying(255) NOT NULL,
    description text,
    is_active boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL
);


--
-- TOC entry 4480 (class 0 OID 0)
-- Dependencies: 249
-- Name: COLUMN content_topic.id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.content_topic.id IS 'Primary key for content topic';


--
-- TOC entry 4481 (class 0 OID 0)
-- Dependencies: 249
-- Name: COLUMN content_topic.name; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.content_topic.name IS 'Unique name of the content topic';


--
-- TOC entry 4482 (class 0 OID 0)
-- Dependencies: 249
-- Name: COLUMN content_topic.description; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.content_topic.description IS 'Optional description of the content topic';


--
-- TOC entry 4483 (class 0 OID 0)
-- Dependencies: 249
-- Name: COLUMN content_topic.is_active; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.content_topic.is_active IS 'Whether this content topic is active';


--
-- TOC entry 222 (class 1259 OID 46048)
-- Name: coupon; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.coupon (
    id character varying(255) NOT NULL,
    code character varying(255),
    name character varying(255),
    description character varying(255),
    discount_type character varying(255),
    discount_value numeric(10,2),
    minimum_amount numeric(10,2),
    usage_limit integer,
    usage_count integer DEFAULT 0,
    valid_until timestamp with time zone,
    is_visible boolean DEFAULT true,
    is_admin_only boolean DEFAULT false,
    allow_stacking boolean DEFAULT false,
    stackable_with jsonb,
    applicable_categories jsonb,
    applicable_workshops jsonb,
    workshop_types jsonb,
    is_active boolean DEFAULT true,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    targeting_type character varying(255) DEFAULT 'general'::character varying,
    target_product_types jsonb DEFAULT '"[]"'::jsonb,
    target_product_ids jsonb DEFAULT '"[]"'::jsonb,
    visibility character varying(255) DEFAULT 'secret'::character varying,
    user_segments jsonb DEFAULT '"[]"'::jsonb,
    priority_level integer DEFAULT 5,
    max_discount_cap numeric(10,2),
    minimum_quantity integer DEFAULT 1,
    code_pattern character varying(255),
    auto_generated boolean DEFAULT false
);


--
-- TOC entry 223 (class 1259 OID 46068)
-- Name: course; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.course (
    id character varying(255) NOT NULL,
    title character varying(255) NOT NULL,
    description text,
    short_description text,
    category character varying(255),
    price numeric DEFAULT '0'::numeric NOT NULL,
    is_published boolean DEFAULT false NOT NULL,
    image_url character varying(255),
    image_is_private boolean DEFAULT false,
    tags jsonb,
    target_audience character varying(255),
    difficulty_level character varying(255),
    access_days integer,
    is_lifetime_access boolean DEFAULT false,
    course_modules jsonb DEFAULT '[]'::jsonb,
    total_duration_minutes integer,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    has_video boolean DEFAULT false NOT NULL,
    video_filename character varying(255)
);


--
-- TOC entry 4484 (class 0 OID 0)
-- Dependencies: 223
-- Name: TABLE course; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.course IS 'Educational courses available in the platform';


--
-- TOC entry 4485 (class 0 OID 0)
-- Dependencies: 223
-- Name: COLUMN course.has_video; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.course.has_video IS 'Clear boolean indicator for content video existence';


--
-- TOC entry 4486 (class 0 OID 0)
-- Dependencies: 223
-- Name: COLUMN course.video_filename; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.course.video_filename IS 'Standardized video filename storage for course content';


--
-- TOC entry 224 (class 1259 OID 46078)
-- Name: curriculum; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.curriculum (
    id character varying(255) NOT NULL,
    subject character varying(255) NOT NULL,
    grade integer NOT NULL,
    teacher_user_id character varying(255),
    class_id character varying(255),
    is_active boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    original_curriculum_id character varying(255),
    grade_from integer,
    grade_to integer,
    is_grade_range boolean DEFAULT false NOT NULL
);


--
-- TOC entry 4487 (class 0 OID 0)
-- Dependencies: 224
-- Name: COLUMN curriculum.subject; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.curriculum.subject IS 'Study subject from STUDY_SUBJECTS constant';


--
-- TOC entry 4488 (class 0 OID 0)
-- Dependencies: 224
-- Name: COLUMN curriculum.grade; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.curriculum.grade IS 'Grade level 1-12';


--
-- TOC entry 4489 (class 0 OID 0)
-- Dependencies: 224
-- Name: COLUMN curriculum.teacher_user_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.curriculum.teacher_user_id IS 'null = system default curriculum';


--
-- TOC entry 4490 (class 0 OID 0)
-- Dependencies: 224
-- Name: COLUMN curriculum.class_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.curriculum.class_id IS 'null = system default curriculum';


--
-- TOC entry 4491 (class 0 OID 0)
-- Dependencies: 224
-- Name: COLUMN curriculum.original_curriculum_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.curriculum.original_curriculum_id IS 'ID of the system curriculum this was copied from (null for system curricula)';


--
-- TOC entry 4492 (class 0 OID 0)
-- Dependencies: 224
-- Name: COLUMN curriculum.grade_from; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.curriculum.grade_from IS 'Starting grade for range (1-12)';


--
-- TOC entry 4493 (class 0 OID 0)
-- Dependencies: 224
-- Name: COLUMN curriculum.grade_to; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.curriculum.grade_to IS 'Ending grade for range (1-12)';


--
-- TOC entry 4494 (class 0 OID 0)
-- Dependencies: 224
-- Name: COLUMN curriculum.is_grade_range; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.curriculum.is_grade_range IS 'Whether this curriculum applies to a grade range or single grade';


--
-- TOC entry 225 (class 1259 OID 46085)
-- Name: curriculum_item; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.curriculum_item (
    id character varying(255) NOT NULL,
    curriculum_id character varying(255) NOT NULL,
    study_topic character varying(255) NOT NULL,
    is_mandatory boolean DEFAULT true NOT NULL,
    mandatory_order integer,
    custom_order integer,
    description text,
    is_completed boolean DEFAULT false NOT NULL,
    completed_at timestamp with time zone,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL
);


--
-- TOC entry 4495 (class 0 OID 0)
-- Dependencies: 225
-- Name: COLUMN curriculum_item.study_topic; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.curriculum_item.study_topic IS 'Main study topic';


--
-- TOC entry 4496 (class 0 OID 0)
-- Dependencies: 225
-- Name: COLUMN curriculum_item.is_mandatory; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.curriculum_item.is_mandatory IS 'Whether this item is mandatory or optional';


--
-- TOC entry 4497 (class 0 OID 0)
-- Dependencies: 225
-- Name: COLUMN curriculum_item.mandatory_order; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.curriculum_item.mandatory_order IS 'Order for mandatory items';


--
-- TOC entry 4498 (class 0 OID 0)
-- Dependencies: 225
-- Name: COLUMN curriculum_item.custom_order; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.curriculum_item.custom_order IS 'Custom order set by teacher';


--
-- TOC entry 4499 (class 0 OID 0)
-- Dependencies: 225
-- Name: COLUMN curriculum_item.description; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.curriculum_item.description IS 'Additional description or notes';


--
-- TOC entry 4500 (class 0 OID 0)
-- Dependencies: 225
-- Name: COLUMN curriculum_item.is_completed; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.curriculum_item.is_completed IS 'Whether teacher has marked this as learned/completed';


--
-- TOC entry 4501 (class 0 OID 0)
-- Dependencies: 225
-- Name: COLUMN curriculum_item.completed_at; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.curriculum_item.completed_at IS 'When the item was marked as completed';


--
-- TOC entry 226 (class 1259 OID 46092)
-- Name: curriculum_product; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.curriculum_product (
    curriculum_item_id character varying(255) NOT NULL,
    product_id character varying(255) NOT NULL,
    created_at timestamp with time zone NOT NULL,
    id character varying(255) NOT NULL
);


--
-- TOC entry 4502 (class 0 OID 0)
-- Dependencies: 226
-- Name: COLUMN curriculum_product.id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.curriculum_product.id IS 'Primary key for curriculum-product association';


--
-- TOC entry 227 (class 1259 OID 46097)
-- Name: curriculum_product_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.curriculum_product_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- TOC entry 4503 (class 0 OID 0)
-- Dependencies: 227
-- Name: curriculum_product_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.curriculum_product_id_seq OWNED BY public.curriculum_product.id;


--
-- TOC entry 250 (class 1259 OID 46849)
-- Name: edu_content; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.edu_content (
    id character varying(255) NOT NULL,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    element_type public.enum_edu_content_element_type NOT NULL,
    content text NOT NULL,
    content_metadata jsonb DEFAULT '{}'::jsonb NOT NULL
);


--
-- TOC entry 4504 (class 0 OID 0)
-- Dependencies: 250
-- Name: COLUMN edu_content.element_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.edu_content.element_type IS 'Type of educational content element';


--
-- TOC entry 4505 (class 0 OID 0)
-- Dependencies: 250
-- Name: COLUMN edu_content.content; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.edu_content.content IS 'The actual content - image URL, text value, etc.';


--
-- TOC entry 4506 (class 0 OID 0)
-- Dependencies: 250
-- Name: COLUMN edu_content.content_metadata; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.edu_content.content_metadata IS 'Flexible metadata for content (language, difficulty, represents_data_id, etc.)';


--
-- TOC entry 251 (class 1259 OID 46865)
-- Name: edu_content_use; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.edu_content_use (
    id character varying(255) NOT NULL,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    game_id character varying(255) NOT NULL,
    use_type public.enum_edu_content_use_use_type NOT NULL,
    contents_data jsonb DEFAULT '[]'::jsonb NOT NULL,
    content_order jsonb,
    usage_metadata jsonb DEFAULT '{}'::jsonb NOT NULL
);


--
-- TOC entry 4507 (class 0 OID 0)
-- Dependencies: 251
-- Name: COLUMN edu_content_use.game_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.edu_content_use.game_id IS 'Reference to the game using this content';


--
-- TOC entry 4508 (class 0 OID 0)
-- Dependencies: 251
-- Name: COLUMN edu_content_use.use_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.edu_content_use.use_type IS 'How the content is grouped/used in the game';


--
-- TOC entry 4509 (class 0 OID 0)
-- Dependencies: 251
-- Name: COLUMN edu_content_use.contents_data; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.edu_content_use.contents_data IS 'Array of edu_content IDs in this grouping';


--
-- TOC entry 4510 (class 0 OID 0)
-- Dependencies: 251
-- Name: COLUMN edu_content_use.content_order; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.edu_content_use.content_order IS 'Optional: array defining order when sequence matters';


--
-- TOC entry 4511 (class 0 OID 0)
-- Dependencies: 251
-- Name: COLUMN edu_content_use.usage_metadata; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.edu_content_use.usage_metadata IS 'Additional metadata about how content is used';


--
-- TOC entry 246 (class 1259 OID 46668)
-- Name: emaillog; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.emaillog (
    id character varying(255) NOT NULL,
    template_id character varying(255),
    recipient_email character varying(255),
    subject character varying(255),
    content text,
    trigger_type character varying(255),
    related_product_id character varying(255),
    related_registration_id character varying(255),
    related_purchase_id character varying(255),
    status character varying(255),
    error_message character varying(255),
    scheduled_for character varying(255),
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL
);


--
-- TOC entry 4512 (class 0 OID 0)
-- Dependencies: 246
-- Name: COLUMN emaillog.template_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emaillog.template_id IS 'Reference to emailtemplate used for this email';


--
-- TOC entry 4513 (class 0 OID 0)
-- Dependencies: 246
-- Name: COLUMN emaillog.recipient_email; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emaillog.recipient_email IS 'Email address of the recipient';


--
-- TOC entry 4514 (class 0 OID 0)
-- Dependencies: 246
-- Name: COLUMN emaillog.subject; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emaillog.subject IS 'Actual email subject that was sent';


--
-- TOC entry 4515 (class 0 OID 0)
-- Dependencies: 246
-- Name: COLUMN emaillog.content; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emaillog.content IS 'Actual email content that was sent';


--
-- TOC entry 4516 (class 0 OID 0)
-- Dependencies: 246
-- Name: COLUMN emaillog.trigger_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emaillog.trigger_type IS 'Event that triggered this email (registration_confirmation, payment_confirmation, etc.)';


--
-- TOC entry 4517 (class 0 OID 0)
-- Dependencies: 246
-- Name: COLUMN emaillog.related_product_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emaillog.related_product_id IS 'Product related to this email (if applicable)';


--
-- TOC entry 4518 (class 0 OID 0)
-- Dependencies: 246
-- Name: COLUMN emaillog.related_registration_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emaillog.related_registration_id IS 'Registration related to this email (if applicable) - DEPRECATED';


--
-- TOC entry 4519 (class 0 OID 0)
-- Dependencies: 246
-- Name: COLUMN emaillog.related_purchase_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emaillog.related_purchase_id IS 'Purchase transaction related to this email';


--
-- TOC entry 4520 (class 0 OID 0)
-- Dependencies: 246
-- Name: COLUMN emaillog.status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emaillog.status IS 'Email delivery status (sent, failed, pending)';


--
-- TOC entry 4521 (class 0 OID 0)
-- Dependencies: 246
-- Name: COLUMN emaillog.error_message; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emaillog.error_message IS 'Error message if email sending failed';


--
-- TOC entry 4522 (class 0 OID 0)
-- Dependencies: 246
-- Name: COLUMN emaillog.scheduled_for; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emaillog.scheduled_for IS 'When email is scheduled to be sent (for future implementation)';


--
-- TOC entry 245 (class 1259 OID 46655)
-- Name: emailtemplate; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.emailtemplate (
    id character varying(255) NOT NULL,
    name character varying(255),
    subject character varying(255),
    html_content text,
    trigger_type character varying(255),
    trigger_hours_before numeric,
    trigger_hours_after numeric,
    target_product_types jsonb,
    target_product_ids jsonb,
    target_admin_emails jsonb,
    is_active boolean DEFAULT true,
    send_to_admins boolean DEFAULT false,
    access_expiry_days_before numeric,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL
);


--
-- TOC entry 4523 (class 0 OID 0)
-- Dependencies: 245
-- Name: COLUMN emailtemplate.name; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emailtemplate.name IS 'Human-readable template name';


--
-- TOC entry 4524 (class 0 OID 0)
-- Dependencies: 245
-- Name: COLUMN emailtemplate.subject; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emailtemplate.subject IS 'Email subject line template';


--
-- TOC entry 4525 (class 0 OID 0)
-- Dependencies: 245
-- Name: COLUMN emailtemplate.html_content; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emailtemplate.html_content IS 'HTML email body content with template variables';


--
-- TOC entry 4526 (class 0 OID 0)
-- Dependencies: 245
-- Name: COLUMN emailtemplate.trigger_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emailtemplate.trigger_type IS 'Event type that triggers this email (registration_confirmation, payment_confirmation, etc.)';


--
-- TOC entry 4527 (class 0 OID 0)
-- Dependencies: 245
-- Name: COLUMN emailtemplate.trigger_hours_before; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emailtemplate.trigger_hours_before IS 'Hours before event to trigger email';


--
-- TOC entry 4528 (class 0 OID 0)
-- Dependencies: 245
-- Name: COLUMN emailtemplate.trigger_hours_after; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emailtemplate.trigger_hours_after IS 'Hours after event to trigger email';


--
-- TOC entry 4529 (class 0 OID 0)
-- Dependencies: 245
-- Name: COLUMN emailtemplate.target_product_types; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emailtemplate.target_product_types IS 'Array of product types to target for this template';


--
-- TOC entry 4530 (class 0 OID 0)
-- Dependencies: 245
-- Name: COLUMN emailtemplate.target_product_ids; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emailtemplate.target_product_ids IS 'Array of specific product IDs to target for this template';


--
-- TOC entry 4531 (class 0 OID 0)
-- Dependencies: 245
-- Name: COLUMN emailtemplate.target_admin_emails; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emailtemplate.target_admin_emails IS 'Array of admin emails to notify';


--
-- TOC entry 4532 (class 0 OID 0)
-- Dependencies: 245
-- Name: COLUMN emailtemplate.is_active; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emailtemplate.is_active IS 'Whether this template is currently active';


--
-- TOC entry 4533 (class 0 OID 0)
-- Dependencies: 245
-- Name: COLUMN emailtemplate.send_to_admins; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emailtemplate.send_to_admins IS 'Whether to send this email to administrators';


--
-- TOC entry 4534 (class 0 OID 0)
-- Dependencies: 245
-- Name: COLUMN emailtemplate.access_expiry_days_before; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emailtemplate.access_expiry_days_before IS 'Days before access expiry to trigger email';


--
-- TOC entry 228 (class 1259 OID 46098)
-- Name: file; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.file (
    id character varying(255) NOT NULL,
    title character varying(255) NOT NULL,
    category character varying(255),
    file_name character varying(255),
    file_type character varying(255),
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    allow_preview boolean DEFAULT true NOT NULL,
    add_branding boolean DEFAULT true NOT NULL,
    branding_settings jsonb,
    is_asset_only boolean DEFAULT false NOT NULL,
    branding_template_id character varying(255),
    accessible_pages jsonb,
    watermark_template_id character varying(255),
    watermark_settings jsonb,
    target_format character varying(255),
    CONSTRAINT chk_file_target_format CHECK (((target_format)::text = ANY ((ARRAY['pdf-a4-portrait'::character varying, 'pdf-a4-landscape'::character varying, 'svg-lessonplan'::character varying, 'unknown'::character varying])::text[])))
);


--
-- TOC entry 4535 (class 0 OID 0)
-- Dependencies: 228
-- Name: TABLE file; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.file IS 'Downloadable files and resources';


--
-- TOC entry 4536 (class 0 OID 0)
-- Dependencies: 228
-- Name: COLUMN file.file_name; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.file.file_name IS 'Original filename of uploaded document (e.g., "my-document.pdf"). NULL if not uploaded yet.';


--
-- TOC entry 4537 (class 0 OID 0)
-- Dependencies: 228
-- Name: COLUMN file.branding_settings; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.file.branding_settings IS 'File-specific branding settings (positioning, styling). Content comes from SystemTemplate.';


--
-- TOC entry 4538 (class 0 OID 0)
-- Dependencies: 228
-- Name: COLUMN file.is_asset_only; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.file.is_asset_only IS 'true = asset only (not standalone product), false = can be standalone product';


--
-- TOC entry 4539 (class 0 OID 0)
-- Dependencies: 228
-- Name: COLUMN file.branding_template_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.file.branding_template_id IS 'Reference to system_templates for footer configuration';


--
-- TOC entry 4540 (class 0 OID 0)
-- Dependencies: 228
-- Name: COLUMN file.accessible_pages; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.file.accessible_pages IS 'Array of page numbers accessible in preview mode: [1,3,5,7] or null for all pages';


--
-- TOC entry 4541 (class 0 OID 0)
-- Dependencies: 228
-- Name: COLUMN file.watermark_template_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.file.watermark_template_id IS 'Reference to system_templates for watermark configuration';


--
-- TOC entry 4542 (class 0 OID 0)
-- Dependencies: 228
-- Name: COLUMN file.target_format; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.file.target_format IS 'File format orientation matching system_templates.target_format for template filtering';


--
-- TOC entry 229 (class 1259 OID 46106)
-- Name: game; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.game (
    id character varying(255) NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    game_type character varying(255),
    game_settings jsonb DEFAULT '{}'::jsonb NOT NULL,
    difficulty_level character varying(255),
    content_query jsonb DEFAULT '{}'::jsonb,
    digital boolean DEFAULT true NOT NULL
);


--
-- TOC entry 4543 (class 0 OID 0)
-- Dependencies: 229
-- Name: TABLE game; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.game IS 'Educational games and interactive content';


--
-- TOC entry 4544 (class 0 OID 0)
-- Dependencies: 229
-- Name: COLUMN game.digital; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.game.digital IS 'true = דיגיטלי, false = גרסה להדפסה';


--
-- TOC entry 252 (class 1259 OID 46893)
-- Name: gamelobby; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.gamelobby (
    id character varying(255) NOT NULL,
    game_id character varying(255) NOT NULL,
    owner_user_id character varying(255) NOT NULL,
    host_user_id character varying(255) NOT NULL,
    lobby_code character varying(6) NOT NULL,
    settings jsonb DEFAULT '{}'::jsonb NOT NULL,
    expires_at timestamp with time zone,
    closed_at timestamp with time zone,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL
);


--
-- TOC entry 4545 (class 0 OID 0)
-- Dependencies: 252
-- Name: COLUMN gamelobby.id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.gamelobby.id IS 'Primary key for game lobby';


--
-- TOC entry 4546 (class 0 OID 0)
-- Dependencies: 252
-- Name: COLUMN gamelobby.game_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.gamelobby.game_id IS 'Reference to the game being played in this lobby';


--
-- TOC entry 4547 (class 0 OID 0)
-- Dependencies: 252
-- Name: COLUMN gamelobby.owner_user_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.gamelobby.owner_user_id IS 'User who bought/has access to the game';


--
-- TOC entry 4548 (class 0 OID 0)
-- Dependencies: 252
-- Name: COLUMN gamelobby.host_user_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.gamelobby.host_user_id IS 'User who opened this specific lobby session';


--
-- TOC entry 4549 (class 0 OID 0)
-- Dependencies: 252
-- Name: COLUMN gamelobby.lobby_code; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.gamelobby.lobby_code IS 'Short unique code for joining lobby (e.g., ABC123)';


--
-- TOC entry 4550 (class 0 OID 0)
-- Dependencies: 252
-- Name: COLUMN gamelobby.settings; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.gamelobby.settings IS 'Lobby settings including max_players, invitation_type, game rules, etc.';


--
-- TOC entry 4551 (class 0 OID 0)
-- Dependencies: 252
-- Name: COLUMN gamelobby.expires_at; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.gamelobby.expires_at IS 'When this lobby will automatically close (null = pending activation)';


--
-- TOC entry 4552 (class 0 OID 0)
-- Dependencies: 252
-- Name: COLUMN gamelobby.closed_at; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.gamelobby.closed_at IS 'When the lobby was manually closed (if applicable)';


--
-- TOC entry 253 (class 1259 OID 46933)
-- Name: gamesession; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.gamesession (
    id uuid NOT NULL,
    lobby_id character varying(255) NOT NULL,
    session_number integer NOT NULL,
    participants jsonb DEFAULT '[]'::jsonb NOT NULL,
    current_state jsonb,
    data jsonb,
    started_at timestamp with time zone NOT NULL,
    finished_at timestamp with time zone,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    expires_at timestamp with time zone
);


--
-- TOC entry 4553 (class 0 OID 0)
-- Dependencies: 253
-- Name: COLUMN gamesession.id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.gamesession.id IS 'UUID primary key for game session';


--
-- TOC entry 4554 (class 0 OID 0)
-- Dependencies: 253
-- Name: COLUMN gamesession.lobby_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.gamesession.lobby_id IS 'Reference to the game lobby this session belongs to';


--
-- TOC entry 4555 (class 0 OID 0)
-- Dependencies: 253
-- Name: COLUMN gamesession.session_number; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.gamesession.session_number IS 'Sequential number of this session within the lobby (1, 2, 3...)';


--
-- TOC entry 4556 (class 0 OID 0)
-- Dependencies: 253
-- Name: COLUMN gamesession.participants; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.gamesession.participants IS 'Array of participant objects with id, isAuthedUser, display_name, user_id?, guest_token?, team_assignment?, joined_at';


--
-- TOC entry 4557 (class 0 OID 0)
-- Dependencies: 253
-- Name: COLUMN gamesession.current_state; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.gamesession.current_state IS 'Current live game state while the game is active';


--
-- TOC entry 4558 (class 0 OID 0)
-- Dependencies: 253
-- Name: COLUMN gamesession.data; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.gamesession.data IS 'Final results, scores, winners, and detailed game data when completed';


--
-- TOC entry 4559 (class 0 OID 0)
-- Dependencies: 253
-- Name: COLUMN gamesession.started_at; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.gamesession.started_at IS 'When this game session started';


--
-- TOC entry 4560 (class 0 OID 0)
-- Dependencies: 253
-- Name: COLUMN gamesession.finished_at; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.gamesession.finished_at IS 'When this game session finished (null if still active)';


--
-- TOC entry 4561 (class 0 OID 0)
-- Dependencies: 253
-- Name: COLUMN gamesession.expires_at; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.gamesession.expires_at IS 'When this session expires (inherits from lobby or independent)';


--
-- TOC entry 230 (class 1259 OID 46115)
-- Name: lesson_plan; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.lesson_plan (
    id character varying(255) NOT NULL,
    context character varying(100),
    file_configs jsonb DEFAULT '"{}"'::jsonb,
    is_active boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    estimated_duration integer,
    total_slides integer,
    teacher_notes text,
    accessible_slides integer[],
    allow_slide_preview boolean DEFAULT true NOT NULL,
    watermark_template_id character varying(255),
    branding_template_id character varying(255),
    branding_settings jsonb,
    add_branding boolean DEFAULT true NOT NULL
);


--
-- TOC entry 4562 (class 0 OID 0)
-- Dependencies: 230
-- Name: COLUMN lesson_plan.context; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.lesson_plan.context IS 'Theme context like "animals", "hanukkah", "christmas", etc.';


--
-- TOC entry 4563 (class 0 OID 0)
-- Dependencies: 230
-- Name: COLUMN lesson_plan.file_configs; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.lesson_plan.file_configs IS 'JSON configuration for files: roles, connections, slide configs';


--
-- TOC entry 4564 (class 0 OID 0)
-- Dependencies: 230
-- Name: COLUMN lesson_plan.is_active; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.lesson_plan.is_active IS 'Whether this lesson plan is active/published';


--
-- TOC entry 4565 (class 0 OID 0)
-- Dependencies: 230
-- Name: COLUMN lesson_plan.estimated_duration; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.lesson_plan.estimated_duration IS 'Estimated duration of the lesson in minutes';


--
-- TOC entry 4566 (class 0 OID 0)
-- Dependencies: 230
-- Name: COLUMN lesson_plan.total_slides; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.lesson_plan.total_slides IS 'Total number of slides in the lesson plan';


--
-- TOC entry 4567 (class 0 OID 0)
-- Dependencies: 230
-- Name: COLUMN lesson_plan.teacher_notes; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.lesson_plan.teacher_notes IS 'Notes and instructions for the teacher conducting the lesson';


--
-- TOC entry 4568 (class 0 OID 0)
-- Dependencies: 230
-- Name: COLUMN lesson_plan.accessible_slides; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.lesson_plan.accessible_slides IS 'Array of slide indices (0-based) accessible in preview mode: [0,2,4] or null for all slides';


--
-- TOC entry 4569 (class 0 OID 0)
-- Dependencies: 230
-- Name: COLUMN lesson_plan.allow_slide_preview; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.lesson_plan.allow_slide_preview IS 'Whether slides can be previewed without purchase access';


--
-- TOC entry 4570 (class 0 OID 0)
-- Dependencies: 230
-- Name: COLUMN lesson_plan.watermark_template_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.lesson_plan.watermark_template_id IS 'Reference to system_templates for watermark configuration on slides';


--
-- TOC entry 231 (class 1259 OID 46122)
-- Name: logs; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.logs (
    id integer NOT NULL,
    source_type character varying(10) NOT NULL,
    log_type character varying(20) DEFAULT 'log'::character varying NOT NULL,
    message text NOT NULL,
    user_id character varying(255),
    created_at timestamp with time zone DEFAULT now()
);


--
-- TOC entry 4571 (class 0 OID 0)
-- Dependencies: 231
-- Name: TABLE logs; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.logs IS 'Application logging and audit trail';


--
-- TOC entry 232 (class 1259 OID 46129)
-- Name: logs_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.logs_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- TOC entry 4572 (class 0 OID 0)
-- Dependencies: 232
-- Name: logs_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.logs_id_seq OWNED BY public.logs.id;


--
-- TOC entry 257 (class 1259 OID 47146)
-- Name: old_settings; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.old_settings (
    id character varying(255) NOT NULL,
    subscription_system_enabled boolean,
    default_course_access_days numeric,
    course_lifetime_access boolean,
    default_file_access_days numeric,
    file_lifetime_access boolean,
    contact_email character varying(255),
    contact_phone character varying(255),
    site_description text,
    logo_url character varying(500),
    site_name character varying(255),
    maintenance_mode boolean,
    student_invitation_expiry_days numeric,
    parent_consent_required boolean,
    nav_order jsonb,
    nav_files_text character varying(255),
    nav_files_icon character varying(255),
    nav_files_visibility character varying(255),
    nav_files_enabled boolean,
    nav_games_text character varying(255),
    nav_games_icon character varying(255),
    nav_games_visibility character varying(255),
    nav_games_enabled boolean,
    nav_workshops_text character varying(255),
    nav_workshops_icon character varying(255),
    nav_workshops_visibility character varying(255),
    nav_workshops_enabled boolean,
    nav_courses_text character varying(255),
    nav_courses_icon character varying(255),
    nav_courses_visibility character varying(255),
    nav_courses_enabled boolean,
    nav_classrooms_text character varying(255),
    nav_classrooms_icon character varying(255),
    nav_classrooms_visibility character varying(255),
    nav_classrooms_enabled boolean,
    nav_account_text character varying(255),
    nav_account_icon character varying(255),
    nav_account_visibility character varying(255),
    nav_account_enabled boolean,
    nav_content_creators_text character varying(255),
    nav_content_creators_icon character varying(255),
    nav_content_creators_visibility character varying(255),
    nav_content_creators_enabled boolean,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    allow_content_creator_workshops boolean DEFAULT true,
    allow_content_creator_courses boolean DEFAULT true,
    allow_content_creator_files boolean DEFAULT true,
    allow_content_creator_tools boolean DEFAULT true,
    allow_content_creator_games boolean DEFAULT true,
    copyright_text text DEFAULT 'כל הזכויות שמורות. תוכן זה מוגן בזכויות יוצרים ואסור להעתיקו, להפיצו או לשתפו ללא אישור בכתב מהמחבר או מלודורה.'::text,
    nav_tools_text character varying(255),
    nav_tools_icon character varying(255),
    nav_tools_visibility character varying(255) DEFAULT 'admin_only'::character varying,
    nav_tools_enabled boolean DEFAULT true,
    available_dashboard_widgets jsonb,
    nav_curriculum_text character varying(255),
    nav_curriculum_icon character varying(255),
    nav_curriculum_visibility character varying(255) DEFAULT 'logged_in_users'::character varying,
    nav_curriculum_enabled boolean DEFAULT false,
    available_specializations jsonb,
    available_grade_levels jsonb,
    default_game_access_days numeric DEFAULT 365,
    game_lifetime_access boolean DEFAULT true,
    nav_lesson_plans_text character varying(255),
    nav_lesson_plans_icon character varying(255),
    nav_lesson_plans_visibility character varying(255) DEFAULT 'logged_in_users'::character varying,
    nav_lesson_plans_enabled boolean DEFAULT false,
    allow_content_creator_lesson_plans boolean DEFAULT false,
    default_workshop_access_days integer,
    workshop_lifetime_access boolean,
    default_lesson_plan_access_days integer,
    lesson_plan_lifetime_access boolean,
    default_tool_access_days integer,
    tool_lifetime_access boolean,
    has_logo boolean DEFAULT false NOT NULL,
    logo_filename character varying(255),
    students_access public.enum_settings_students_access DEFAULT 'all'::public.enum_settings_students_access
);


--
-- TOC entry 4573 (class 0 OID 0)
-- Dependencies: 257
-- Name: COLUMN old_settings.logo_url; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.old_settings.logo_url IS 'DEPRECATED: Use has_logo and logo_filename instead. Kept for backward compatibility.';


--
-- TOC entry 4574 (class 0 OID 0)
-- Dependencies: 257
-- Name: COLUMN old_settings.copyright_text; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.old_settings.copyright_text IS 'Copyright text to be dynamically merged into PDF files';


--
-- TOC entry 4575 (class 0 OID 0)
-- Dependencies: 257
-- Name: COLUMN old_settings.nav_tools_text; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.old_settings.nav_tools_text IS 'Custom text for tools navigation item';


--
-- TOC entry 4576 (class 0 OID 0)
-- Dependencies: 257
-- Name: COLUMN old_settings.nav_tools_icon; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.old_settings.nav_tools_icon IS 'Custom icon for tools navigation item';


--
-- TOC entry 4577 (class 0 OID 0)
-- Dependencies: 257
-- Name: COLUMN old_settings.nav_tools_visibility; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.old_settings.nav_tools_visibility IS 'Visibility setting for tools navigation item (public, logged_in_users, admin_only, admins_and_creators, hidden)';


--
-- TOC entry 4578 (class 0 OID 0)
-- Dependencies: 257
-- Name: COLUMN old_settings.nav_tools_enabled; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.old_settings.nav_tools_enabled IS 'Whether tools navigation item is enabled';


--
-- TOC entry 4579 (class 0 OID 0)
-- Dependencies: 257
-- Name: COLUMN old_settings.available_dashboard_widgets; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.old_settings.available_dashboard_widgets IS 'Available widgets for user dashboards';


--
-- TOC entry 4580 (class 0 OID 0)
-- Dependencies: 257
-- Name: COLUMN old_settings.available_specializations; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.old_settings.available_specializations IS 'Available specializations for teacher onboarding';


--
-- TOC entry 4581 (class 0 OID 0)
-- Dependencies: 257
-- Name: COLUMN old_settings.available_grade_levels; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.old_settings.available_grade_levels IS 'Available grade levels for classroom creation';


--
-- TOC entry 4582 (class 0 OID 0)
-- Dependencies: 257
-- Name: COLUMN old_settings.default_game_access_days; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.old_settings.default_game_access_days IS 'Default access days for game products';


--
-- TOC entry 4583 (class 0 OID 0)
-- Dependencies: 257
-- Name: COLUMN old_settings.game_lifetime_access; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.old_settings.game_lifetime_access IS 'Whether game products have lifetime access by default';


--
-- TOC entry 4584 (class 0 OID 0)
-- Dependencies: 257
-- Name: COLUMN old_settings.has_logo; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.old_settings.has_logo IS 'Clear boolean indicator for system logo existence';


--
-- TOC entry 4585 (class 0 OID 0)
-- Dependencies: 257
-- Name: COLUMN old_settings.logo_filename; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.old_settings.logo_filename IS 'Standardized system logo filename storage (replaces logo_url)';


--
-- TOC entry 256 (class 1259 OID 47008)
-- Name: player; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.player (
    id uuid NOT NULL,
    privacy_code character varying(8) NOT NULL,
    display_name character varying(100) NOT NULL,
    user_id character varying(255),
    teacher_id character varying(255),
    achievements jsonb DEFAULT '[]'::jsonb NOT NULL,
    preferences jsonb DEFAULT '{}'::jsonb NOT NULL,
    is_online boolean DEFAULT false NOT NULL,
    last_seen timestamp with time zone NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL
);


--
-- TOC entry 4586 (class 0 OID 0)
-- Dependencies: 256
-- Name: COLUMN player.id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.player.id IS 'Unique player identifier';


--
-- TOC entry 4587 (class 0 OID 0)
-- Dependencies: 256
-- Name: COLUMN player.privacy_code; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.player.privacy_code IS 'Unique privacy code for anonymous player authentication (e.g. AB3X7KM9)';


--
-- TOC entry 4588 (class 0 OID 0)
-- Dependencies: 256
-- Name: COLUMN player.display_name; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.player.display_name IS 'Display name shown in games and to teachers';


--
-- TOC entry 4589 (class 0 OID 0)
-- Dependencies: 256
-- Name: COLUMN player.user_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.player.user_id IS 'Associated user account (null for anonymous players)';


--
-- TOC entry 4590 (class 0 OID 0)
-- Dependencies: 256
-- Name: COLUMN player.teacher_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.player.teacher_id IS 'Teacher who owns/manages this player';


--
-- TOC entry 4591 (class 0 OID 0)
-- Dependencies: 256
-- Name: COLUMN player.achievements; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.player.achievements IS 'Array of player achievements and badges';


--
-- TOC entry 4592 (class 0 OID 0)
-- Dependencies: 256
-- Name: COLUMN player.preferences; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.player.preferences IS 'Player preferences and settings';


--
-- TOC entry 4593 (class 0 OID 0)
-- Dependencies: 256
-- Name: COLUMN player.is_online; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.player.is_online IS 'Whether player is currently connected via SSE';


--
-- TOC entry 4594 (class 0 OID 0)
-- Dependencies: 256
-- Name: COLUMN player.last_seen; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.player.last_seen IS 'Last time player was active or seen online';


--
-- TOC entry 4595 (class 0 OID 0)
-- Dependencies: 256
-- Name: COLUMN player.is_active; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.player.is_active IS 'Whether player account is active (soft delete)';


--
-- TOC entry 233 (class 1259 OID 46130)
-- Name: product; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.product (
    id character varying(255) NOT NULL,
    title character varying(255),
    description text,
    category character varying(255),
    product_type character varying(255),
    entity_id character varying(255) NOT NULL,
    price numeric,
    is_published boolean,
    image_url character varying(500),
    tags jsonb,
    target_audience character varying(255),
    access_days numeric,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    creator_user_id character varying(255),
    short_description character varying(255),
    marketing_video_url character varying(255),
    marketing_video_title character varying(255),
    marketing_video_duration integer,
    marketing_video_type public.enum_product_marketing_video_type,
    marketing_video_id character varying(255),
    type_attributes jsonb DEFAULT '{}'::jsonb,
    image_filename character varying(255),
    has_image boolean DEFAULT false NOT NULL,
    content_topic_id character varying(255)
);


--
-- TOC entry 4596 (class 0 OID 0)
-- Dependencies: 233
-- Name: COLUMN product.image_url; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.product.image_url IS 'DEPRECATED: Use image_filename and has_image instead. Kept for backward compatibility.';


--
-- TOC entry 4597 (class 0 OID 0)
-- Dependencies: 233
-- Name: COLUMN product.marketing_video_url; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.product.marketing_video_url IS 'URL for uploaded marketing video file';


--
-- TOC entry 4598 (class 0 OID 0)
-- Dependencies: 233
-- Name: COLUMN product.marketing_video_title; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.product.marketing_video_title IS 'Title for uploaded marketing video';


--
-- TOC entry 4599 (class 0 OID 0)
-- Dependencies: 233
-- Name: COLUMN product.marketing_video_duration; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.product.marketing_video_duration IS 'Duration of uploaded marketing video in seconds';


--
-- TOC entry 4600 (class 0 OID 0)
-- Dependencies: 233
-- Name: COLUMN product.marketing_video_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.product.marketing_video_type IS 'Type of marketing video: youtube or uploaded file';


--
-- TOC entry 4601 (class 0 OID 0)
-- Dependencies: 233
-- Name: COLUMN product.marketing_video_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.product.marketing_video_id IS 'YouTube video ID or entity ID for uploaded videos';


--
-- TOC entry 4602 (class 0 OID 0)
-- Dependencies: 233
-- Name: COLUMN product.type_attributes; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.product.type_attributes IS 'Type-specific attributes based on product_type';


--
-- TOC entry 4603 (class 0 OID 0)
-- Dependencies: 233
-- Name: COLUMN product.image_filename; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.product.image_filename IS 'Standardized image filename storage (replaces image_url placeholder)';


--
-- TOC entry 4604 (class 0 OID 0)
-- Dependencies: 233
-- Name: COLUMN product.has_image; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.product.has_image IS 'Clear boolean indicator for image existence';


--
-- TOC entry 234 (class 1259 OID 46138)
-- Name: purchase; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.purchase (
    id character varying(255) NOT NULL,
    buyer_user_id character varying(255) NOT NULL,
    purchasable_type character varying(50) NOT NULL,
    purchasable_id character varying(255) NOT NULL,
    payment_amount numeric(10,2) NOT NULL,
    original_price numeric(10,2) NOT NULL,
    discount_amount numeric(10,2) DEFAULT 0,
    coupon_code character varying(100),
    payment_method character varying(50),
    payment_status character varying(50) DEFAULT 'cart'::character varying NOT NULL,
    transaction_id character varying(255),
    access_expires_at timestamp with time zone,
    download_count integer DEFAULT 0,
    first_accessed_at timestamp with time zone,
    last_accessed_at timestamp with time zone,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


--
-- TOC entry 4605 (class 0 OID 0)
-- Dependencies: 234
-- Name: TABLE purchase; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.purchase IS 'Purchase records and access tracking';


--
-- TOC entry 254 (class 1259 OID 46968)
-- Name: refresh_token; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.refresh_token (
    id character varying(255) NOT NULL,
    user_id character varying(255) NOT NULL,
    token_hash character varying(255) NOT NULL,
    expires_at timestamp with time zone NOT NULL,
    revoked_at timestamp with time zone,
    last_used_at timestamp with time zone,
    metadata jsonb DEFAULT '"{}"'::jsonb NOT NULL,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL
);


--
-- TOC entry 4606 (class 0 OID 0)
-- Dependencies: 254
-- Name: COLUMN refresh_token.id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.refresh_token.id IS 'Unique identifier for the refresh token';


--
-- TOC entry 4607 (class 0 OID 0)
-- Dependencies: 254
-- Name: COLUMN refresh_token.user_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.refresh_token.user_id IS 'ID of the user this refresh token belongs to';


--
-- TOC entry 4608 (class 0 OID 0)
-- Dependencies: 254
-- Name: COLUMN refresh_token.token_hash; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.refresh_token.token_hash IS 'SHA256 hash of the refresh token for security';


--
-- TOC entry 4609 (class 0 OID 0)
-- Dependencies: 254
-- Name: COLUMN refresh_token.expires_at; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.refresh_token.expires_at IS 'When this refresh token expires';


--
-- TOC entry 4610 (class 0 OID 0)
-- Dependencies: 254
-- Name: COLUMN refresh_token.revoked_at; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.refresh_token.revoked_at IS 'When this token was manually revoked (soft delete)';


--
-- TOC entry 4611 (class 0 OID 0)
-- Dependencies: 254
-- Name: COLUMN refresh_token.last_used_at; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.refresh_token.last_used_at IS 'When this token was last used to refresh access token';


--
-- TOC entry 4612 (class 0 OID 0)
-- Dependencies: 254
-- Name: COLUMN refresh_token.metadata; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.refresh_token.metadata IS 'Additional metadata like user agent, IP, device info';


--
-- TOC entry 235 (class 1259 OID 46149)
-- Name: school; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.school (
    id character varying(255) NOT NULL,
    name character varying(255) NOT NULL,
    city character varying(255) NOT NULL,
    address character varying(255) NOT NULL,
    institution_symbol character varying(255) NOT NULL,
    email character varying(255),
    phone_numbers jsonb DEFAULT '[]'::jsonb,
    education_levels jsonb DEFAULT '[]'::jsonb,
    district character varying(255),
    logo_url character varying(500),
    school_headmaster_id character varying(255),
    edu_system_id character varying(255),
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    has_logo boolean DEFAULT false NOT NULL,
    logo_filename character varying(255)
);


--
-- TOC entry 4613 (class 0 OID 0)
-- Dependencies: 235
-- Name: COLUMN school.name; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.school.name IS 'School name';


--
-- TOC entry 4614 (class 0 OID 0)
-- Dependencies: 235
-- Name: COLUMN school.city; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.school.city IS 'City where the school is located';


--
-- TOC entry 4615 (class 0 OID 0)
-- Dependencies: 235
-- Name: COLUMN school.address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.school.address IS 'Full address of the school';


--
-- TOC entry 4616 (class 0 OID 0)
-- Dependencies: 235
-- Name: COLUMN school.institution_symbol; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.school.institution_symbol IS 'Unique institution symbol/code';


--
-- TOC entry 4617 (class 0 OID 0)
-- Dependencies: 235
-- Name: COLUMN school.email; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.school.email IS 'Primary email address';


--
-- TOC entry 4618 (class 0 OID 0)
-- Dependencies: 235
-- Name: COLUMN school.phone_numbers; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.school.phone_numbers IS 'Array of phone objects with phone and description fields';


--
-- TOC entry 4619 (class 0 OID 0)
-- Dependencies: 235
-- Name: COLUMN school.education_levels; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.school.education_levels IS 'Array of education levels (elementary, middle_school, high_school, academic)';


--
-- TOC entry 4620 (class 0 OID 0)
-- Dependencies: 235
-- Name: COLUMN school.district; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.school.district IS 'Educational district (צפון, חיפה, מרכז, etc.)';


--
-- TOC entry 4621 (class 0 OID 0)
-- Dependencies: 235
-- Name: COLUMN school.logo_url; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.school.logo_url IS 'DEPRECATED: Use has_logo and logo_filename instead. Kept for backward compatibility.';


--
-- TOC entry 4622 (class 0 OID 0)
-- Dependencies: 235
-- Name: COLUMN school.school_headmaster_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.school.school_headmaster_id IS 'School headmaster user ID';


--
-- TOC entry 4623 (class 0 OID 0)
-- Dependencies: 235
-- Name: COLUMN school.edu_system_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.school.edu_system_id IS 'Education system identifier';


--
-- TOC entry 4624 (class 0 OID 0)
-- Dependencies: 235
-- Name: COLUMN school.has_logo; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.school.has_logo IS 'Clear boolean indicator for logo image existence';


--
-- TOC entry 4625 (class 0 OID 0)
-- Dependencies: 235
-- Name: COLUMN school.logo_filename; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.school.logo_filename IS 'Standardized logo filename storage (replaces logo_url)';


--
-- TOC entry 258 (class 1259 OID 47197)
-- Name: settings; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.settings (
    id character varying(255) NOT NULL,
    key character varying(255) NOT NULL,
    value jsonb,
    value_type public.enum_configuration_value_type DEFAULT 'string'::public.enum_configuration_value_type NOT NULL,
    description text,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


--
-- TOC entry 4626 (class 0 OID 0)
-- Dependencies: 258
-- Name: COLUMN settings.id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.settings.id IS 'Configuration record UUID';


--
-- TOC entry 4627 (class 0 OID 0)
-- Dependencies: 258
-- Name: COLUMN settings.key; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.settings.key IS 'Configuration key (e.g., subscription_system_enabled, contact_email)';


--
-- TOC entry 4628 (class 0 OID 0)
-- Dependencies: 258
-- Name: COLUMN settings.value; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.settings.value IS 'Configuration value stored as JSON (supports strings, numbers, booleans, objects, arrays)';


--
-- TOC entry 4629 (class 0 OID 0)
-- Dependencies: 258
-- Name: COLUMN settings.value_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.settings.value_type IS 'Type hint for value casting';


--
-- TOC entry 4630 (class 0 OID 0)
-- Dependencies: 258
-- Name: COLUMN settings.description; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.settings.description IS 'Human-readable description of this configuration setting';


--
-- TOC entry 236 (class 1259 OID 46179)
-- Name: studentinvitation; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.studentinvitation (
    id character varying(255) NOT NULL,
    classroom_id character varying(255),
    teacher_id character varying(255),
    student_user_id character varying(255),
    student_email character varying(255),
    student_name character varying(255),
    parent_email character varying(255),
    parent_name character varying(255),
    status character varying(255),
    invitation_token character varying(255),
    parent_consent_token character varying(255),
    expires_at character varying(255),
    parent_consent_given_at character varying(255),
    student_accepted_at character varying(255),
    converted_to_membership_at character varying(255),
    notes character varying(255),
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL
);


--
-- TOC entry 237 (class 1259 OID 46186)
-- Name: subscription; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.subscription (
    id character varying(255) NOT NULL,
    user_id character varying(255) NOT NULL,
    subscription_plan_id character varying(255) NOT NULL,
    transaction_id character varying(255),
    status public.enum_subscription_status DEFAULT 'pending'::public.enum_subscription_status NOT NULL,
    start_date timestamp with time zone NOT NULL,
    end_date timestamp with time zone,
    next_billing_date timestamp with time zone,
    cancelled_at timestamp with time zone,
    payplus_subscription_uid character varying(255),
    payplus_status character varying(255),
    monthly_price numeric(10,2) NOT NULL,
    billing_period character varying(255) NOT NULL,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    original_price numeric(10,2),
    discount_amount numeric(10,2) DEFAULT 0
);


--
-- TOC entry 4631 (class 0 OID 0)
-- Dependencies: 237
-- Name: COLUMN subscription.original_price; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.subscription.original_price IS 'Original price before discounts';


--
-- TOC entry 4632 (class 0 OID 0)
-- Dependencies: 237
-- Name: COLUMN subscription.discount_amount; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.subscription.discount_amount IS 'Discount amount applied to this subscription';


--
-- TOC entry 238 (class 1259 OID 46194)
-- Name: subscriptionhistory; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.subscriptionhistory (
    id character varying(255) NOT NULL,
    user_id character varying(255) NOT NULL,
    subscription_plan_id character varying(255) NOT NULL,
    subscription_id character varying(255),
    action_type public.enum_subscriptionhistory_action_type NOT NULL,
    previous_plan_id character varying(255),
    start_date timestamp with time zone,
    end_date timestamp with time zone,
    purchased_price numeric(10,2),
    payplus_subscription_uid character varying(255),
    transaction_id character varying(255),
    notes text,
    metadata jsonb,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL
);


--
-- TOC entry 4633 (class 0 OID 0)
-- Dependencies: 238
-- Name: COLUMN subscriptionhistory.id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.subscriptionhistory.id IS 'Unique identifier for subscription history record';


--
-- TOC entry 4634 (class 0 OID 0)
-- Dependencies: 238
-- Name: COLUMN subscriptionhistory.user_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.subscriptionhistory.user_id IS 'ID of the user this history record belongs to';


--
-- TOC entry 4635 (class 0 OID 0)
-- Dependencies: 238
-- Name: COLUMN subscriptionhistory.subscription_plan_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.subscriptionhistory.subscription_plan_id IS 'ID of the subscription plan involved in this action';


--
-- TOC entry 4636 (class 0 OID 0)
-- Dependencies: 238
-- Name: COLUMN subscriptionhistory.subscription_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.subscriptionhistory.subscription_id IS 'ID of the subscription record if linked to new subscription system';


--
-- TOC entry 4637 (class 0 OID 0)
-- Dependencies: 238
-- Name: COLUMN subscriptionhistory.action_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.subscriptionhistory.action_type IS 'Type of subscription action performed';


--
-- TOC entry 4638 (class 0 OID 0)
-- Dependencies: 238
-- Name: COLUMN subscriptionhistory.previous_plan_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.subscriptionhistory.previous_plan_id IS 'ID of the previous subscription plan (for upgrades/downgrades)';


--
-- TOC entry 4639 (class 0 OID 0)
-- Dependencies: 238
-- Name: COLUMN subscriptionhistory.start_date; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.subscriptionhistory.start_date IS 'Start date of the subscription action';


--
-- TOC entry 4640 (class 0 OID 0)
-- Dependencies: 238
-- Name: COLUMN subscriptionhistory.end_date; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.subscriptionhistory.end_date IS 'End date of the subscription (for cancellations)';


--
-- TOC entry 4641 (class 0 OID 0)
-- Dependencies: 238
-- Name: COLUMN subscriptionhistory.purchased_price; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.subscriptionhistory.purchased_price IS 'Price paid for this subscription action';


--
-- TOC entry 4642 (class 0 OID 0)
-- Dependencies: 238
-- Name: COLUMN subscriptionhistory.payplus_subscription_uid; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.subscriptionhistory.payplus_subscription_uid IS 'PayPlus subscription UID for recurring payments';


--
-- TOC entry 4643 (class 0 OID 0)
-- Dependencies: 238
-- Name: COLUMN subscriptionhistory.transaction_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.subscriptionhistory.transaction_id IS 'ID of the transaction associated with this action';


--
-- TOC entry 4644 (class 0 OID 0)
-- Dependencies: 238
-- Name: COLUMN subscriptionhistory.notes; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.subscriptionhistory.notes IS 'Additional notes about this subscription action';


--
-- TOC entry 4645 (class 0 OID 0)
-- Dependencies: 238
-- Name: COLUMN subscriptionhistory.metadata; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.subscriptionhistory.metadata IS 'Additional metadata for this subscription history record';


--
-- TOC entry 4646 (class 0 OID 0)
-- Dependencies: 238
-- Name: COLUMN subscriptionhistory.created_at; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.subscriptionhistory.created_at IS 'Timestamp when this history record was created';


--
-- TOC entry 4647 (class 0 OID 0)
-- Dependencies: 238
-- Name: COLUMN subscriptionhistory.updated_at; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.subscriptionhistory.updated_at IS 'Timestamp when this history record was last updated';


--
-- TOC entry 239 (class 1259 OID 46199)
-- Name: subscriptionplan; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.subscriptionplan (
    id character varying(255) NOT NULL,
    name character varying(255),
    description character varying(255),
    price numeric,
    billing_period character varying(255),
    has_discount boolean,
    discount_type character varying(255),
    discount_value numeric,
    discount_valid_until character varying(255),
    is_active boolean,
    is_default boolean,
    plan_type character varying(255),
    benefits jsonb,
    sort_order numeric,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- TOC entry 247 (class 1259 OID 46691)
-- Name: supportmessage; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.supportmessage (
    id character varying(255) NOT NULL,
    name character varying(255),
    email character varying(255),
    phone character varying(255),
    subject character varying(255),
    content text,
    is_read boolean DEFAULT false,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL
);


--
-- TOC entry 4648 (class 0 OID 0)
-- Dependencies: 247
-- Name: COLUMN supportmessage.name; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.supportmessage.name IS 'Name of the person submitting the support request';


--
-- TOC entry 4649 (class 0 OID 0)
-- Dependencies: 247
-- Name: COLUMN supportmessage.email; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.supportmessage.email IS 'Email address of the person submitting the request';


--
-- TOC entry 4650 (class 0 OID 0)
-- Dependencies: 247
-- Name: COLUMN supportmessage.phone; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.supportmessage.phone IS 'Phone number of the person submitting the request';


--
-- TOC entry 4651 (class 0 OID 0)
-- Dependencies: 247
-- Name: COLUMN supportmessage.subject; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.supportmessage.subject IS 'Subject line of the support request';


--
-- TOC entry 4652 (class 0 OID 0)
-- Dependencies: 247
-- Name: COLUMN supportmessage.content; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.supportmessage.content IS 'Detailed content of the support request';


--
-- TOC entry 4653 (class 0 OID 0)
-- Dependencies: 247
-- Name: COLUMN supportmessage.is_read; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.supportmessage.is_read IS 'Whether this message has been read by an administrator';


--
-- TOC entry 248 (class 1259 OID 46752)
-- Name: system_templates; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.system_templates (
    id character varying(255) NOT NULL,
    name character varying(255) NOT NULL,
    description text,
    template_type character varying(100) NOT NULL,
    target_format character varying(50) NOT NULL,
    is_default boolean DEFAULT false NOT NULL,
    template_data jsonb NOT NULL,
    target_file_types character varying(255)[] DEFAULT NULL::character varying[],
    created_by character varying(255),
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    CONSTRAINT chk_target_format CHECK (((target_format)::text = ANY ((ARRAY['pdf-a4-landscape'::character varying, 'pdf-a4-portrait'::character varying, 'svg-lessonplan'::character varying])::text[]))),
    CONSTRAINT chk_template_type CHECK (((template_type)::text = ANY ((ARRAY['branding'::character varying, 'watermark'::character varying])::text[])))
);


--
-- TOC entry 4654 (class 0 OID 0)
-- Dependencies: 248
-- Name: COLUMN system_templates.name; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.system_templates.name IS 'Human-readable template name in Hebrew';


--
-- TOC entry 4655 (class 0 OID 0)
-- Dependencies: 248
-- Name: COLUMN system_templates.description; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.system_templates.description IS 'Optional description of template purpose and usage';


--
-- TOC entry 4656 (class 0 OID 0)
-- Dependencies: 248
-- Name: COLUMN system_templates.template_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.system_templates.template_type IS 'Type of template: branding or watermark';


--
-- TOC entry 4657 (class 0 OID 0)
-- Dependencies: 248
-- Name: COLUMN system_templates.target_format; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.system_templates.target_format IS 'Target format: pdf-a4-portrait, pdf-a4-landscape, or svg-lessonplan';


--
-- TOC entry 4658 (class 0 OID 0)
-- Dependencies: 248
-- Name: COLUMN system_templates.is_default; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.system_templates.is_default IS 'Whether this template is the default for its type+format combination';


--
-- TOC entry 4659 (class 0 OID 0)
-- Dependencies: 248
-- Name: COLUMN system_templates.template_data; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.system_templates.template_data IS 'Complete template configuration including all elements and styling';


--
-- TOC entry 4660 (class 0 OID 0)
-- Dependencies: 248
-- Name: COLUMN system_templates.target_file_types; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.system_templates.target_file_types IS 'Array of file types for watermark templates: [pdf, svg] or null for branding';


--
-- TOC entry 4661 (class 0 OID 0)
-- Dependencies: 248
-- Name: COLUMN system_templates.created_by; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.system_templates.created_by IS 'Email of user who created this template';


--
-- TOC entry 240 (class 1259 OID 46206)
-- Name: tool; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.tool (
    id character varying(255) NOT NULL,
    tool_key character varying(255) NOT NULL,
    category character varying(255) DEFAULT 'general'::character varying NOT NULL,
    default_access_days integer DEFAULT 365 NOT NULL,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL
);


--
-- TOC entry 4662 (class 0 OID 0)
-- Dependencies: 240
-- Name: COLUMN tool.tool_key; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.tool.tool_key IS 'Unique identifier for the tool (e.g., CONTACT_PAGE_GENERATOR)';


--
-- TOC entry 4663 (class 0 OID 0)
-- Dependencies: 240
-- Name: COLUMN tool.category; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.tool.category IS 'Category of the tool (e.g., generators, utilities)';


--
-- TOC entry 4664 (class 0 OID 0)
-- Dependencies: 240
-- Name: COLUMN tool.default_access_days; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.tool.default_access_days IS 'Default access duration when purchased';


--
-- TOC entry 241 (class 1259 OID 46215)
-- Name: transaction; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.transaction (
    id character varying(255) NOT NULL,
    user_id character varying(255),
    amount numeric(10,2),
    currency character varying(255) DEFAULT 'ILS'::character varying,
    payment_method character varying(255),
    payment_status public.enum_transaction_payment_status DEFAULT 'pending'::public.enum_transaction_payment_status,
    metadata jsonb,
    environment public.enum_transaction_environment,
    provider_response jsonb,
    failure_reason text,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    page_request_uid character varying(255),
    payment_page_link text,
    transaction_id character varying(255),
    description text,
    provider_transaction_id character varying(255)
);


--
-- TOC entry 242 (class 1259 OID 46229)
-- Name: user; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public."user" (
    id character varying(255) NOT NULL,
    email character varying(255),
    full_name character varying(255),
    disabled character varying(255),
    is_verified boolean,
    role character varying(255) DEFAULT 'user'::character varying NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    is_active boolean DEFAULT true,
    last_login timestamp with time zone,
    phone character varying(255),
    education_level character varying(255),
    content_creator_agreement_sign_date timestamp with time zone,
    user_type character varying(255),
    dashboard_settings jsonb,
    onboarding_completed boolean DEFAULT false NOT NULL,
    birth_date date,
    specializations jsonb DEFAULT '[]'::jsonb,
    school_id character varying(255),
    invitation_code character varying(8)
);


--
-- TOC entry 4665 (class 0 OID 0)
-- Dependencies: 242
-- Name: TABLE "user"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public."user" IS 'User accounts and authentication information';


--
-- TOC entry 4666 (class 0 OID 0)
-- Dependencies: 242
-- Name: COLUMN "user".dashboard_settings; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public."user".dashboard_settings IS 'User dashboard configuration with widgets and their settings';


--
-- TOC entry 4667 (class 0 OID 0)
-- Dependencies: 242
-- Name: COLUMN "user".onboarding_completed; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public."user".onboarding_completed IS 'Flag indicating whether user has completed the onboarding process';


--
-- TOC entry 4668 (class 0 OID 0)
-- Dependencies: 242
-- Name: COLUMN "user".birth_date; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public."user".birth_date IS 'User birth date for age verification and onboarding';


--
-- TOC entry 4669 (class 0 OID 0)
-- Dependencies: 242
-- Name: COLUMN "user".specializations; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public."user".specializations IS 'Teacher specializations and teaching subjects as JSON array';


--
-- TOC entry 4670 (class 0 OID 0)
-- Dependencies: 242
-- Name: COLUMN "user".school_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public."user".school_id IS 'School that this user belongs to (teachers, students, headmasters)';


--
-- TOC entry 4671 (class 0 OID 0)
-- Dependencies: 242
-- Name: COLUMN "user".invitation_code; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public."user".invitation_code IS 'Unique invitation code for teachers to share their catalog with students';


--
-- TOC entry 255 (class 1259 OID 46988)
-- Name: user_session; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.user_session (
    id character varying(255) NOT NULL,
    user_id character varying(255),
    expires_at timestamp with time zone NOT NULL,
    last_accessed_at timestamp with time zone NOT NULL,
    is_active boolean DEFAULT true NOT NULL,
    invalidated_at timestamp with time zone,
    metadata jsonb DEFAULT '{}'::jsonb NOT NULL,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    player_id uuid,
    portal character varying(20) DEFAULT 'teacher'::character varying NOT NULL,
    CONSTRAINT user_session_entity_check CHECK ((((user_id IS NOT NULL) AND (player_id IS NULL)) OR ((user_id IS NULL) AND (player_id IS NOT NULL)))),
    CONSTRAINT user_session_portal_check CHECK (((portal)::text = ANY ((ARRAY['teacher'::character varying, 'student'::character varying])::text[])))
);


--
-- TOC entry 4672 (class 0 OID 0)
-- Dependencies: 255
-- Name: COLUMN user_session.id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_session.id IS 'Unique session identifier';


--
-- TOC entry 4673 (class 0 OID 0)
-- Dependencies: 255
-- Name: COLUMN user_session.user_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_session.user_id IS 'ID of the user this session belongs to (null for player sessions)';


--
-- TOC entry 4674 (class 0 OID 0)
-- Dependencies: 255
-- Name: COLUMN user_session.expires_at; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_session.expires_at IS 'When this session expires';


--
-- TOC entry 4675 (class 0 OID 0)
-- Dependencies: 255
-- Name: COLUMN user_session.last_accessed_at; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_session.last_accessed_at IS 'When this session was last accessed';


--
-- TOC entry 4676 (class 0 OID 0)
-- Dependencies: 255
-- Name: COLUMN user_session.is_active; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_session.is_active IS 'Whether this session is active';


--
-- TOC entry 4677 (class 0 OID 0)
-- Dependencies: 255
-- Name: COLUMN user_session.invalidated_at; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_session.invalidated_at IS 'When this session was manually invalidated';


--
-- TOC entry 4678 (class 0 OID 0)
-- Dependencies: 255
-- Name: COLUMN user_session.metadata; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_session.metadata IS 'Session metadata like user agent, IP, login method';


--
-- TOC entry 4679 (class 0 OID 0)
-- Dependencies: 255
-- Name: COLUMN user_session.player_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_session.player_id IS 'ID of the player this session belongs to (null for user sessions)';


--
-- TOC entry 4680 (class 0 OID 0)
-- Dependencies: 255
-- Name: COLUMN user_session.portal; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.user_session.portal IS 'Portal context where this session was created (teacher or student)';


--
-- TOC entry 243 (class 1259 OID 46240)
-- Name: webhook_log; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.webhook_log (
    id character varying(255) NOT NULL,
    provider character varying(50) NOT NULL,
    event_type character varying(100) NOT NULL,
    event_data jsonb NOT NULL,
    sender_info jsonb NOT NULL,
    response_data jsonb,
    process_log text,
    status character varying(20) DEFAULT 'received'::character varying NOT NULL,
    page_request_uid character varying(255),
    payplus_transaction_uid character varying(255),
    transaction_id character varying(255),
    subscription_id character varying(255),
    error_message text,
    processing_duration_ms integer,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL
);


--
-- TOC entry 4681 (class 0 OID 0)
-- Dependencies: 243
-- Name: COLUMN webhook_log.provider; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.webhook_log.provider IS 'Webhook provider (payplus, stripe, etc.)';


--
-- TOC entry 4682 (class 0 OID 0)
-- Dependencies: 243
-- Name: COLUMN webhook_log.event_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.webhook_log.event_type IS 'Type of webhook event';


--
-- TOC entry 4683 (class 0 OID 0)
-- Dependencies: 243
-- Name: COLUMN webhook_log.event_data; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.webhook_log.event_data IS 'Complete webhook payload data';


--
-- TOC entry 4684 (class 0 OID 0)
-- Dependencies: 243
-- Name: COLUMN webhook_log.sender_info; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.webhook_log.sender_info IS 'Information about who sent the webhook (IP, user-agent, headers, etc.)';


--
-- TOC entry 4685 (class 0 OID 0)
-- Dependencies: 243
-- Name: COLUMN webhook_log.response_data; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.webhook_log.response_data IS 'Response data sent back to webhook sender';


--
-- TOC entry 4686 (class 0 OID 0)
-- Dependencies: 243
-- Name: COLUMN webhook_log.process_log; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.webhook_log.process_log IS 'Log of processing steps and any errors';


--
-- TOC entry 4687 (class 0 OID 0)
-- Dependencies: 243
-- Name: COLUMN webhook_log.status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.webhook_log.status IS 'Status: received, processing, completed, failed';


--
-- TOC entry 4688 (class 0 OID 0)
-- Dependencies: 243
-- Name: COLUMN webhook_log.page_request_uid; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.webhook_log.page_request_uid IS 'PayPlus page request UID for tracking';


--
-- TOC entry 4689 (class 0 OID 0)
-- Dependencies: 243
-- Name: COLUMN webhook_log.payplus_transaction_uid; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.webhook_log.payplus_transaction_uid IS 'PayPlus transaction UID for tracking';


--
-- TOC entry 4690 (class 0 OID 0)
-- Dependencies: 243
-- Name: COLUMN webhook_log.transaction_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.webhook_log.transaction_id IS 'Related transaction ID if found';


--
-- TOC entry 4691 (class 0 OID 0)
-- Dependencies: 243
-- Name: COLUMN webhook_log.subscription_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.webhook_log.subscription_id IS 'Related subscription ID if found';


--
-- TOC entry 4692 (class 0 OID 0)
-- Dependencies: 243
-- Name: COLUMN webhook_log.error_message; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.webhook_log.error_message IS 'Error message if processing failed';


--
-- TOC entry 4693 (class 0 OID 0)
-- Dependencies: 243
-- Name: COLUMN webhook_log.processing_duration_ms; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.webhook_log.processing_duration_ms IS 'Time taken to process webhook in milliseconds';


--
-- TOC entry 244 (class 1259 OID 46246)
-- Name: workshop; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.workshop (
    id character varying(255) NOT NULL,
    title character varying(255) NOT NULL,
    description text,
    short_description text,
    category character varying(255),
    price numeric DEFAULT '0'::numeric NOT NULL,
    is_published boolean DEFAULT false NOT NULL,
    image_url character varying(255),
    image_is_private boolean DEFAULT false,
    tags jsonb,
    target_audience character varying(255),
    difficulty_level character varying(255),
    access_days integer,
    is_lifetime_access boolean DEFAULT false,
    workshop_type character varying(255) DEFAULT 'recorded'::character varying NOT NULL,
    video_file_url character varying(500),
    scheduled_date timestamp with time zone,
    meeting_link character varying(255),
    meeting_password character varying(255),
    meeting_platform character varying(255),
    max_participants integer,
    duration_minutes integer,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    has_video boolean DEFAULT false NOT NULL,
    video_filename character varying(255)
);


--
-- TOC entry 4694 (class 0 OID 0)
-- Dependencies: 244
-- Name: TABLE workshop; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.workshop IS 'Workshop content (recorded and live)';


--
-- TOC entry 4695 (class 0 OID 0)
-- Dependencies: 244
-- Name: COLUMN workshop.video_file_url; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.workshop.video_file_url IS 'DEPRECATED: Use has_video and video_filename instead. Kept for backward compatibility.';


--
-- TOC entry 4696 (class 0 OID 0)
-- Dependencies: 244
-- Name: COLUMN workshop.has_video; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.workshop.has_video IS 'Clear boolean indicator for content video existence';


--
-- TOC entry 4697 (class 0 OID 0)
-- Dependencies: 244
-- Name: COLUMN workshop.video_filename; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.workshop.video_filename IS 'Standardized video filename storage (replaces video_file_url)';


--
-- TOC entry 3920 (class 2604 OID 46256)
-- Name: logs id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.logs ALTER COLUMN id SET DEFAULT nextval('public.logs_id_seq'::regclass);


--
-- TOC entry 4009 (class 2606 OID 46263)
-- Name: SequelizeMeta SequelizeMeta_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public."SequelizeMeta"
    ADD CONSTRAINT "SequelizeMeta_pkey" PRIMARY KEY (name);


--
-- TOC entry 4011 (class 2606 OID 46265)
-- Name: audiofile audiofile_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.audiofile
    ADD CONSTRAINT audiofile_pkey PRIMARY KEY (id);


--
-- TOC entry 4015 (class 2606 OID 46267)
-- Name: category category_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.category
    ADD CONSTRAINT category_pkey PRIMARY KEY (id);


--
-- TOC entry 4017 (class 2606 OID 46269)
-- Name: classroom classroom_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.classroom
    ADD CONSTRAINT classroom_pkey PRIMARY KEY (id);


--
-- TOC entry 4023 (class 2606 OID 46271)
-- Name: classroommembership classroommembership_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.classroommembership
    ADD CONSTRAINT classroommembership_pkey PRIMARY KEY (id);


--
-- TOC entry 4292 (class 2606 OID 47208)
-- Name: settings configuration_key_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.settings
    ADD CONSTRAINT configuration_key_key UNIQUE (key);


--
-- TOC entry 4294 (class 2606 OID 47206)
-- Name: settings configuration_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.settings
    ADD CONSTRAINT configuration_pkey PRIMARY KEY (id);


--
-- TOC entry 4217 (class 2606 OID 46781)
-- Name: content_topic content_topic_name_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.content_topic
    ADD CONSTRAINT content_topic_name_key UNIQUE (name);


--
-- TOC entry 4220 (class 2606 OID 46779)
-- Name: content_topic content_topic_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.content_topic
    ADD CONSTRAINT content_topic_pkey PRIMARY KEY (id);


--
-- TOC entry 4027 (class 2606 OID 46275)
-- Name: coupon coupon_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.coupon
    ADD CONSTRAINT coupon_pkey PRIMARY KEY (id);


--
-- TOC entry 4034 (class 2606 OID 46277)
-- Name: course course_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.course
    ADD CONSTRAINT course_pkey PRIMARY KEY (id);


--
-- TOC entry 4057 (class 2606 OID 46279)
-- Name: curriculum_item curriculum_item_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.curriculum_item
    ADD CONSTRAINT curriculum_item_pkey PRIMARY KEY (id);


--
-- TOC entry 4044 (class 2606 OID 46281)
-- Name: curriculum curriculum_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.curriculum
    ADD CONSTRAINT curriculum_pkey PRIMARY KEY (id);


--
-- TOC entry 4061 (class 2606 OID 46283)
-- Name: curriculum_product curriculum_product_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.curriculum_product
    ADD CONSTRAINT curriculum_product_pkey PRIMARY KEY (curriculum_item_id, product_id);


--
-- TOC entry 4222 (class 2606 OID 46856)
-- Name: edu_content edu_content_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.edu_content
    ADD CONSTRAINT edu_content_pkey PRIMARY KEY (id);


--
-- TOC entry 4227 (class 2606 OID 46873)
-- Name: edu_content_use edu_content_use_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.edu_content_use
    ADD CONSTRAINT edu_content_use_pkey PRIMARY KEY (id);


--
-- TOC entry 4192 (class 2606 OID 46674)
-- Name: emaillog emaillog_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.emaillog
    ADD CONSTRAINT emaillog_pkey PRIMARY KEY (id);


--
-- TOC entry 4186 (class 2606 OID 46663)
-- Name: emailtemplate emailtemplate_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.emailtemplate
    ADD CONSTRAINT emailtemplate_pkey PRIMARY KEY (id);


--
-- TOC entry 4065 (class 2606 OID 46285)
-- Name: file file_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.file
    ADD CONSTRAINT file_pkey PRIMARY KEY (id);


--
-- TOC entry 4074 (class 2606 OID 46287)
-- Name: game game_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.game
    ADD CONSTRAINT game_pkey PRIMARY KEY (id);


--
-- TOC entry 4236 (class 2606 OID 46903)
-- Name: gamelobby gamelobby_lobby_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.gamelobby
    ADD CONSTRAINT gamelobby_lobby_code_key UNIQUE (lobby_code);


--
-- TOC entry 4240 (class 2606 OID 46901)
-- Name: gamelobby gamelobby_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.gamelobby
    ADD CONSTRAINT gamelobby_pkey PRIMARY KEY (id);


--
-- TOC entry 4246 (class 2606 OID 46941)
-- Name: gamesession gamesession_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.gamesession
    ADD CONSTRAINT gamesession_pkey PRIMARY KEY (id);


--
-- TOC entry 4085 (class 2606 OID 46289)
-- Name: lesson_plan lesson_plan_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.lesson_plan
    ADD CONSTRAINT lesson_plan_pkey PRIMARY KEY (id);


--
-- TOC entry 4091 (class 2606 OID 46291)
-- Name: logs logs_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.logs
    ADD CONSTRAINT logs_pkey PRIMARY KEY (id);


--
-- TOC entry 4279 (class 2606 OID 47018)
-- Name: player player_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.player
    ADD CONSTRAINT player_pkey PRIMARY KEY (id);


--
-- TOC entry 4281 (class 2606 OID 47020)
-- Name: player player_privacy_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.player
    ADD CONSTRAINT player_privacy_code_key UNIQUE (privacy_code);


--
-- TOC entry 4096 (class 2606 OID 46293)
-- Name: product product_entity_unique; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.product
    ADD CONSTRAINT product_entity_unique UNIQUE (product_type, entity_id);


--
-- TOC entry 4098 (class 2606 OID 46295)
-- Name: product product_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.product
    ADD CONSTRAINT product_pkey PRIMARY KEY (id);


--
-- TOC entry 4105 (class 2606 OID 46297)
-- Name: purchase purchase_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.purchase
    ADD CONSTRAINT purchase_pkey PRIMARY KEY (id);


--
-- TOC entry 4254 (class 2606 OID 46975)
-- Name: refresh_token refresh_token_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.refresh_token
    ADD CONSTRAINT refresh_token_pkey PRIMARY KEY (id);


--
-- TOC entry 4115 (class 2606 OID 46299)
-- Name: school school_institution_symbol_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.school
    ADD CONSTRAINT school_institution_symbol_key UNIQUE (institution_symbol);


--
-- TOC entry 4117 (class 2606 OID 46301)
-- Name: school school_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.school
    ADD CONSTRAINT school_pkey PRIMARY KEY (id);


--
-- TOC entry 4290 (class 2606 OID 47171)
-- Name: old_settings settings_pkey1; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.old_settings
    ADD CONSTRAINT settings_pkey1 PRIMARY KEY (id);


--
-- TOC entry 4122 (class 2606 OID 46305)
-- Name: studentinvitation studentinvitation_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.studentinvitation
    ADD CONSTRAINT studentinvitation_pkey PRIMARY KEY (id);


--
-- TOC entry 4134 (class 2606 OID 46307)
-- Name: subscription subscription_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.subscription
    ADD CONSTRAINT subscription_pkey PRIMARY KEY (id);


--
-- TOC entry 4143 (class 2606 OID 46309)
-- Name: subscriptionhistory subscriptionhistory_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.subscriptionhistory
    ADD CONSTRAINT subscriptionhistory_pkey PRIMARY KEY (id);


--
-- TOC entry 4145 (class 2606 OID 46311)
-- Name: subscriptionplan subscriptionplan_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.subscriptionplan
    ADD CONSTRAINT subscriptionplan_pkey PRIMARY KEY (id);


--
-- TOC entry 4204 (class 2606 OID 46698)
-- Name: supportmessage supportmessage_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.supportmessage
    ADD CONSTRAINT supportmessage_pkey PRIMARY KEY (id);


--
-- TOC entry 4213 (class 2606 OID 46760)
-- Name: system_templates system_templates_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.system_templates
    ADD CONSTRAINT system_templates_pkey PRIMARY KEY (id);


--
-- TOC entry 4148 (class 2606 OID 46313)
-- Name: tool tool_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.tool
    ADD CONSTRAINT tool_pkey PRIMARY KEY (id);


--
-- TOC entry 4150 (class 2606 OID 46315)
-- Name: tool tool_tool_key_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.tool
    ADD CONSTRAINT tool_tool_key_key UNIQUE (tool_key);


--
-- TOC entry 4154 (class 2606 OID 46317)
-- Name: transaction transaction_final_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.transaction
    ADD CONSTRAINT transaction_final_pkey PRIMARY KEY (id);


--
-- TOC entry 4119 (class 2606 OID 46321)
-- Name: school unique_school_location; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.school
    ADD CONSTRAINT unique_school_location UNIQUE (name, city, address);


--
-- TOC entry 4165 (class 2606 OID 46957)
-- Name: user user_invitation_code_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public."user"
    ADD CONSTRAINT user_invitation_code_key UNIQUE (invitation_code);


--
-- TOC entry 4168 (class 2606 OID 46323)
-- Name: user user_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public."user"
    ADD CONSTRAINT user_pkey PRIMARY KEY (id);


--
-- TOC entry 4269 (class 2606 OID 46996)
-- Name: user_session user_session_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_session
    ADD CONSTRAINT user_session_pkey PRIMARY KEY (id);


--
-- TOC entry 4177 (class 2606 OID 46325)
-- Name: webhook_log webhook_log_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.webhook_log
    ADD CONSTRAINT webhook_log_pkey PRIMARY KEY (id);


--
-- TOC entry 4184 (class 2606 OID 46327)
-- Name: workshop workshop_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.workshop
    ADD CONSTRAINT workshop_pkey PRIMARY KEY (id);


--
-- TOC entry 4215 (class 1259 OID 46783)
-- Name: content_topic_is_active_idx; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX content_topic_is_active_idx ON public.content_topic USING btree (is_active);


--
-- TOC entry 4218 (class 1259 OID 46782)
-- Name: content_topic_name_unique; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX content_topic_name_unique ON public.content_topic USING btree (name);


--
-- TOC entry 4039 (class 1259 OID 46330)
-- Name: curriculum_class_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX curriculum_class_id ON public.curriculum USING btree (class_id);


--
-- TOC entry 4040 (class 1259 OID 46331)
-- Name: curriculum_grade; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX curriculum_grade ON public.curriculum USING btree (grade);


--
-- TOC entry 4041 (class 1259 OID 46332)
-- Name: curriculum_is_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX curriculum_is_active ON public.curriculum USING btree (is_active);


--
-- TOC entry 4049 (class 1259 OID 46334)
-- Name: curriculum_item_curriculum_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX curriculum_item_curriculum_id ON public.curriculum_item USING btree (curriculum_id);


--
-- TOC entry 4050 (class 1259 OID 46335)
-- Name: curriculum_item_curriculum_id_custom_order; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX curriculum_item_curriculum_id_custom_order ON public.curriculum_item USING btree (curriculum_id, custom_order);


--
-- TOC entry 4051 (class 1259 OID 46336)
-- Name: curriculum_item_curriculum_id_mandatory_order; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX curriculum_item_curriculum_id_mandatory_order ON public.curriculum_item USING btree (curriculum_id, mandatory_order);


--
-- TOC entry 4052 (class 1259 OID 46337)
-- Name: curriculum_item_custom_order; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX curriculum_item_custom_order ON public.curriculum_item USING btree (custom_order);


--
-- TOC entry 4053 (class 1259 OID 46338)
-- Name: curriculum_item_is_completed; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX curriculum_item_is_completed ON public.curriculum_item USING btree (is_completed);


--
-- TOC entry 4054 (class 1259 OID 46339)
-- Name: curriculum_item_is_mandatory; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX curriculum_item_is_mandatory ON public.curriculum_item USING btree (is_mandatory);


--
-- TOC entry 4055 (class 1259 OID 46340)
-- Name: curriculum_item_mandatory_order; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX curriculum_item_mandatory_order ON public.curriculum_item USING btree (mandatory_order);


--
-- TOC entry 4058 (class 1259 OID 46341)
-- Name: curriculum_item_study_topic; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX curriculum_item_study_topic ON public.curriculum_item USING btree (study_topic);


--
-- TOC entry 4042 (class 1259 OID 46342)
-- Name: curriculum_original_curriculum_id_idx; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX curriculum_original_curriculum_id_idx ON public.curriculum USING btree (original_curriculum_id);


--
-- TOC entry 4059 (class 1259 OID 46343)
-- Name: curriculum_product_curriculum_item_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX curriculum_product_curriculum_item_id ON public.curriculum_product USING btree (curriculum_item_id);


--
-- TOC entry 4062 (class 1259 OID 46344)
-- Name: curriculum_product_product_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX curriculum_product_product_id ON public.curriculum_product USING btree (product_id);


--
-- TOC entry 4045 (class 1259 OID 46345)
-- Name: curriculum_subject; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX curriculum_subject ON public.curriculum USING btree (subject);


--
-- TOC entry 4046 (class 1259 OID 46346)
-- Name: curriculum_subject_grade; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX curriculum_subject_grade ON public.curriculum USING btree (subject, grade);


--
-- TOC entry 4047 (class 1259 OID 46347)
-- Name: curriculum_teacher_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX curriculum_teacher_user_id ON public.curriculum USING btree (teacher_user_id);


--
-- TOC entry 4048 (class 1259 OID 46348)
-- Name: curriculum_teacher_user_id_class_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX curriculum_teacher_user_id_class_id ON public.curriculum USING btree (teacher_user_id, class_id);


--
-- TOC entry 4063 (class 1259 OID 46349)
-- Name: file_is_asset_only; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX file_is_asset_only ON public.file USING btree (is_asset_only);


--
-- TOC entry 4232 (class 1259 OID 46953)
-- Name: gamelobby_expires_at_idx; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX gamelobby_expires_at_idx ON public.gamelobby USING btree (expires_at);


--
-- TOC entry 4233 (class 1259 OID 46919)
-- Name: gamelobby_game_id_idx; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX gamelobby_game_id_idx ON public.gamelobby USING btree (game_id);


--
-- TOC entry 4234 (class 1259 OID 46921)
-- Name: gamelobby_host_user_id_idx; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX gamelobby_host_user_id_idx ON public.gamelobby USING btree (host_user_id);


--
-- TOC entry 4237 (class 1259 OID 46922)
-- Name: gamelobby_lobby_code_unique; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX gamelobby_lobby_code_unique ON public.gamelobby USING btree (lobby_code);


--
-- TOC entry 4238 (class 1259 OID 46920)
-- Name: gamelobby_owner_user_id_idx; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX gamelobby_owner_user_id_idx ON public.gamelobby USING btree (owner_user_id);


--
-- TOC entry 4241 (class 1259 OID 46954)
-- Name: gamesession_expires_at_idx; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX gamesession_expires_at_idx ON public.gamesession USING btree (expires_at);


--
-- TOC entry 4242 (class 1259 OID 46951)
-- Name: gamesession_finished_at_idx; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX gamesession_finished_at_idx ON public.gamesession USING btree (finished_at);


--
-- TOC entry 4243 (class 1259 OID 46947)
-- Name: gamesession_lobby_id_idx; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX gamesession_lobby_id_idx ON public.gamesession USING btree (lobby_id);


--
-- TOC entry 4244 (class 1259 OID 46948)
-- Name: gamesession_lobby_session_unique; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX gamesession_lobby_session_unique ON public.gamesession USING btree (lobby_id, session_number);


--
-- TOC entry 4247 (class 1259 OID 46950)
-- Name: gamesession_started_at_idx; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX gamesession_started_at_idx ON public.gamesession USING btree (started_at);


--
-- TOC entry 4012 (class 1259 OID 46523)
-- Name: idx_audiofile_file_filename; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audiofile_file_filename ON public.audiofile USING btree (file_filename);


--
-- TOC entry 4013 (class 1259 OID 46522)
-- Name: idx_audiofile_has_file; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audiofile_has_file ON public.audiofile USING btree (has_file);


--
-- TOC entry 4018 (class 1259 OID 46350)
-- Name: idx_classroom_school_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_classroom_school_id ON public.classroom USING btree (school_id);


--
-- TOC entry 4019 (class 1259 OID 46351)
-- Name: idx_classroom_school_teacher; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_classroom_school_teacher ON public.classroom USING btree (school_id, teacher_id);


--
-- TOC entry 4020 (class 1259 OID 46352)
-- Name: idx_classroom_teacher_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_classroom_teacher_active ON public.classroom USING btree (teacher_id, is_active);


--
-- TOC entry 4021 (class 1259 OID 46353)
-- Name: idx_classroom_teacher_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_classroom_teacher_id ON public.classroom USING btree (teacher_id);


--
-- TOC entry 4024 (class 1259 OID 46354)
-- Name: idx_classroommembership_classroom_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_classroommembership_classroom_id ON public.classroommembership USING btree (classroom_id);


--
-- TOC entry 4025 (class 1259 OID 46355)
-- Name: idx_classroommembership_student_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_classroommembership_student_user_id ON public.classroommembership USING btree (student_user_id);


--
-- TOC entry 4028 (class 1259 OID 46356)
-- Name: idx_coupon_active_visibility; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_coupon_active_visibility ON public.coupon USING btree (is_active, visibility);


--
-- TOC entry 4029 (class 1259 OID 46357)
-- Name: idx_coupon_priority_level; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_coupon_priority_level ON public.coupon USING btree (priority_level);


--
-- TOC entry 4030 (class 1259 OID 46358)
-- Name: idx_coupon_targeting_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_coupon_targeting_type ON public.coupon USING btree (targeting_type);


--
-- TOC entry 4031 (class 1259 OID 46359)
-- Name: idx_coupon_valid_until; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_coupon_valid_until ON public.coupon USING btree (valid_until);


--
-- TOC entry 4032 (class 1259 OID 46360)
-- Name: idx_coupon_visibility; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_coupon_visibility ON public.coupon USING btree (visibility);


--
-- TOC entry 4035 (class 1259 OID 46361)
-- Name: idx_course_category; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_course_category ON public.course USING btree (category);


--
-- TOC entry 4036 (class 1259 OID 46515)
-- Name: idx_course_has_video; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_course_has_video ON public.course USING btree (has_video);


--
-- TOC entry 4037 (class 1259 OID 46362)
-- Name: idx_course_is_published; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_course_is_published ON public.course USING btree (is_published);


--
-- TOC entry 4038 (class 1259 OID 46516)
-- Name: idx_course_video_filename; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_course_video_filename ON public.course USING btree (video_filename);


--
-- TOC entry 4223 (class 1259 OID 46881)
-- Name: idx_edu_content_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_edu_content_created_at ON public.edu_content USING btree (created_at);


--
-- TOC entry 4224 (class 1259 OID 46879)
-- Name: idx_edu_content_element_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_edu_content_element_type ON public.edu_content USING btree (element_type);


--
-- TOC entry 4225 (class 1259 OID 46880)
-- Name: idx_edu_content_metadata; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_edu_content_metadata ON public.edu_content USING gin (content_metadata);


--
-- TOC entry 4228 (class 1259 OID 46884)
-- Name: idx_edu_content_use_contents_data; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_edu_content_use_contents_data ON public.edu_content_use USING gin (contents_data);


--
-- TOC entry 4229 (class 1259 OID 46885)
-- Name: idx_edu_content_use_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_edu_content_use_created_at ON public.edu_content_use USING btree (created_at);


--
-- TOC entry 4230 (class 1259 OID 46882)
-- Name: idx_edu_content_use_game_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_edu_content_use_game_id ON public.edu_content_use USING btree (game_id);


--
-- TOC entry 4231 (class 1259 OID 46883)
-- Name: idx_edu_content_use_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_edu_content_use_type ON public.edu_content_use USING btree (use_type);


--
-- TOC entry 4193 (class 1259 OID 46680)
-- Name: idx_emaillog_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_emaillog_created_at ON public.emaillog USING btree (created_at);


--
-- TOC entry 4194 (class 1259 OID 46675)
-- Name: idx_emaillog_recipient_email; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_emaillog_recipient_email ON public.emaillog USING btree (recipient_email);


--
-- TOC entry 4195 (class 1259 OID 46679)
-- Name: idx_emaillog_related_purchase_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_emaillog_related_purchase_id ON public.emaillog USING btree (related_purchase_id);


--
-- TOC entry 4196 (class 1259 OID 46677)
-- Name: idx_emaillog_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_emaillog_status ON public.emaillog USING btree (status);


--
-- TOC entry 4197 (class 1259 OID 46676)
-- Name: idx_emaillog_template_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_emaillog_template_id ON public.emaillog USING btree (template_id);


--
-- TOC entry 4198 (class 1259 OID 46678)
-- Name: idx_emaillog_trigger_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_emaillog_trigger_type ON public.emaillog USING btree (trigger_type);


--
-- TOC entry 4187 (class 1259 OID 46665)
-- Name: idx_emailtemplate_is_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_emailtemplate_is_active ON public.emailtemplate USING btree (is_active);


--
-- TOC entry 4188 (class 1259 OID 46667)
-- Name: idx_emailtemplate_send_to_admins; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_emailtemplate_send_to_admins ON public.emailtemplate USING btree (send_to_admins);


--
-- TOC entry 4189 (class 1259 OID 46666)
-- Name: idx_emailtemplate_trigger_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_emailtemplate_trigger_active ON public.emailtemplate USING btree (trigger_type, is_active);


--
-- TOC entry 4190 (class 1259 OID 46664)
-- Name: idx_emailtemplate_trigger_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_emailtemplate_trigger_type ON public.emailtemplate USING btree (trigger_type);


--
-- TOC entry 4066 (class 1259 OID 46649)
-- Name: idx_file_accessible_pages; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_file_accessible_pages ON public.file USING btree (accessible_pages);


--
-- TOC entry 4067 (class 1259 OID 46730)
-- Name: idx_file_branding_settings; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_file_branding_settings ON public.file USING btree (branding_settings);


--
-- TOC entry 4068 (class 1259 OID 46771)
-- Name: idx_file_branding_template_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_file_branding_template_id ON public.file USING btree (branding_template_id);


--
-- TOC entry 4069 (class 1259 OID 46363)
-- Name: idx_file_category; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_file_category ON public.file USING btree (category);


--
-- TOC entry 4070 (class 1259 OID 46646)
-- Name: idx_file_footer_template_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_file_footer_template_id ON public.file USING btree (branding_template_id);


--
-- TOC entry 4071 (class 1259 OID 46727)
-- Name: idx_file_target_format; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_file_target_format ON public.file USING btree (target_format);


--
-- TOC entry 4072 (class 1259 OID 46650)
-- Name: idx_file_watermark_template_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_file_watermark_template_id ON public.file USING btree (watermark_template_id);


--
-- TOC entry 4075 (class 1259 OID 46365)
-- Name: idx_game_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_game_type ON public.game USING btree (game_type);


--
-- TOC entry 4076 (class 1259 OID 46652)
-- Name: idx_lesson_plan_accessible_slides; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_lesson_plan_accessible_slides ON public.lesson_plan USING btree (accessible_slides);


--
-- TOC entry 4077 (class 1259 OID 46831)
-- Name: idx_lesson_plan_add_branding; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_lesson_plan_add_branding ON public.lesson_plan USING btree (add_branding);


--
-- TOC entry 4078 (class 1259 OID 46653)
-- Name: idx_lesson_plan_allow_slide_preview; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_lesson_plan_allow_slide_preview ON public.lesson_plan USING btree (allow_slide_preview);


--
-- TOC entry 4079 (class 1259 OID 46829)
-- Name: idx_lesson_plan_branding_template_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_lesson_plan_branding_template_id ON public.lesson_plan USING btree (branding_template_id);


--
-- TOC entry 4080 (class 1259 OID 46366)
-- Name: idx_lesson_plan_file_configs_gin; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_lesson_plan_file_configs_gin ON public.lesson_plan USING gin (file_configs);


--
-- TOC entry 4081 (class 1259 OID 46654)
-- Name: idx_lesson_plan_watermark_template_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_lesson_plan_watermark_template_id ON public.lesson_plan USING btree (watermark_template_id);


--
-- TOC entry 4086 (class 1259 OID 46367)
-- Name: idx_logs_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_logs_created_at ON public.logs USING btree (created_at);


--
-- TOC entry 4087 (class 1259 OID 46368)
-- Name: idx_logs_log_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_logs_log_type ON public.logs USING btree (log_type);


--
-- TOC entry 4088 (class 1259 OID 46369)
-- Name: idx_logs_source_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_logs_source_type ON public.logs USING btree (source_type);


--
-- TOC entry 4089 (class 1259 OID 46370)
-- Name: idx_logs_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_logs_user_id ON public.logs USING btree (user_id);


--
-- TOC entry 4282 (class 1259 OID 47215)
-- Name: idx_old_settings_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_old_settings_created_at ON public.old_settings USING btree (created_at);


--
-- TOC entry 4283 (class 1259 OID 47212)
-- Name: idx_old_settings_has_logo; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_old_settings_has_logo ON public.old_settings USING btree (has_logo);


--
-- TOC entry 4284 (class 1259 OID 47213)
-- Name: idx_old_settings_logo_filename; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_old_settings_logo_filename ON public.old_settings USING btree (logo_filename);


--
-- TOC entry 4285 (class 1259 OID 47214)
-- Name: idx_old_settings_maintenance_mode; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_old_settings_maintenance_mode ON public.old_settings USING btree (maintenance_mode);


--
-- TOC entry 4270 (class 1259 OID 47038)
-- Name: idx_player_display_name; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_player_display_name ON public.player USING btree (display_name);


--
-- TOC entry 4271 (class 1259 OID 47036)
-- Name: idx_player_last_seen; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_player_last_seen ON public.player USING btree (last_seen);


--
-- TOC entry 4272 (class 1259 OID 47035)
-- Name: idx_player_online; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_player_online ON public.player USING btree (is_online);


--
-- TOC entry 4273 (class 1259 OID 47031)
-- Name: idx_player_privacy_code; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX idx_player_privacy_code ON public.player USING btree (privacy_code);


--
-- TOC entry 4274 (class 1259 OID 47034)
-- Name: idx_player_teacher_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_player_teacher_active ON public.player USING btree (teacher_id, is_active);


--
-- TOC entry 4275 (class 1259 OID 47033)
-- Name: idx_player_teacher_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_player_teacher_id ON public.player USING btree (teacher_id);


--
-- TOC entry 4276 (class 1259 OID 47037)
-- Name: idx_player_teacher_online; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_player_teacher_online ON public.player USING btree (teacher_id, is_online);


--
-- TOC entry 4277 (class 1259 OID 47032)
-- Name: idx_player_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_player_user_id ON public.player USING btree (user_id);


--
-- TOC entry 4092 (class 1259 OID 46828)
-- Name: idx_product_content_topic_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_product_content_topic_id ON public.product USING btree (content_topic_id);


--
-- TOC entry 4093 (class 1259 OID 46509)
-- Name: idx_product_has_image; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_product_has_image ON public.product USING btree (has_image);


--
-- TOC entry 4094 (class 1259 OID 46510)
-- Name: idx_product_image_filename; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_product_image_filename ON public.product USING btree (image_filename);


--
-- TOC entry 4099 (class 1259 OID 46371)
-- Name: idx_purchase_access_expires; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_purchase_access_expires ON public.purchase USING btree (access_expires_at);


--
-- TOC entry 4100 (class 1259 OID 46372)
-- Name: idx_purchase_buyer_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_purchase_buyer_user_id ON public.purchase USING btree (buyer_user_id);


--
-- TOC entry 4101 (class 1259 OID 46373)
-- Name: idx_purchase_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_purchase_created_at ON public.purchase USING btree (created_at);


--
-- TOC entry 4102 (class 1259 OID 46374)
-- Name: idx_purchase_payment_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_purchase_payment_status ON public.purchase USING btree (payment_status);


--
-- TOC entry 4103 (class 1259 OID 46375)
-- Name: idx_purchase_polymorphic; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_purchase_polymorphic ON public.purchase USING btree (purchasable_type, purchasable_id);


--
-- TOC entry 4248 (class 1259 OID 46982)
-- Name: idx_refresh_token_expires_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_refresh_token_expires_at ON public.refresh_token USING btree (expires_at);


--
-- TOC entry 4249 (class 1259 OID 46983)
-- Name: idx_refresh_token_hash; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX idx_refresh_token_hash ON public.refresh_token USING btree (token_hash);


--
-- TOC entry 4250 (class 1259 OID 46984)
-- Name: idx_refresh_token_revoked_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_refresh_token_revoked_at ON public.refresh_token USING btree (revoked_at);


--
-- TOC entry 4251 (class 1259 OID 46985)
-- Name: idx_refresh_token_user_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_refresh_token_user_active ON public.refresh_token USING btree (user_id, revoked_at);


--
-- TOC entry 4252 (class 1259 OID 46981)
-- Name: idx_refresh_token_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_refresh_token_user_id ON public.refresh_token USING btree (user_id);


--
-- TOC entry 4106 (class 1259 OID 46376)
-- Name: idx_school_city; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_school_city ON public.school USING btree (city);


--
-- TOC entry 4107 (class 1259 OID 46377)
-- Name: idx_school_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_school_created_at ON public.school USING btree (created_at);


--
-- TOC entry 4108 (class 1259 OID 46378)
-- Name: idx_school_district; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_school_district ON public.school USING btree (district);


--
-- TOC entry 4109 (class 1259 OID 46379)
-- Name: idx_school_edu_system_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_school_edu_system_id ON public.school USING btree (edu_system_id);


--
-- TOC entry 4110 (class 1259 OID 46520)
-- Name: idx_school_has_logo; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_school_has_logo ON public.school USING btree (has_logo);


--
-- TOC entry 4111 (class 1259 OID 46380)
-- Name: idx_school_headmaster_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_school_headmaster_id ON public.school USING btree (school_headmaster_id);


--
-- TOC entry 4112 (class 1259 OID 46381)
-- Name: idx_school_institution_symbol; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX idx_school_institution_symbol ON public.school USING btree (institution_symbol);


--
-- TOC entry 4113 (class 1259 OID 46521)
-- Name: idx_school_logo_filename; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_school_logo_filename ON public.school USING btree (logo_filename);


--
-- TOC entry 4295 (class 1259 OID 47218)
-- Name: idx_settings_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_settings_created_at ON public.settings USING btree (created_at);


--
-- TOC entry 4296 (class 1259 OID 47216)
-- Name: idx_settings_key; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX idx_settings_key ON public.settings USING btree (key);


--
-- TOC entry 4297 (class 1259 OID 47217)
-- Name: idx_settings_value_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_settings_value_type ON public.settings USING btree (value_type);


--
-- TOC entry 4126 (class 1259 OID 46382)
-- Name: idx_subscription_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_subscription_created_at ON public.subscription USING btree (created_at);


--
-- TOC entry 4127 (class 1259 OID 46383)
-- Name: idx_subscription_next_billing; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_subscription_next_billing ON public.subscription USING btree (next_billing_date);


--
-- TOC entry 4128 (class 1259 OID 46384)
-- Name: idx_subscription_original_price; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_subscription_original_price ON public.subscription USING btree (original_price);


--
-- TOC entry 4129 (class 1259 OID 46385)
-- Name: idx_subscription_payplus_uid; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_subscription_payplus_uid ON public.subscription USING btree (payplus_subscription_uid);


--
-- TOC entry 4130 (class 1259 OID 46386)
-- Name: idx_subscription_plan_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_subscription_plan_id ON public.subscription USING btree (subscription_plan_id);


--
-- TOC entry 4131 (class 1259 OID 46387)
-- Name: idx_subscription_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_subscription_status ON public.subscription USING btree (status);


--
-- TOC entry 4132 (class 1259 OID 46388)
-- Name: idx_subscription_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_subscription_user_id ON public.subscription USING btree (user_id);


--
-- TOC entry 4135 (class 1259 OID 46389)
-- Name: idx_subscriptionhistory_action_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_subscriptionhistory_action_type ON public.subscriptionhistory USING btree (action_type);


--
-- TOC entry 4136 (class 1259 OID 46390)
-- Name: idx_subscriptionhistory_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_subscriptionhistory_created_at ON public.subscriptionhistory USING btree (created_at);


--
-- TOC entry 4137 (class 1259 OID 46391)
-- Name: idx_subscriptionhistory_payplus_uid; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_subscriptionhistory_payplus_uid ON public.subscriptionhistory USING btree (payplus_subscription_uid);


--
-- TOC entry 4138 (class 1259 OID 46392)
-- Name: idx_subscriptionhistory_plan_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_subscriptionhistory_plan_id ON public.subscriptionhistory USING btree (subscription_plan_id);


--
-- TOC entry 4139 (class 1259 OID 46393)
-- Name: idx_subscriptionhistory_subscription_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_subscriptionhistory_subscription_id ON public.subscriptionhistory USING btree (subscription_id);


--
-- TOC entry 4140 (class 1259 OID 46394)
-- Name: idx_subscriptionhistory_user_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_subscriptionhistory_user_date ON public.subscriptionhistory USING btree (user_id, created_at);


--
-- TOC entry 4141 (class 1259 OID 46395)
-- Name: idx_subscriptionhistory_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_subscriptionhistory_user_id ON public.subscriptionhistory USING btree (user_id);


--
-- TOC entry 4199 (class 1259 OID 46701)
-- Name: idx_supportmessage_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_supportmessage_created_at ON public.supportmessage USING btree (created_at);


--
-- TOC entry 4200 (class 1259 OID 46699)
-- Name: idx_supportmessage_email; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_supportmessage_email ON public.supportmessage USING btree (email);


--
-- TOC entry 4201 (class 1259 OID 46700)
-- Name: idx_supportmessage_is_read; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_supportmessage_is_read ON public.supportmessage USING btree (is_read);


--
-- TOC entry 4202 (class 1259 OID 46702)
-- Name: idx_supportmessage_read_created; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_supportmessage_read_created ON public.supportmessage USING btree (is_read, created_at);


--
-- TOC entry 4205 (class 1259 OID 46769)
-- Name: idx_system_templates_created_by; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_system_templates_created_by ON public.system_templates USING btree (created_by);


--
-- TOC entry 4206 (class 1259 OID 46765)
-- Name: idx_system_templates_default; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_system_templates_default ON public.system_templates USING btree (is_default);


--
-- TOC entry 4207 (class 1259 OID 46768)
-- Name: idx_system_templates_file_types; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_system_templates_file_types ON public.system_templates USING btree (target_file_types);


--
-- TOC entry 4208 (class 1259 OID 46764)
-- Name: idx_system_templates_format; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_system_templates_format ON public.system_templates USING btree (target_format);


--
-- TOC entry 4209 (class 1259 OID 46763)
-- Name: idx_system_templates_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_system_templates_type ON public.system_templates USING btree (template_type);


--
-- TOC entry 4210 (class 1259 OID 46766)
-- Name: idx_system_templates_type_default; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_system_templates_type_default ON public.system_templates USING btree (template_type, is_default);


--
-- TOC entry 4211 (class 1259 OID 46767)
-- Name: idx_system_templates_type_format; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_system_templates_type_format ON public.system_templates USING btree (template_type, target_format);


--
-- TOC entry 4152 (class 1259 OID 46396)
-- Name: idx_transaction_page_request_uid; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_transaction_page_request_uid ON public.transaction USING btree (page_request_uid);


--
-- TOC entry 4155 (class 1259 OID 46397)
-- Name: idx_user_email; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_email ON public."user" USING btree (email);


--
-- TOC entry 4156 (class 1259 OID 46958)
-- Name: idx_user_invitation_code; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX idx_user_invitation_code ON public."user" USING btree (invitation_code);


--
-- TOC entry 4157 (class 1259 OID 46398)
-- Name: idx_user_is_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_is_active ON public."user" USING btree (is_active);


--
-- TOC entry 4158 (class 1259 OID 46399)
-- Name: idx_user_role; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_role ON public."user" USING btree (role);


--
-- TOC entry 4159 (class 1259 OID 46400)
-- Name: idx_user_school_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_school_id ON public."user" USING btree (school_id);


--
-- TOC entry 4160 (class 1259 OID 46401)
-- Name: idx_user_school_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_school_type ON public."user" USING btree (school_id, user_type);


--
-- TOC entry 4255 (class 1259 OID 47003)
-- Name: idx_user_session_expires_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_session_expires_at ON public.user_session USING btree (expires_at);


--
-- TOC entry 4256 (class 1259 OID 47004)
-- Name: idx_user_session_is_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_session_is_active ON public.user_session USING btree (is_active);


--
-- TOC entry 4257 (class 1259 OID 47005)
-- Name: idx_user_session_last_accessed; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_session_last_accessed ON public.user_session USING btree (last_accessed_at);


--
-- TOC entry 4258 (class 1259 OID 47051)
-- Name: idx_user_session_player_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_session_player_active ON public.user_session USING btree (player_id, is_active);


--
-- TOC entry 4259 (class 1259 OID 47052)
-- Name: idx_user_session_player_expires; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_session_player_expires ON public.user_session USING btree (player_id, expires_at);


--
-- TOC entry 4260 (class 1259 OID 47050)
-- Name: idx_user_session_player_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_session_player_id ON public.user_session USING btree (player_id);


--
-- TOC entry 4261 (class 1259 OID 47067)
-- Name: idx_user_session_portal; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_session_portal ON public.user_session USING btree (portal);


--
-- TOC entry 4262 (class 1259 OID 47070)
-- Name: idx_user_session_portal_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_session_portal_active ON public.user_session USING btree (portal, is_active);


--
-- TOC entry 4263 (class 1259 OID 47069)
-- Name: idx_user_session_portal_player; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_session_portal_player ON public.user_session USING btree (portal, player_id);


--
-- TOC entry 4264 (class 1259 OID 47068)
-- Name: idx_user_session_portal_user; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_session_portal_user ON public.user_session USING btree (portal, user_id);


--
-- TOC entry 4265 (class 1259 OID 47006)
-- Name: idx_user_session_user_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_session_user_active ON public.user_session USING btree (user_id, is_active);


--
-- TOC entry 4266 (class 1259 OID 47007)
-- Name: idx_user_session_user_expires; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_session_user_expires ON public.user_session USING btree (user_id, expires_at);


--
-- TOC entry 4267 (class 1259 OID 47002)
-- Name: idx_user_session_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_session_user_id ON public.user_session USING btree (user_id);


--
-- TOC entry 4161 (class 1259 OID 46402)
-- Name: idx_user_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_type ON public."user" USING btree (user_type);


--
-- TOC entry 4169 (class 1259 OID 46403)
-- Name: idx_webhook_log_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_webhook_log_created_at ON public.webhook_log USING btree (created_at);


--
-- TOC entry 4170 (class 1259 OID 46404)
-- Name: idx_webhook_log_page_request_uid; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_webhook_log_page_request_uid ON public.webhook_log USING btree (page_request_uid);


--
-- TOC entry 4171 (class 1259 OID 46405)
-- Name: idx_webhook_log_payplus_transaction_uid; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_webhook_log_payplus_transaction_uid ON public.webhook_log USING btree (payplus_transaction_uid);


--
-- TOC entry 4172 (class 1259 OID 46406)
-- Name: idx_webhook_log_provider; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_webhook_log_provider ON public.webhook_log USING btree (provider);


--
-- TOC entry 4173 (class 1259 OID 46407)
-- Name: idx_webhook_log_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_webhook_log_status ON public.webhook_log USING btree (status);


--
-- TOC entry 4174 (class 1259 OID 46408)
-- Name: idx_webhook_log_subscription_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_webhook_log_subscription_id ON public.webhook_log USING btree (subscription_id);


--
-- TOC entry 4175 (class 1259 OID 46409)
-- Name: idx_webhook_log_transaction_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_webhook_log_transaction_id ON public.webhook_log USING btree (transaction_id);


--
-- TOC entry 4178 (class 1259 OID 46410)
-- Name: idx_workshop_category; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_workshop_category ON public.workshop USING btree (category);


--
-- TOC entry 4179 (class 1259 OID 46513)
-- Name: idx_workshop_has_video; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_workshop_has_video ON public.workshop USING btree (has_video);


--
-- TOC entry 4180 (class 1259 OID 46411)
-- Name: idx_workshop_is_published; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_workshop_is_published ON public.workshop USING btree (is_published);


--
-- TOC entry 4181 (class 1259 OID 46412)
-- Name: idx_workshop_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_workshop_type ON public.workshop USING btree (workshop_type);


--
-- TOC entry 4182 (class 1259 OID 46514)
-- Name: idx_workshop_video_filename; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_workshop_video_filename ON public.workshop USING btree (video_filename);


--
-- TOC entry 4082 (class 1259 OID 46413)
-- Name: lesson_plan_context; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX lesson_plan_context ON public.lesson_plan USING btree (context);


--
-- TOC entry 4083 (class 1259 OID 46414)
-- Name: lesson_plan_is_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX lesson_plan_is_active ON public.lesson_plan USING btree (is_active);


--
-- TOC entry 4286 (class 1259 OID 47172)
-- Name: settings_available_dashboard_widgets_idx; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX settings_available_dashboard_widgets_idx ON public.old_settings USING gin (available_dashboard_widgets);


--
-- TOC entry 4287 (class 1259 OID 47173)
-- Name: settings_has_logo_idx; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX settings_has_logo_idx ON public.old_settings USING btree (has_logo);


--
-- TOC entry 4288 (class 1259 OID 47174)
-- Name: settings_logo_filename_idx; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX settings_logo_filename_idx ON public.old_settings USING btree (logo_filename);


--
-- TOC entry 4120 (class 1259 OID 46416)
-- Name: studentinvitation_classroom_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX studentinvitation_classroom_id ON public.studentinvitation USING btree (classroom_id);


--
-- TOC entry 4123 (class 1259 OID 46417)
-- Name: studentinvitation_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX studentinvitation_status ON public.studentinvitation USING btree (status);


--
-- TOC entry 4124 (class 1259 OID 46418)
-- Name: studentinvitation_student_email; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX studentinvitation_student_email ON public.studentinvitation USING btree (student_email);


--
-- TOC entry 4125 (class 1259 OID 46419)
-- Name: studentinvitation_teacher_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX studentinvitation_teacher_id ON public.studentinvitation USING btree (teacher_id);


--
-- TOC entry 4146 (class 1259 OID 46420)
-- Name: tool_category_idx; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX tool_category_idx ON public.tool USING btree (category);


--
-- TOC entry 4151 (class 1259 OID 46421)
-- Name: tool_tool_key_unique; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX tool_tool_key_unique ON public.tool USING btree (tool_key);


--
-- TOC entry 4214 (class 1259 OID 46770)
-- Name: unique_default_per_type_format; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX unique_default_per_type_format ON public.system_templates USING btree (template_type, target_format, is_default) WHERE (is_default = true);


--
-- TOC entry 4162 (class 1259 OID 46422)
-- Name: user_birth_date_idx; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX user_birth_date_idx ON public."user" USING btree (birth_date);


--
-- TOC entry 4163 (class 1259 OID 46423)
-- Name: user_dashboard_settings_index; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX user_dashboard_settings_index ON public."user" USING gin (dashboard_settings);


--
-- TOC entry 4166 (class 1259 OID 46424)
-- Name: user_onboarding_completed_index; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX user_onboarding_completed_index ON public."user" USING btree (onboarding_completed);


--
-- TOC entry 4298 (class 2606 OID 46425)
-- Name: classroom classroom_school_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.classroom
    ADD CONSTRAINT classroom_school_id_fkey FOREIGN KEY (school_id) REFERENCES public.school(id);


--
-- TOC entry 4299 (class 2606 OID 46430)
-- Name: curriculum curriculum_class_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.curriculum
    ADD CONSTRAINT curriculum_class_id_fkey FOREIGN KEY (class_id) REFERENCES public.classroom(id) ON UPDATE CASCADE ON DELETE CASCADE;


--
-- TOC entry 4302 (class 2606 OID 46435)
-- Name: curriculum_item curriculum_item_curriculum_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.curriculum_item
    ADD CONSTRAINT curriculum_item_curriculum_id_fkey FOREIGN KEY (curriculum_id) REFERENCES public.curriculum(id) ON UPDATE CASCADE ON DELETE CASCADE;


--
-- TOC entry 4300 (class 2606 OID 46440)
-- Name: curriculum curriculum_original_curriculum_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.curriculum
    ADD CONSTRAINT curriculum_original_curriculum_id_fkey FOREIGN KEY (original_curriculum_id) REFERENCES public.curriculum(id);


--
-- TOC entry 4303 (class 2606 OID 46445)
-- Name: curriculum_product curriculum_product_curriculum_item_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.curriculum_product
    ADD CONSTRAINT curriculum_product_curriculum_item_id_fkey FOREIGN KEY (curriculum_item_id) REFERENCES public.curriculum_item(id) ON UPDATE CASCADE ON DELETE CASCADE;


--
-- TOC entry 4304 (class 2606 OID 46450)
-- Name: curriculum_product curriculum_product_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.curriculum_product
    ADD CONSTRAINT curriculum_product_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.product(id) ON UPDATE CASCADE ON DELETE CASCADE;


--
-- TOC entry 4301 (class 2606 OID 46455)
-- Name: curriculum curriculum_teacher_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.curriculum
    ADD CONSTRAINT curriculum_teacher_user_id_fkey FOREIGN KEY (teacher_user_id) REFERENCES public."user"(id) ON UPDATE CASCADE ON DELETE SET NULL;


--
-- TOC entry 4316 (class 2606 OID 46874)
-- Name: edu_content_use edu_content_use_game_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.edu_content_use
    ADD CONSTRAINT edu_content_use_game_id_fkey FOREIGN KEY (game_id) REFERENCES public.game(id) ON DELETE CASCADE;


--
-- TOC entry 4314 (class 2606 OID 46686)
-- Name: emaillog fk_emaillog_purchase; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.emaillog
    ADD CONSTRAINT fk_emaillog_purchase FOREIGN KEY (related_purchase_id) REFERENCES public.purchase(id) ON UPDATE CASCADE ON DELETE SET NULL;


--
-- TOC entry 4315 (class 2606 OID 46681)
-- Name: emaillog fk_emaillog_template; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.emaillog
    ADD CONSTRAINT fk_emaillog_template FOREIGN KEY (template_id) REFERENCES public.emailtemplate(id) ON UPDATE CASCADE ON DELETE SET NULL;


--
-- TOC entry 4317 (class 2606 OID 46904)
-- Name: gamelobby gamelobby_game_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.gamelobby
    ADD CONSTRAINT gamelobby_game_id_fkey FOREIGN KEY (game_id) REFERENCES public.game(id) ON DELETE CASCADE;


--
-- TOC entry 4318 (class 2606 OID 46914)
-- Name: gamelobby gamelobby_host_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.gamelobby
    ADD CONSTRAINT gamelobby_host_user_id_fkey FOREIGN KEY (host_user_id) REFERENCES public."user"(id) ON DELETE CASCADE;


--
-- TOC entry 4319 (class 2606 OID 46909)
-- Name: gamelobby gamelobby_owner_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.gamelobby
    ADD CONSTRAINT gamelobby_owner_user_id_fkey FOREIGN KEY (owner_user_id) REFERENCES public."user"(id) ON DELETE CASCADE;


--
-- TOC entry 4320 (class 2606 OID 46942)
-- Name: gamesession gamesession_lobby_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.gamesession
    ADD CONSTRAINT gamesession_lobby_id_fkey FOREIGN KEY (lobby_id) REFERENCES public.gamelobby(id) ON DELETE CASCADE;


--
-- TOC entry 4325 (class 2606 OID 47026)
-- Name: player player_teacher_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.player
    ADD CONSTRAINT player_teacher_id_fkey FOREIGN KEY (teacher_id) REFERENCES public."user"(id) ON UPDATE CASCADE ON DELETE SET NULL;


--
-- TOC entry 4326 (class 2606 OID 47021)
-- Name: player player_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.player
    ADD CONSTRAINT player_user_id_fkey FOREIGN KEY (user_id) REFERENCES public."user"(id) ON UPDATE CASCADE ON DELETE SET NULL;


--
-- TOC entry 4305 (class 2606 OID 46823)
-- Name: product product_content_topic_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.product
    ADD CONSTRAINT product_content_topic_id_fkey FOREIGN KEY (content_topic_id) REFERENCES public.content_topic(id) ON UPDATE CASCADE ON DELETE SET NULL;


--
-- TOC entry 4306 (class 2606 OID 46465)
-- Name: purchase purchase_buyer_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.purchase
    ADD CONSTRAINT purchase_buyer_user_id_fkey FOREIGN KEY (buyer_user_id) REFERENCES public."user"(id);


--
-- TOC entry 4321 (class 2606 OID 46976)
-- Name: refresh_token refresh_token_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.refresh_token
    ADD CONSTRAINT refresh_token_user_id_fkey FOREIGN KEY (user_id) REFERENCES public."user"(id) ON UPDATE CASCADE ON DELETE CASCADE;


--
-- TOC entry 4307 (class 2606 OID 46470)
-- Name: school school_school_headmaster_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.school
    ADD CONSTRAINT school_school_headmaster_id_fkey FOREIGN KEY (school_headmaster_id) REFERENCES public."user"(id);


--
-- TOC entry 4308 (class 2606 OID 46475)
-- Name: subscription subscription_subscription_plan_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.subscription
    ADD CONSTRAINT subscription_subscription_plan_id_fkey FOREIGN KEY (subscription_plan_id) REFERENCES public.subscriptionplan(id);


--
-- TOC entry 4309 (class 2606 OID 46480)
-- Name: subscription subscription_transaction_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.subscription
    ADD CONSTRAINT subscription_transaction_id_fkey FOREIGN KEY (transaction_id) REFERENCES public.transaction(id);


--
-- TOC entry 4310 (class 2606 OID 46485)
-- Name: subscription subscription_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.subscription
    ADD CONSTRAINT subscription_user_id_fkey FOREIGN KEY (user_id) REFERENCES public."user"(id);


--
-- TOC entry 4311 (class 2606 OID 46490)
-- Name: user user_school_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public."user"
    ADD CONSTRAINT user_school_id_fkey FOREIGN KEY (school_id) REFERENCES public.school(id);


--
-- TOC entry 4322 (class 2606 OID 47044)
-- Name: user_session user_session_player_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_session
    ADD CONSTRAINT user_session_player_id_fkey FOREIGN KEY (player_id) REFERENCES public.player(id) ON UPDATE CASCADE ON DELETE CASCADE;


--
-- TOC entry 4323 (class 2606 OID 46997)
-- Name: user_session user_session_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_session
    ADD CONSTRAINT user_session_user_id_fkey FOREIGN KEY (user_id) REFERENCES public."user"(id) ON UPDATE CASCADE ON DELETE CASCADE;


--
-- TOC entry 4324 (class 2606 OID 47039)
-- Name: user_session user_session_user_id_fkey1; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.user_session
    ADD CONSTRAINT user_session_user_id_fkey1 FOREIGN KEY (user_id) REFERENCES public."user"(id) ON UPDATE CASCADE ON DELETE CASCADE;


--
-- TOC entry 4312 (class 2606 OID 46495)
-- Name: webhook_log webhook_log_subscription_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.webhook_log
    ADD CONSTRAINT webhook_log_subscription_id_fkey FOREIGN KEY (subscription_id) REFERENCES public.subscription(id) ON UPDATE CASCADE ON DELETE SET NULL;


--
-- TOC entry 4313 (class 2606 OID 46500)
-- Name: webhook_log webhook_log_transaction_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.webhook_log
    ADD CONSTRAINT webhook_log_transaction_id_fkey FOREIGN KEY (transaction_id) REFERENCES public.transaction(id) ON UPDATE CASCADE ON DELETE SET NULL;


-- Completed on 2025-11-24 12:46:41 +07

--
-- PostgreSQL database dump complete
--

\unrestrict UCQpX4K5GFk2Uz8aPXBHigptKlDs2DJLPvXihDUMQUbjUdNfk42D4HVEp7kO88d

