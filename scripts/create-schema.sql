-- Ludora Database Schema - Consolidated Version
-- Generated: Fri Nov  7 16:16:04 +07 2025
-- Source: development database ludora_development
--
-- This schema represents the consolidated structure after all migrations
-- have been applied. It replaces the original create-schema.sql and the
-- complex migration chain with a single, clean schema definition.
--
-- DO NOT EDIT THIS FILE MANUALLY
-- This file is generated by the consolidation process

-- Ensure we're using the correct database
\connect ludora_development;
-- Started on 2025-11-07 16:16:04 +07

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;

--
-- TOC entry 4333 (class 0 OID 0)
-- Dependencies: 5
-- Name: SCHEMA public; Type: COMMENT; Schema: -; Owner: -
--

COMMENT ON SCHEMA public IS '';


--
-- TOC entry 1005 (class 1247 OID 46609)
-- Name: enum_game_content_link_link_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_game_content_link_link_type AS ENUM (
    'content',
    'relation'
);


--
-- TOC entry 999 (class 1247 OID 46579)
-- Name: enum_game_content_relation_items_role; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_game_content_relation_items_role AS ENUM (
    'source',
    'target',
    'question',
    'answer',
    'distractor',
    'pair_a',
    'pair_b'
);


--
-- TOC entry 993 (class 1247 OID 46552)
-- Name: enum_game_content_relation_relation_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_game_content_relation_relation_type AS ENUM (
    'translation',
    'antonym',
    'synonym',
    'similar_meaning',
    'question_answer',
    'answer_question',
    'distractor'
);


--
-- TOC entry 873 (class 1247 OID 45887)
-- Name: enum_game_content_rule_instance_rule_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_game_content_rule_instance_rule_type AS ENUM (
    'attribute_based',
    'content_list',
    'complex_attribute',
    'relation_based'
);


--
-- TOC entry 876 (class 1247 OID 45896)
-- Name: enum_game_content_rule_rule_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_game_content_rule_rule_type AS ENUM (
    'attribute_based',
    'content_list',
    'complex_attribute',
    'relation_based'
);


--
-- TOC entry 879 (class 1247 OID 45906)
-- Name: enum_memory_pairing_rules_rule_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_memory_pairing_rules_rule_type AS ENUM (
    'manual_pairs',
    'attribute_match',
    'content_type_match',
    'semantic_match'
);


--
-- TOC entry 882 (class 1247 OID 45916)
-- Name: enum_product_marketing_video_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_product_marketing_video_type AS ENUM (
    'youtube',
    'uploaded'
);


--
-- TOC entry 885 (class 1247 OID 45922)
-- Name: enum_subscription_status; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_subscription_status AS ENUM (
    'pending',
    'active',
    'cancelled',
    'expired',
    'failed'
);


--
-- TOC entry 888 (class 1247 OID 45934)
-- Name: enum_subscriptionhistory_action_type; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_subscriptionhistory_action_type AS ENUM (
    'started',
    'upgraded',
    'downgraded',
    'cancelled',
    'renewed',
    'expired',
    'failed'
);


--
-- TOC entry 891 (class 1247 OID 45950)
-- Name: enum_transaction_environment; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_transaction_environment AS ENUM (
    'production',
    'staging',
    'development'
);


--
-- TOC entry 894 (class 1247 OID 45958)
-- Name: enum_transaction_final_environment; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_transaction_final_environment AS ENUM (
    'production',
    'staging'
);


--
-- TOC entry 897 (class 1247 OID 45964)
-- Name: enum_transaction_final_payment_status; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_transaction_final_payment_status AS ENUM (
    'pending',
    'completed',
    'failed',
    'cancelled',
    'refunded'
);


--
-- TOC entry 900 (class 1247 OID 45976)
-- Name: enum_transaction_payment_status; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_transaction_payment_status AS ENUM (
    'pending',
    'completed',
    'failed',
    'cancelled',
    'refunded'
);


--
-- TOC entry 903 (class 1247 OID 45988)
-- Name: enum_transaction_temp_environment; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_transaction_temp_environment AS ENUM (
    'production',
    'staging'
);


--
-- TOC entry 906 (class 1247 OID 45994)
-- Name: enum_transaction_temp_payment_status; Type: TYPE; Schema: public; Owner: -
--

CREATE TYPE public.enum_transaction_temp_payment_status AS ENUM (
    'pending',
    'completed',
    'failed',
    'cancelled',
    'refunded'
);


SET default_tablespace = '';

SET default_table_access_method = heap;

--
-- TOC entry 214 (class 1259 OID 46005)
-- Name: SequelizeMeta; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public."SequelizeMeta" (
    name character varying(255) NOT NULL
);


--
-- TOC entry 215 (class 1259 OID 46008)
-- Name: audiofile; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.audiofile (
    id character varying(255) NOT NULL,
    name character varying(255),
    file_url character varying(500),
    duration numeric,
    volume numeric,
    file_size numeric,
    file_type character varying(255),
    is_default_for jsonb,
    is_sample boolean,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    has_file boolean DEFAULT false NOT NULL,
    file_filename character varying(255)
);


--
-- TOC entry 4334 (class 0 OID 0)
-- Dependencies: 215
-- Name: COLUMN audiofile.file_url; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.audiofile.file_url IS 'DEPRECATED: Use has_file and file_filename instead. Kept for backward compatibility.';


--
-- TOC entry 4335 (class 0 OID 0)
-- Dependencies: 215
-- Name: COLUMN audiofile.has_file; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.audiofile.has_file IS 'Clear boolean indicator for audio file existence';


--
-- TOC entry 4336 (class 0 OID 0)
-- Dependencies: 215
-- Name: COLUMN audiofile.file_filename; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.audiofile.file_filename IS 'Standardized audio filename storage (replaces file_url)';


--
-- TOC entry 216 (class 1259 OID 46015)
-- Name: category; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.category (
    id character varying(255) NOT NULL,
    name character varying(255),
    is_default boolean,
    is_sample boolean,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- TOC entry 217 (class 1259 OID 46022)
-- Name: classroom; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.classroom (
    id character varying(255) NOT NULL,
    name character varying(255),
    grade_level character varying(255),
    year character varying(255),
    teacher_id character varying(255),
    description character varying(255),
    is_active boolean,
    is_sample boolean,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    school_id character varying(255)
);


--
-- TOC entry 4337 (class 0 OID 0)
-- Dependencies: 217
-- Name: COLUMN classroom.school_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.classroom.school_id IS 'School that this classroom belongs to';


--
-- TOC entry 218 (class 1259 OID 46029)
-- Name: classroommembership; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.classroommembership (
    id character varying(255) NOT NULL,
    classroom_id character varying(255),
    student_user_id character varying(255),
    teacher_id character varying(255),
    joined_at character varying(255),
    status character varying(255),
    notes character varying(255),
    student_display_name character varying(255),
    is_sample boolean,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- TOC entry 219 (class 1259 OID 46048)
-- Name: coupon; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.coupon (
    id character varying(255) NOT NULL,
    code character varying(255),
    name character varying(255),
    description character varying(255),
    discount_type character varying(255),
    discount_value numeric(10,2),
    minimum_amount numeric(10,2),
    usage_limit integer,
    usage_count integer DEFAULT 0,
    valid_until timestamp with time zone,
    is_visible boolean DEFAULT true,
    is_admin_only boolean DEFAULT false,
    allow_stacking boolean DEFAULT false,
    stackable_with jsonb,
    applicable_categories jsonb,
    applicable_workshops jsonb,
    workshop_types jsonb,
    is_active boolean DEFAULT true,
    is_sample boolean,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    targeting_type character varying(255) DEFAULT 'general'::character varying,
    target_product_types jsonb DEFAULT '"[]"'::jsonb,
    target_product_ids jsonb DEFAULT '"[]"'::jsonb,
    visibility character varying(255) DEFAULT 'secret'::character varying,
    user_segments jsonb DEFAULT '"[]"'::jsonb,
    priority_level integer DEFAULT 5,
    max_discount_cap numeric(10,2),
    minimum_quantity integer DEFAULT 1,
    code_pattern character varying(255),
    auto_generated boolean DEFAULT false
);


--
-- TOC entry 220 (class 1259 OID 46068)
-- Name: course; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.course (
    id character varying(255) NOT NULL,
    title character varying(255) NOT NULL,
    description text,
    short_description text,
    category character varying(255),
    price numeric DEFAULT '0'::numeric NOT NULL,
    is_published boolean DEFAULT false NOT NULL,
    image_url character varying(255),
    image_is_private boolean DEFAULT false,
    tags jsonb,
    target_audience character varying(255),
    difficulty_level character varying(255),
    access_days integer,
    is_lifetime_access boolean DEFAULT false,
    course_modules jsonb DEFAULT '[]'::jsonb,
    total_duration_minutes integer,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    has_video boolean DEFAULT false NOT NULL,
    video_filename character varying(255)
);


--
-- TOC entry 4338 (class 0 OID 0)
-- Dependencies: 220
-- Name: TABLE course; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.course IS 'Educational courses available in the platform';


--
-- TOC entry 4339 (class 0 OID 0)
-- Dependencies: 220
-- Name: COLUMN course.has_video; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.course.has_video IS 'Clear boolean indicator for content video existence';


--
-- TOC entry 4340 (class 0 OID 0)
-- Dependencies: 220
-- Name: COLUMN course.video_filename; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.course.video_filename IS 'Standardized video filename storage for course content';


--
-- TOC entry 221 (class 1259 OID 46078)
-- Name: curriculum; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.curriculum (
    id character varying(255) NOT NULL,
    subject character varying(255) NOT NULL,
    grade integer NOT NULL,
    teacher_user_id character varying(255),
    class_id character varying(255),
    is_active boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    original_curriculum_id character varying(255),
    grade_from integer,
    grade_to integer,
    is_grade_range boolean DEFAULT false NOT NULL
);


--
-- TOC entry 4341 (class 0 OID 0)
-- Dependencies: 221
-- Name: COLUMN curriculum.subject; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.curriculum.subject IS 'Study subject from STUDY_SUBJECTS constant';


--
-- TOC entry 4342 (class 0 OID 0)
-- Dependencies: 221
-- Name: COLUMN curriculum.grade; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.curriculum.grade IS 'Grade level 1-12';


--
-- TOC entry 4343 (class 0 OID 0)
-- Dependencies: 221
-- Name: COLUMN curriculum.teacher_user_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.curriculum.teacher_user_id IS 'null = system default curriculum';


--
-- TOC entry 4344 (class 0 OID 0)
-- Dependencies: 221
-- Name: COLUMN curriculum.class_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.curriculum.class_id IS 'null = system default curriculum';


--
-- TOC entry 4345 (class 0 OID 0)
-- Dependencies: 221
-- Name: COLUMN curriculum.original_curriculum_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.curriculum.original_curriculum_id IS 'ID of the system curriculum this was copied from (null for system curricula)';


--
-- TOC entry 4346 (class 0 OID 0)
-- Dependencies: 221
-- Name: COLUMN curriculum.grade_from; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.curriculum.grade_from IS 'Starting grade for range (1-12)';


--
-- TOC entry 4347 (class 0 OID 0)
-- Dependencies: 221
-- Name: COLUMN curriculum.grade_to; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.curriculum.grade_to IS 'Ending grade for range (1-12)';


--
-- TOC entry 4348 (class 0 OID 0)
-- Dependencies: 221
-- Name: COLUMN curriculum.is_grade_range; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.curriculum.is_grade_range IS 'Whether this curriculum applies to a grade range or single grade';


--
-- TOC entry 222 (class 1259 OID 46085)
-- Name: curriculum_item; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.curriculum_item (
    id character varying(255) NOT NULL,
    curriculum_id character varying(255) NOT NULL,
    study_topic character varying(255) NOT NULL,
    content_topic character varying(255) NOT NULL,
    is_mandatory boolean DEFAULT true NOT NULL,
    mandatory_order integer,
    custom_order integer,
    description text,
    is_completed boolean DEFAULT false NOT NULL,
    completed_at timestamp with time zone,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL
);


--
-- TOC entry 4349 (class 0 OID 0)
-- Dependencies: 222
-- Name: COLUMN curriculum_item.study_topic; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.curriculum_item.study_topic IS 'Main study topic';


--
-- TOC entry 4350 (class 0 OID 0)
-- Dependencies: 222
-- Name: COLUMN curriculum_item.content_topic; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.curriculum_item.content_topic IS 'Specific content topic within study topic';


--
-- TOC entry 4351 (class 0 OID 0)
-- Dependencies: 222
-- Name: COLUMN curriculum_item.is_mandatory; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.curriculum_item.is_mandatory IS 'Whether this item is mandatory or optional';


--
-- TOC entry 4352 (class 0 OID 0)
-- Dependencies: 222
-- Name: COLUMN curriculum_item.mandatory_order; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.curriculum_item.mandatory_order IS 'Order for mandatory items';


--
-- TOC entry 4353 (class 0 OID 0)
-- Dependencies: 222
-- Name: COLUMN curriculum_item.custom_order; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.curriculum_item.custom_order IS 'Custom order set by teacher';


--
-- TOC entry 4354 (class 0 OID 0)
-- Dependencies: 222
-- Name: COLUMN curriculum_item.description; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.curriculum_item.description IS 'Additional description or notes';


--
-- TOC entry 4355 (class 0 OID 0)
-- Dependencies: 222
-- Name: COLUMN curriculum_item.is_completed; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.curriculum_item.is_completed IS 'Whether teacher has marked this as learned/completed';


--
-- TOC entry 4356 (class 0 OID 0)
-- Dependencies: 222
-- Name: COLUMN curriculum_item.completed_at; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.curriculum_item.completed_at IS 'When the item was marked as completed';


--
-- TOC entry 223 (class 1259 OID 46092)
-- Name: curriculum_product; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.curriculum_product (
    curriculum_item_id character varying(255) NOT NULL,
    product_id character varying(255) NOT NULL,
    created_at timestamp with time zone NOT NULL,
    id character varying(255) NOT NULL
);


--
-- TOC entry 4357 (class 0 OID 0)
-- Dependencies: 223
-- Name: COLUMN curriculum_product.id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.curriculum_product.id IS 'Primary key for curriculum-product association';


--
-- TOC entry 224 (class 1259 OID 46097)
-- Name: curriculum_product_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.curriculum_product_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- TOC entry 4358 (class 0 OID 0)
-- Dependencies: 224
-- Name: curriculum_product_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.curriculum_product_id_seq OWNED BY public.curriculum_product.id;


--
-- TOC entry 249 (class 1259 OID 46668)
-- Name: emaillog; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.emaillog (
    id character varying(255) NOT NULL,
    template_id character varying(255),
    recipient_email character varying(255),
    subject character varying(255),
    content text,
    trigger_type character varying(255),
    related_product_id character varying(255),
    related_registration_id character varying(255),
    related_purchase_id character varying(255),
    status character varying(255),
    error_message character varying(255),
    scheduled_for character varying(255),
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL
);


--
-- TOC entry 4359 (class 0 OID 0)
-- Dependencies: 249
-- Name: COLUMN emaillog.template_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emaillog.template_id IS 'Reference to emailtemplate used for this email';


--
-- TOC entry 4360 (class 0 OID 0)
-- Dependencies: 249
-- Name: COLUMN emaillog.recipient_email; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emaillog.recipient_email IS 'Email address of the recipient';


--
-- TOC entry 4361 (class 0 OID 0)
-- Dependencies: 249
-- Name: COLUMN emaillog.subject; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emaillog.subject IS 'Actual email subject that was sent';


--
-- TOC entry 4362 (class 0 OID 0)
-- Dependencies: 249
-- Name: COLUMN emaillog.content; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emaillog.content IS 'Actual email content that was sent';


--
-- TOC entry 4363 (class 0 OID 0)
-- Dependencies: 249
-- Name: COLUMN emaillog.trigger_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emaillog.trigger_type IS 'Event that triggered this email (registration_confirmation, payment_confirmation, etc.)';


--
-- TOC entry 4364 (class 0 OID 0)
-- Dependencies: 249
-- Name: COLUMN emaillog.related_product_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emaillog.related_product_id IS 'Product related to this email (if applicable)';


--
-- TOC entry 4365 (class 0 OID 0)
-- Dependencies: 249
-- Name: COLUMN emaillog.related_registration_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emaillog.related_registration_id IS 'Registration related to this email (if applicable) - DEPRECATED';


--
-- TOC entry 4366 (class 0 OID 0)
-- Dependencies: 249
-- Name: COLUMN emaillog.related_purchase_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emaillog.related_purchase_id IS 'Purchase transaction related to this email';


--
-- TOC entry 4367 (class 0 OID 0)
-- Dependencies: 249
-- Name: COLUMN emaillog.status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emaillog.status IS 'Email delivery status (sent, failed, pending)';


--
-- TOC entry 4368 (class 0 OID 0)
-- Dependencies: 249
-- Name: COLUMN emaillog.error_message; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emaillog.error_message IS 'Error message if email sending failed';


--
-- TOC entry 4369 (class 0 OID 0)
-- Dependencies: 249
-- Name: COLUMN emaillog.scheduled_for; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emaillog.scheduled_for IS 'When email is scheduled to be sent (for future implementation)';


--
-- TOC entry 248 (class 1259 OID 46655)
-- Name: emailtemplate; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.emailtemplate (
    id character varying(255) NOT NULL,
    name character varying(255),
    subject character varying(255),
    html_content text,
    trigger_type character varying(255),
    trigger_hours_before numeric,
    trigger_hours_after numeric,
    target_product_types jsonb,
    target_product_ids jsonb,
    target_admin_emails jsonb,
    is_active boolean DEFAULT true,
    send_to_admins boolean DEFAULT false,
    access_expiry_days_before numeric,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL
);


--
-- TOC entry 4370 (class 0 OID 0)
-- Dependencies: 248
-- Name: COLUMN emailtemplate.name; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emailtemplate.name IS 'Human-readable template name';


--
-- TOC entry 4371 (class 0 OID 0)
-- Dependencies: 248
-- Name: COLUMN emailtemplate.subject; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emailtemplate.subject IS 'Email subject line template';


--
-- TOC entry 4372 (class 0 OID 0)
-- Dependencies: 248
-- Name: COLUMN emailtemplate.html_content; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emailtemplate.html_content IS 'HTML email body content with template variables';


--
-- TOC entry 4373 (class 0 OID 0)
-- Dependencies: 248
-- Name: COLUMN emailtemplate.trigger_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emailtemplate.trigger_type IS 'Event type that triggers this email (registration_confirmation, payment_confirmation, etc.)';


--
-- TOC entry 4374 (class 0 OID 0)
-- Dependencies: 248
-- Name: COLUMN emailtemplate.trigger_hours_before; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emailtemplate.trigger_hours_before IS 'Hours before event to trigger email';


--
-- TOC entry 4375 (class 0 OID 0)
-- Dependencies: 248
-- Name: COLUMN emailtemplate.trigger_hours_after; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emailtemplate.trigger_hours_after IS 'Hours after event to trigger email';


--
-- TOC entry 4376 (class 0 OID 0)
-- Dependencies: 248
-- Name: COLUMN emailtemplate.target_product_types; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emailtemplate.target_product_types IS 'Array of product types to target for this template';


--
-- TOC entry 4377 (class 0 OID 0)
-- Dependencies: 248
-- Name: COLUMN emailtemplate.target_product_ids; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emailtemplate.target_product_ids IS 'Array of specific product IDs to target for this template';


--
-- TOC entry 4378 (class 0 OID 0)
-- Dependencies: 248
-- Name: COLUMN emailtemplate.target_admin_emails; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emailtemplate.target_admin_emails IS 'Array of admin emails to notify';


--
-- TOC entry 4379 (class 0 OID 0)
-- Dependencies: 248
-- Name: COLUMN emailtemplate.is_active; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emailtemplate.is_active IS 'Whether this template is currently active';


--
-- TOC entry 4380 (class 0 OID 0)
-- Dependencies: 248
-- Name: COLUMN emailtemplate.send_to_admins; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emailtemplate.send_to_admins IS 'Whether to send this email to administrators';


--
-- TOC entry 4381 (class 0 OID 0)
-- Dependencies: 248
-- Name: COLUMN emailtemplate.access_expiry_days_before; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.emailtemplate.access_expiry_days_before IS 'Days before access expiry to trigger email';


--
-- TOC entry 225 (class 1259 OID 46098)
-- Name: file; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.file (
    id character varying(255) NOT NULL,
    title character varying(255) NOT NULL,
    category character varying(255),
    file_name character varying(255),
    file_type character varying(255),
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    allow_preview boolean DEFAULT true NOT NULL,
    add_copyrights_footer boolean DEFAULT true NOT NULL,
    footer_settings jsonb,
    is_asset_only boolean DEFAULT false NOT NULL,
    footer_overrides jsonb,
    footer_template_id character varying(255),
    accessible_pages jsonb,
    watermark_template_id character varying(255)
);


--
-- TOC entry 4382 (class 0 OID 0)
-- Dependencies: 225
-- Name: TABLE file; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.file IS 'Downloadable files and resources';


--
-- TOC entry 4383 (class 0 OID 0)
-- Dependencies: 225
-- Name: COLUMN file.file_name; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.file.file_name IS 'Original filename of uploaded document (e.g., "my-document.pdf"). NULL if not uploaded yet.';


--
-- TOC entry 4384 (class 0 OID 0)
-- Dependencies: 225
-- Name: COLUMN file.footer_settings; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.file.footer_settings IS 'DEPRECATED: Use footer_overrides instead. Complete footer config now in Settings. Kept for backward compatibility.';


--
-- TOC entry 4385 (class 0 OID 0)
-- Dependencies: 225
-- Name: COLUMN file.is_asset_only; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.file.is_asset_only IS 'true = asset only (not standalone product), false = can be standalone product';


--
-- TOC entry 4386 (class 0 OID 0)
-- Dependencies: 225
-- Name: COLUMN file.footer_overrides; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.file.footer_overrides IS 'File-specific footer overrides (positioning, styling). Content comes from Settings.';


--
-- TOC entry 4387 (class 0 OID 0)
-- Dependencies: 225
-- Name: COLUMN file.footer_template_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.file.footer_template_id IS 'Reference to system_templates for footer configuration';


--
-- TOC entry 4388 (class 0 OID 0)
-- Dependencies: 225
-- Name: COLUMN file.accessible_pages; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.file.accessible_pages IS 'Array of page numbers accessible in preview mode: [1,3,5,7] or null for all pages';


--
-- TOC entry 4389 (class 0 OID 0)
-- Dependencies: 225
-- Name: COLUMN file.watermark_template_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.file.watermark_template_id IS 'Reference to system_templates for watermark configuration';


--
-- TOC entry 226 (class 1259 OID 46106)
-- Name: game; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.game (
    id character varying(255) NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    game_type character varying(255),
    game_settings jsonb DEFAULT '{}'::jsonb NOT NULL,
    difficulty_level character varying(255),
    creator_user_id character varying(255),
    content_query jsonb DEFAULT '{}'::jsonb,
    digital boolean DEFAULT true NOT NULL
);


--
-- TOC entry 4390 (class 0 OID 0)
-- Dependencies: 226
-- Name: TABLE game; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.game IS 'Educational games and interactive content';


--
-- TOC entry 4391 (class 0 OID 0)
-- Dependencies: 226
-- Name: COLUMN game.digital; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.game.digital IS 'true = דיגיטלי, false = גרסה להדפסה';


--
-- TOC entry 246 (class 1259 OID 46613)
-- Name: game_content_link; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.game_content_link (
    id character varying(255) NOT NULL,
    game_id character varying(255) NOT NULL,
    link_type public.enum_game_content_link_link_type NOT NULL,
    target_id character varying(255) NOT NULL,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL
);


--
-- TOC entry 4392 (class 0 OID 0)
-- Dependencies: 246
-- Name: COLUMN game_content_link.id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.game_content_link.id IS 'Unique identifier for this link';


--
-- TOC entry 4393 (class 0 OID 0)
-- Dependencies: 246
-- Name: COLUMN game_content_link.game_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.game_content_link.game_id IS 'The game this link belongs to';


--
-- TOC entry 4394 (class 0 OID 0)
-- Dependencies: 246
-- Name: COLUMN game_content_link.link_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.game_content_link.link_type IS 'Defines whether the link points to a single content item or a content relation';


--
-- TOC entry 4395 (class 0 OID 0)
-- Dependencies: 246
-- Name: COLUMN game_content_link.target_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.game_content_link.target_id IS 'References either gamecontent.id or game_content_relation.id depending on link_type';


--
-- TOC entry 4396 (class 0 OID 0)
-- Dependencies: 246
-- Name: COLUMN game_content_link.metadata; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.game_content_link.metadata IS 'Optional JSON data for storing additional info about the link';


--
-- TOC entry 244 (class 1259 OID 46567)
-- Name: game_content_relation; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.game_content_relation (
    id character varying(255) NOT NULL,
    relation_type public.enum_game_content_relation_relation_type NOT NULL,
    is_bidirectional boolean DEFAULT false NOT NULL,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL
);


--
-- TOC entry 4397 (class 0 OID 0)
-- Dependencies: 244
-- Name: COLUMN game_content_relation.relation_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.game_content_relation.relation_type IS 'Defines what kind of relationship this is (e.g., translation, synonym, etc.)';


--
-- TOC entry 4398 (class 0 OID 0)
-- Dependencies: 244
-- Name: COLUMN game_content_relation.is_bidirectional; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.game_content_relation.is_bidirectional IS 'Whether the relation applies in both directions (e.g., synonyms are bidirectional, Q/A are not)';


--
-- TOC entry 4399 (class 0 OID 0)
-- Dependencies: 244
-- Name: COLUMN game_content_relation.metadata; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.game_content_relation.metadata IS 'Optional JSON for storing extra data (e.g., confidence score, source, etc.)';


--
-- TOC entry 245 (class 1259 OID 46589)
-- Name: game_content_relation_items; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.game_content_relation_items (
    relation_id character varying(255) NOT NULL,
    content_id character varying(255) NOT NULL,
    role public.enum_game_content_relation_items_role,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL
);


--
-- TOC entry 4400 (class 0 OID 0)
-- Dependencies: 245
-- Name: COLUMN game_content_relation_items.role; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.game_content_relation_items.role IS 'Optional label describing the content’s function within the relation';


--
-- TOC entry 243 (class 1259 OID 46536)
-- Name: gamecontent; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.gamecontent (
    id character varying(255) NOT NULL,
    semantic_type character varying(255) NOT NULL,
    data_type character varying(255) NOT NULL,
    value text NOT NULL,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL
);


--
-- TOC entry 227 (class 1259 OID 46115)
-- Name: lesson_plan; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.lesson_plan (
    id character varying(255) NOT NULL,
    context character varying(100),
    file_configs jsonb DEFAULT '"{}"'::jsonb,
    is_active boolean DEFAULT true NOT NULL,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    estimated_duration integer,
    total_slides integer,
    teacher_notes text,
    accessible_slides integer[],
    allow_slide_preview boolean DEFAULT true NOT NULL,
    watermark_template_id character varying(255)
);


--
-- TOC entry 4401 (class 0 OID 0)
-- Dependencies: 227
-- Name: COLUMN lesson_plan.context; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.lesson_plan.context IS 'Theme context like "animals", "hanukkah", "christmas", etc.';


--
-- TOC entry 4402 (class 0 OID 0)
-- Dependencies: 227
-- Name: COLUMN lesson_plan.file_configs; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.lesson_plan.file_configs IS 'JSON configuration for files: roles, connections, slide configs';


--
-- TOC entry 4403 (class 0 OID 0)
-- Dependencies: 227
-- Name: COLUMN lesson_plan.is_active; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.lesson_plan.is_active IS 'Whether this lesson plan is active/published';


--
-- TOC entry 4404 (class 0 OID 0)
-- Dependencies: 227
-- Name: COLUMN lesson_plan.estimated_duration; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.lesson_plan.estimated_duration IS 'Estimated duration of the lesson in minutes';


--
-- TOC entry 4405 (class 0 OID 0)
-- Dependencies: 227
-- Name: COLUMN lesson_plan.total_slides; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.lesson_plan.total_slides IS 'Total number of slides in the lesson plan';


--
-- TOC entry 4406 (class 0 OID 0)
-- Dependencies: 227
-- Name: COLUMN lesson_plan.teacher_notes; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.lesson_plan.teacher_notes IS 'Notes and instructions for the teacher conducting the lesson';


--
-- TOC entry 4407 (class 0 OID 0)
-- Dependencies: 227
-- Name: COLUMN lesson_plan.accessible_slides; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.lesson_plan.accessible_slides IS 'Array of slide indices (0-based) accessible in preview mode: [0,2,4] or null for all slides';


--
-- TOC entry 4408 (class 0 OID 0)
-- Dependencies: 227
-- Name: COLUMN lesson_plan.allow_slide_preview; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.lesson_plan.allow_slide_preview IS 'Whether slides can be previewed without purchase access';


--
-- TOC entry 4409 (class 0 OID 0)
-- Dependencies: 227
-- Name: COLUMN lesson_plan.watermark_template_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.lesson_plan.watermark_template_id IS 'Reference to system_templates for watermark configuration on slides';


--
-- TOC entry 228 (class 1259 OID 46122)
-- Name: logs; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.logs (
    id integer NOT NULL,
    source_type character varying(10) NOT NULL,
    log_type character varying(20) DEFAULT 'log'::character varying NOT NULL,
    message text NOT NULL,
    user_id character varying(255),
    created_at timestamp with time zone DEFAULT now()
);


--
-- TOC entry 4410 (class 0 OID 0)
-- Dependencies: 228
-- Name: TABLE logs; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.logs IS 'Application logging and audit trail';


--
-- TOC entry 229 (class 1259 OID 46129)
-- Name: logs_id_seq; Type: SEQUENCE; Schema: public; Owner: -
--

CREATE SEQUENCE public.logs_id_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


--
-- TOC entry 4411 (class 0 OID 0)
-- Dependencies: 229
-- Name: logs_id_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: -
--

ALTER SEQUENCE public.logs_id_seq OWNED BY public.logs.id;


--
-- TOC entry 230 (class 1259 OID 46130)
-- Name: product; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.product (
    id character varying(255) NOT NULL,
    title character varying(255),
    description text,
    category character varying(255),
    product_type character varying(255),
    entity_id character varying(255) NOT NULL,
    price numeric,
    is_published boolean,
    image_url character varying(500),
    tags jsonb,
    target_audience character varying(255),
    access_days numeric,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    creator_user_id character varying(255),
    short_description character varying(255),
    marketing_video_url character varying(255),
    marketing_video_title character varying(255),
    marketing_video_duration integer,
    marketing_video_type public.enum_product_marketing_video_type,
    marketing_video_id character varying(255),
    type_attributes jsonb DEFAULT '{}'::jsonb,
    image_filename character varying(255),
    has_image boolean DEFAULT false NOT NULL
);


--
-- TOC entry 4412 (class 0 OID 0)
-- Dependencies: 230
-- Name: COLUMN product.image_url; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.product.image_url IS 'DEPRECATED: Use image_filename and has_image instead. Kept for backward compatibility.';


--
-- TOC entry 4413 (class 0 OID 0)
-- Dependencies: 230
-- Name: COLUMN product.marketing_video_url; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.product.marketing_video_url IS 'URL for uploaded marketing video file';


--
-- TOC entry 4414 (class 0 OID 0)
-- Dependencies: 230
-- Name: COLUMN product.marketing_video_title; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.product.marketing_video_title IS 'Title for uploaded marketing video';


--
-- TOC entry 4415 (class 0 OID 0)
-- Dependencies: 230
-- Name: COLUMN product.marketing_video_duration; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.product.marketing_video_duration IS 'Duration of uploaded marketing video in seconds';


--
-- TOC entry 4416 (class 0 OID 0)
-- Dependencies: 230
-- Name: COLUMN product.marketing_video_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.product.marketing_video_type IS 'Type of marketing video: youtube or uploaded file';


--
-- TOC entry 4417 (class 0 OID 0)
-- Dependencies: 230
-- Name: COLUMN product.marketing_video_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.product.marketing_video_id IS 'YouTube video ID or entity ID for uploaded videos';


--
-- TOC entry 4418 (class 0 OID 0)
-- Dependencies: 230
-- Name: COLUMN product.type_attributes; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.product.type_attributes IS 'Type-specific attributes based on product_type';


--
-- TOC entry 4419 (class 0 OID 0)
-- Dependencies: 230
-- Name: COLUMN product.image_filename; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.product.image_filename IS 'Standardized image filename storage (replaces image_url placeholder)';


--
-- TOC entry 4420 (class 0 OID 0)
-- Dependencies: 230
-- Name: COLUMN product.has_image; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.product.has_image IS 'Clear boolean indicator for image existence';


--
-- TOC entry 231 (class 1259 OID 46138)
-- Name: purchase; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.purchase (
    id character varying(255) NOT NULL,
    buyer_user_id character varying(255) NOT NULL,
    purchasable_type character varying(50) NOT NULL,
    purchasable_id character varying(255) NOT NULL,
    payment_amount numeric(10,2) NOT NULL,
    original_price numeric(10,2) NOT NULL,
    discount_amount numeric(10,2) DEFAULT 0,
    coupon_code character varying(100),
    payment_method character varying(50),
    payment_status character varying(50) DEFAULT 'cart'::character varying NOT NULL,
    transaction_id character varying(255),
    access_expires_at timestamp with time zone,
    download_count integer DEFAULT 0,
    first_accessed_at timestamp with time zone,
    last_accessed_at timestamp with time zone,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


--
-- TOC entry 4421 (class 0 OID 0)
-- Dependencies: 231
-- Name: TABLE purchase; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.purchase IS 'Purchase records and access tracking';


--
-- TOC entry 232 (class 1259 OID 46149)
-- Name: school; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.school (
    id character varying(255) NOT NULL,
    name character varying(255) NOT NULL,
    city character varying(255) NOT NULL,
    address character varying(255) NOT NULL,
    institution_symbol character varying(255) NOT NULL,
    email character varying(255),
    phone_numbers jsonb DEFAULT '[]'::jsonb,
    education_levels jsonb DEFAULT '[]'::jsonb,
    district character varying(255),
    logo_url character varying(500),
    school_headmaster_id character varying(255),
    edu_system_id character varying(255),
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    has_logo boolean DEFAULT false NOT NULL,
    logo_filename character varying(255)
);


--
-- TOC entry 4422 (class 0 OID 0)
-- Dependencies: 232
-- Name: COLUMN school.name; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.school.name IS 'School name';


--
-- TOC entry 4423 (class 0 OID 0)
-- Dependencies: 232
-- Name: COLUMN school.city; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.school.city IS 'City where the school is located';


--
-- TOC entry 4424 (class 0 OID 0)
-- Dependencies: 232
-- Name: COLUMN school.address; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.school.address IS 'Full address of the school';


--
-- TOC entry 4425 (class 0 OID 0)
-- Dependencies: 232
-- Name: COLUMN school.institution_symbol; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.school.institution_symbol IS 'Unique institution symbol/code';


--
-- TOC entry 4426 (class 0 OID 0)
-- Dependencies: 232
-- Name: COLUMN school.email; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.school.email IS 'Primary email address';


--
-- TOC entry 4427 (class 0 OID 0)
-- Dependencies: 232
-- Name: COLUMN school.phone_numbers; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.school.phone_numbers IS 'Array of phone objects with phone and description fields';


--
-- TOC entry 4428 (class 0 OID 0)
-- Dependencies: 232
-- Name: COLUMN school.education_levels; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.school.education_levels IS 'Array of education levels (elementary, middle_school, high_school, academic)';


--
-- TOC entry 4429 (class 0 OID 0)
-- Dependencies: 232
-- Name: COLUMN school.district; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.school.district IS 'Educational district (צפון, חיפה, מרכז, etc.)';


--
-- TOC entry 4430 (class 0 OID 0)
-- Dependencies: 232
-- Name: COLUMN school.logo_url; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.school.logo_url IS 'DEPRECATED: Use has_logo and logo_filename instead. Kept for backward compatibility.';


--
-- TOC entry 4431 (class 0 OID 0)
-- Dependencies: 232
-- Name: COLUMN school.school_headmaster_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.school.school_headmaster_id IS 'School headmaster user ID';


--
-- TOC entry 4432 (class 0 OID 0)
-- Dependencies: 232
-- Name: COLUMN school.edu_system_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.school.edu_system_id IS 'Education system identifier';


--
-- TOC entry 4433 (class 0 OID 0)
-- Dependencies: 232
-- Name: COLUMN school.has_logo; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.school.has_logo IS 'Clear boolean indicator for logo image existence';


--
-- TOC entry 4434 (class 0 OID 0)
-- Dependencies: 232
-- Name: COLUMN school.logo_filename; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.school.logo_filename IS 'Standardized logo filename storage (replaces logo_url)';


--
-- TOC entry 233 (class 1259 OID 46156)
-- Name: settings; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.settings (
    id character varying(255) NOT NULL,
    subscription_system_enabled boolean,
    default_course_access_days numeric,
    course_lifetime_access boolean,
    default_file_access_days numeric,
    file_lifetime_access boolean,
    contact_email character varying(255),
    contact_phone character varying(255),
    site_description text,
    logo_url character varying(500),
    site_name character varying(255),
    maintenance_mode boolean,
    student_invitation_expiry_days numeric,
    parent_consent_required boolean,
    nav_order jsonb,
    nav_files_text character varying(255),
    nav_files_icon character varying(255),
    nav_files_visibility character varying(255),
    nav_files_enabled boolean,
    nav_games_text character varying(255),
    nav_games_icon character varying(255),
    nav_games_visibility character varying(255),
    nav_games_enabled boolean,
    nav_workshops_text character varying(255),
    nav_workshops_icon character varying(255),
    nav_workshops_visibility character varying(255),
    nav_workshops_enabled boolean,
    nav_courses_text character varying(255),
    nav_courses_icon character varying(255),
    nav_courses_visibility character varying(255),
    nav_courses_enabled boolean,
    nav_classrooms_text character varying(255),
    nav_classrooms_icon character varying(255),
    nav_classrooms_visibility character varying(255),
    nav_classrooms_enabled boolean,
    nav_account_text character varying(255),
    nav_account_icon character varying(255),
    nav_account_visibility character varying(255),
    nav_account_enabled boolean,
    nav_content_creators_text character varying(255),
    nav_content_creators_icon character varying(255),
    nav_content_creators_visibility character varying(255),
    nav_content_creators_enabled boolean,
    is_sample boolean,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    allow_content_creator_workshops boolean DEFAULT true,
    allow_content_creator_courses boolean DEFAULT true,
    allow_content_creator_files boolean DEFAULT true,
    allow_content_creator_tools boolean DEFAULT true,
    allow_content_creator_games boolean DEFAULT true,
    copyright_footer_text text DEFAULT 'כל הזכויות שמורות. תוכן זה מוגן בזכויות יוצרים ואסור להעתיקו, להפיצו או לשתפו ללא אישור בכתב מהמחבר או מלודורה.'::text,
    nav_tools_text character varying(255),
    nav_tools_icon character varying(255),
    nav_tools_visibility character varying(255) DEFAULT 'admin_only'::character varying,
    nav_tools_enabled boolean DEFAULT true,
    available_dashboard_widgets jsonb,
    nav_curriculum_text character varying(255),
    nav_curriculum_icon character varying(255),
    nav_curriculum_visibility character varying(255) DEFAULT 'logged_in_users'::character varying,
    nav_curriculum_enabled boolean DEFAULT false,
    available_specializations jsonb,
    available_grade_levels jsonb,
    default_game_access_days numeric DEFAULT 365,
    game_lifetime_access boolean DEFAULT true,
    nav_lesson_plans_text character varying(255),
    nav_lesson_plans_icon character varying(255),
    nav_lesson_plans_visibility character varying(255) DEFAULT 'logged_in_users'::character varying,
    nav_lesson_plans_enabled boolean DEFAULT false,
    allow_content_creator_lesson_plans boolean DEFAULT false,
    default_workshop_access_days integer,
    workshop_lifetime_access boolean,
    default_lesson_plan_access_days integer,
    lesson_plan_lifetime_access boolean,
    default_tool_access_days integer,
    tool_lifetime_access boolean,
    has_logo boolean DEFAULT false NOT NULL,
    logo_filename character varying(255)
);


--
-- TOC entry 4435 (class 0 OID 0)
-- Dependencies: 233
-- Name: TABLE settings; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.settings IS 'Application configuration and settings';


--
-- TOC entry 4436 (class 0 OID 0)
-- Dependencies: 233
-- Name: COLUMN settings.logo_url; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.settings.logo_url IS 'DEPRECATED: Use has_logo and logo_filename instead. Kept for backward compatibility.';


--
-- TOC entry 4437 (class 0 OID 0)
-- Dependencies: 233
-- Name: COLUMN settings.copyright_footer_text; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.settings.copyright_footer_text IS 'Copyright text to be dynamically merged into PDF files';


--
-- TOC entry 4438 (class 0 OID 0)
-- Dependencies: 233
-- Name: COLUMN settings.nav_tools_text; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.settings.nav_tools_text IS 'Custom text for tools navigation item';


--
-- TOC entry 4439 (class 0 OID 0)
-- Dependencies: 233
-- Name: COLUMN settings.nav_tools_icon; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.settings.nav_tools_icon IS 'Custom icon for tools navigation item';


--
-- TOC entry 4440 (class 0 OID 0)
-- Dependencies: 233
-- Name: COLUMN settings.nav_tools_visibility; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.settings.nav_tools_visibility IS 'Visibility setting for tools navigation item (public, logged_in_users, admin_only, admins_and_creators, hidden)';


--
-- TOC entry 4441 (class 0 OID 0)
-- Dependencies: 233
-- Name: COLUMN settings.nav_tools_enabled; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.settings.nav_tools_enabled IS 'Whether tools navigation item is enabled';


--
-- TOC entry 4442 (class 0 OID 0)
-- Dependencies: 233
-- Name: COLUMN settings.available_dashboard_widgets; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.settings.available_dashboard_widgets IS 'Available widgets for user dashboards';


--
-- TOC entry 4443 (class 0 OID 0)
-- Dependencies: 233
-- Name: COLUMN settings.available_specializations; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.settings.available_specializations IS 'Available specializations for teacher onboarding';


--
-- TOC entry 4444 (class 0 OID 0)
-- Dependencies: 233
-- Name: COLUMN settings.available_grade_levels; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.settings.available_grade_levels IS 'Available grade levels for classroom creation';


--
-- TOC entry 4445 (class 0 OID 0)
-- Dependencies: 233
-- Name: COLUMN settings.default_game_access_days; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.settings.default_game_access_days IS 'Default access days for game products';


--
-- TOC entry 4446 (class 0 OID 0)
-- Dependencies: 233
-- Name: COLUMN settings.game_lifetime_access; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.settings.game_lifetime_access IS 'Whether game products have lifetime access by default';


--
-- TOC entry 4447 (class 0 OID 0)
-- Dependencies: 233
-- Name: COLUMN settings.has_logo; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.settings.has_logo IS 'Clear boolean indicator for system logo existence';


--
-- TOC entry 4448 (class 0 OID 0)
-- Dependencies: 233
-- Name: COLUMN settings.logo_filename; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.settings.logo_filename IS 'Standardized system logo filename storage (replaces logo_url)';


--
-- TOC entry 234 (class 1259 OID 46179)
-- Name: studentinvitation; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.studentinvitation (
    id character varying(255) NOT NULL,
    classroom_id character varying(255),
    teacher_id character varying(255),
    student_user_id character varying(255),
    student_email character varying(255),
    student_name character varying(255),
    parent_email character varying(255),
    parent_name character varying(255),
    status character varying(255),
    invitation_token character varying(255),
    parent_consent_token character varying(255),
    expires_at character varying(255),
    parent_consent_given_at character varying(255),
    student_accepted_at character varying(255),
    converted_to_membership_at character varying(255),
    notes character varying(255),
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL
);


--
-- TOC entry 235 (class 1259 OID 46186)
-- Name: subscription; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.subscription (
    id character varying(255) NOT NULL,
    user_id character varying(255) NOT NULL,
    subscription_plan_id character varying(255) NOT NULL,
    transaction_id character varying(255),
    status public.enum_subscription_status DEFAULT 'pending'::public.enum_subscription_status NOT NULL,
    start_date timestamp with time zone NOT NULL,
    end_date timestamp with time zone,
    next_billing_date timestamp with time zone,
    cancelled_at timestamp with time zone,
    payplus_subscription_uid character varying(255),
    payplus_status character varying(255),
    monthly_price numeric(10,2) NOT NULL,
    billing_period character varying(255) NOT NULL,
    metadata jsonb DEFAULT '{}'::jsonb,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    original_price numeric(10,2),
    discount_amount numeric(10,2) DEFAULT 0
);


--
-- TOC entry 4449 (class 0 OID 0)
-- Dependencies: 235
-- Name: COLUMN subscription.original_price; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.subscription.original_price IS 'Original price before discounts';


--
-- TOC entry 4450 (class 0 OID 0)
-- Dependencies: 235
-- Name: COLUMN subscription.discount_amount; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.subscription.discount_amount IS 'Discount amount applied to this subscription';


--
-- TOC entry 236 (class 1259 OID 46194)
-- Name: subscriptionhistory; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.subscriptionhistory (
    id character varying(255) NOT NULL,
    user_id character varying(255) NOT NULL,
    subscription_plan_id character varying(255) NOT NULL,
    subscription_id character varying(255),
    action_type public.enum_subscriptionhistory_action_type NOT NULL,
    previous_plan_id character varying(255),
    start_date timestamp with time zone,
    end_date timestamp with time zone,
    purchased_price numeric(10,2),
    payplus_subscription_uid character varying(255),
    transaction_id character varying(255),
    notes text,
    metadata jsonb,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL
);


--
-- TOC entry 4451 (class 0 OID 0)
-- Dependencies: 236
-- Name: COLUMN subscriptionhistory.id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.subscriptionhistory.id IS 'Unique identifier for subscription history record';


--
-- TOC entry 4452 (class 0 OID 0)
-- Dependencies: 236
-- Name: COLUMN subscriptionhistory.user_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.subscriptionhistory.user_id IS 'ID of the user this history record belongs to';


--
-- TOC entry 4453 (class 0 OID 0)
-- Dependencies: 236
-- Name: COLUMN subscriptionhistory.subscription_plan_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.subscriptionhistory.subscription_plan_id IS 'ID of the subscription plan involved in this action';


--
-- TOC entry 4454 (class 0 OID 0)
-- Dependencies: 236
-- Name: COLUMN subscriptionhistory.subscription_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.subscriptionhistory.subscription_id IS 'ID of the subscription record if linked to new subscription system';


--
-- TOC entry 4455 (class 0 OID 0)
-- Dependencies: 236
-- Name: COLUMN subscriptionhistory.action_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.subscriptionhistory.action_type IS 'Type of subscription action performed';


--
-- TOC entry 4456 (class 0 OID 0)
-- Dependencies: 236
-- Name: COLUMN subscriptionhistory.previous_plan_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.subscriptionhistory.previous_plan_id IS 'ID of the previous subscription plan (for upgrades/downgrades)';


--
-- TOC entry 4457 (class 0 OID 0)
-- Dependencies: 236
-- Name: COLUMN subscriptionhistory.start_date; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.subscriptionhistory.start_date IS 'Start date of the subscription action';


--
-- TOC entry 4458 (class 0 OID 0)
-- Dependencies: 236
-- Name: COLUMN subscriptionhistory.end_date; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.subscriptionhistory.end_date IS 'End date of the subscription (for cancellations)';


--
-- TOC entry 4459 (class 0 OID 0)
-- Dependencies: 236
-- Name: COLUMN subscriptionhistory.purchased_price; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.subscriptionhistory.purchased_price IS 'Price paid for this subscription action';


--
-- TOC entry 4460 (class 0 OID 0)
-- Dependencies: 236
-- Name: COLUMN subscriptionhistory.payplus_subscription_uid; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.subscriptionhistory.payplus_subscription_uid IS 'PayPlus subscription UID for recurring payments';


--
-- TOC entry 4461 (class 0 OID 0)
-- Dependencies: 236
-- Name: COLUMN subscriptionhistory.transaction_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.subscriptionhistory.transaction_id IS 'ID of the transaction associated with this action';


--
-- TOC entry 4462 (class 0 OID 0)
-- Dependencies: 236
-- Name: COLUMN subscriptionhistory.notes; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.subscriptionhistory.notes IS 'Additional notes about this subscription action';


--
-- TOC entry 4463 (class 0 OID 0)
-- Dependencies: 236
-- Name: COLUMN subscriptionhistory.metadata; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.subscriptionhistory.metadata IS 'Additional metadata for this subscription history record';


--
-- TOC entry 4464 (class 0 OID 0)
-- Dependencies: 236
-- Name: COLUMN subscriptionhistory.created_at; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.subscriptionhistory.created_at IS 'Timestamp when this history record was created';


--
-- TOC entry 4465 (class 0 OID 0)
-- Dependencies: 236
-- Name: COLUMN subscriptionhistory.updated_at; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.subscriptionhistory.updated_at IS 'Timestamp when this history record was last updated';


--
-- TOC entry 237 (class 1259 OID 46199)
-- Name: subscriptionplan; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.subscriptionplan (
    id character varying(255) NOT NULL,
    name character varying(255),
    description character varying(255),
    price numeric,
    billing_period character varying(255),
    has_discount boolean,
    discount_type character varying(255),
    discount_value numeric,
    discount_valid_until character varying(255),
    is_active boolean,
    is_default boolean,
    plan_type character varying(255),
    benefits jsonb,
    sort_order numeric,
    is_sample boolean,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now()
);


--
-- TOC entry 250 (class 1259 OID 46691)
-- Name: supportmessage; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.supportmessage (
    id character varying(255) NOT NULL,
    name character varying(255),
    email character varying(255),
    phone character varying(255),
    subject character varying(255),
    content text,
    is_read boolean DEFAULT false,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL
);


--
-- TOC entry 4466 (class 0 OID 0)
-- Dependencies: 250
-- Name: COLUMN supportmessage.name; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.supportmessage.name IS 'Name of the person submitting the support request';


--
-- TOC entry 4467 (class 0 OID 0)
-- Dependencies: 250
-- Name: COLUMN supportmessage.email; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.supportmessage.email IS 'Email address of the person submitting the request';


--
-- TOC entry 4468 (class 0 OID 0)
-- Dependencies: 250
-- Name: COLUMN supportmessage.phone; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.supportmessage.phone IS 'Phone number of the person submitting the request';


--
-- TOC entry 4469 (class 0 OID 0)
-- Dependencies: 250
-- Name: COLUMN supportmessage.subject; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.supportmessage.subject IS 'Subject line of the support request';


--
-- TOC entry 4470 (class 0 OID 0)
-- Dependencies: 250
-- Name: COLUMN supportmessage.content; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.supportmessage.content IS 'Detailed content of the support request';


--
-- TOC entry 4471 (class 0 OID 0)
-- Dependencies: 250
-- Name: COLUMN supportmessage.is_read; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.supportmessage.is_read IS 'Whether this message has been read by an administrator';


--
-- TOC entry 247 (class 1259 OID 46633)
-- Name: system_templates; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.system_templates (
    id character varying(255) NOT NULL,
    name character varying(255) NOT NULL,
    description text,
    template_type character varying(100) NOT NULL,
    category character varying(100),
    is_default boolean DEFAULT false NOT NULL,
    template_data jsonb NOT NULL,
    created_by character varying(255),
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    target_file_types character varying(255)[] DEFAULT NULL::character varying[]
);


--
-- TOC entry 4472 (class 0 OID 0)
-- Dependencies: 247
-- Name: COLUMN system_templates.name; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.system_templates.name IS 'Human-readable template name (e.g., "Landscape Footer", "Portrait Minimal")';


--
-- TOC entry 4473 (class 0 OID 0)
-- Dependencies: 247
-- Name: COLUMN system_templates.description; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.system_templates.description IS 'Optional description of template purpose and usage';


--
-- TOC entry 4474 (class 0 OID 0)
-- Dependencies: 247
-- Name: COLUMN system_templates.template_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.system_templates.template_type IS 'Type of template (footer, header, watermark, etc.)';


--
-- TOC entry 4475 (class 0 OID 0)
-- Dependencies: 247
-- Name: COLUMN system_templates.category; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.system_templates.category IS 'Template category (landscape, portrait, minimal, logo-only, corporate, etc.)';


--
-- TOC entry 4476 (class 0 OID 0)
-- Dependencies: 247
-- Name: COLUMN system_templates.is_default; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.system_templates.is_default IS 'Whether this template is the default for its template_type';


--
-- TOC entry 4477 (class 0 OID 0)
-- Dependencies: 247
-- Name: COLUMN system_templates.template_data; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.system_templates.template_data IS 'Flexible template configuration data structure, varies by template_type';


--
-- TOC entry 4478 (class 0 OID 0)
-- Dependencies: 247
-- Name: COLUMN system_templates.created_by; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.system_templates.created_by IS 'Email of user who created this template (admin user)';


--
-- TOC entry 4479 (class 0 OID 0)
-- Dependencies: 247
-- Name: COLUMN system_templates.target_file_types; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.system_templates.target_file_types IS 'Array of file types this template applies to: [pdf, svg, both] - null for footer/header templates';


--
-- TOC entry 238 (class 1259 OID 46206)
-- Name: tool; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.tool (
    id character varying(255) NOT NULL,
    tool_key character varying(255) NOT NULL,
    category character varying(255) DEFAULT 'general'::character varying NOT NULL,
    default_access_days integer DEFAULT 365 NOT NULL,
    created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL,
    updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP NOT NULL
);


--
-- TOC entry 4480 (class 0 OID 0)
-- Dependencies: 238
-- Name: COLUMN tool.tool_key; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.tool.tool_key IS 'Unique identifier for the tool (e.g., CONTACT_PAGE_GENERATOR)';


--
-- TOC entry 4481 (class 0 OID 0)
-- Dependencies: 238
-- Name: COLUMN tool.category; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.tool.category IS 'Category of the tool (e.g., generators, utilities)';


--
-- TOC entry 4482 (class 0 OID 0)
-- Dependencies: 238
-- Name: COLUMN tool.default_access_days; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.tool.default_access_days IS 'Default access duration when purchased';


--
-- TOC entry 239 (class 1259 OID 46215)
-- Name: transaction; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.transaction (
    id character varying(255) NOT NULL,
    user_id character varying(255),
    amount numeric(10,2),
    currency character varying(255) DEFAULT 'ILS'::character varying,
    payment_method character varying(255),
    payment_status public.enum_transaction_payment_status DEFAULT 'pending'::public.enum_transaction_payment_status,
    metadata jsonb,
    environment public.enum_transaction_environment,
    provider_response jsonb,
    failure_reason text,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    page_request_uid character varying(255),
    payment_page_link text,
    transaction_id character varying(255),
    description text,
    provider_transaction_id character varying(255)
);


--
-- TOC entry 240 (class 1259 OID 46229)
-- Name: user; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public."user" (
    id character varying(255) NOT NULL,
    email character varying(255),
    full_name character varying(255),
    disabled character varying(255),
    is_verified boolean,
    role character varying(255) DEFAULT 'user'::character varying NOT NULL,
    created_at timestamp with time zone DEFAULT now(),
    updated_at timestamp with time zone DEFAULT now(),
    is_active boolean DEFAULT true,
    last_login timestamp with time zone,
    phone character varying(255),
    education_level character varying(255),
    content_creator_agreement_sign_date timestamp with time zone,
    user_type character varying(255),
    dashboard_settings jsonb,
    onboarding_completed boolean DEFAULT false NOT NULL,
    birth_date date,
    specializations jsonb DEFAULT '[]'::jsonb,
    school_id character varying(255)
);


--
-- TOC entry 4483 (class 0 OID 0)
-- Dependencies: 240
-- Name: TABLE "user"; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public."user" IS 'User accounts and authentication information';


--
-- TOC entry 4484 (class 0 OID 0)
-- Dependencies: 240
-- Name: COLUMN "user".dashboard_settings; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public."user".dashboard_settings IS 'User dashboard configuration with widgets and their settings';


--
-- TOC entry 4485 (class 0 OID 0)
-- Dependencies: 240
-- Name: COLUMN "user".onboarding_completed; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public."user".onboarding_completed IS 'Flag indicating whether user has completed the onboarding process';


--
-- TOC entry 4486 (class 0 OID 0)
-- Dependencies: 240
-- Name: COLUMN "user".birth_date; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public."user".birth_date IS 'User birth date for age verification and onboarding';


--
-- TOC entry 4487 (class 0 OID 0)
-- Dependencies: 240
-- Name: COLUMN "user".specializations; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public."user".specializations IS 'Teacher specializations and teaching subjects as JSON array';


--
-- TOC entry 4488 (class 0 OID 0)
-- Dependencies: 240
-- Name: COLUMN "user".school_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public."user".school_id IS 'School that this user belongs to (teachers, students, headmasters)';


--
-- TOC entry 241 (class 1259 OID 46240)
-- Name: webhook_log; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.webhook_log (
    id character varying(255) NOT NULL,
    provider character varying(50) NOT NULL,
    event_type character varying(100) NOT NULL,
    event_data jsonb NOT NULL,
    sender_info jsonb NOT NULL,
    response_data jsonb,
    process_log text,
    status character varying(20) DEFAULT 'received'::character varying NOT NULL,
    page_request_uid character varying(255),
    payplus_transaction_uid character varying(255),
    transaction_id character varying(255),
    subscription_id character varying(255),
    error_message text,
    processing_duration_ms integer,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL
);


--
-- TOC entry 4489 (class 0 OID 0)
-- Dependencies: 241
-- Name: COLUMN webhook_log.provider; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.webhook_log.provider IS 'Webhook provider (payplus, stripe, etc.)';


--
-- TOC entry 4490 (class 0 OID 0)
-- Dependencies: 241
-- Name: COLUMN webhook_log.event_type; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.webhook_log.event_type IS 'Type of webhook event';


--
-- TOC entry 4491 (class 0 OID 0)
-- Dependencies: 241
-- Name: COLUMN webhook_log.event_data; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.webhook_log.event_data IS 'Complete webhook payload data';


--
-- TOC entry 4492 (class 0 OID 0)
-- Dependencies: 241
-- Name: COLUMN webhook_log.sender_info; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.webhook_log.sender_info IS 'Information about who sent the webhook (IP, user-agent, headers, etc.)';


--
-- TOC entry 4493 (class 0 OID 0)
-- Dependencies: 241
-- Name: COLUMN webhook_log.response_data; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.webhook_log.response_data IS 'Response data sent back to webhook sender';


--
-- TOC entry 4494 (class 0 OID 0)
-- Dependencies: 241
-- Name: COLUMN webhook_log.process_log; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.webhook_log.process_log IS 'Log of processing steps and any errors';


--
-- TOC entry 4495 (class 0 OID 0)
-- Dependencies: 241
-- Name: COLUMN webhook_log.status; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.webhook_log.status IS 'Status: received, processing, completed, failed';


--
-- TOC entry 4496 (class 0 OID 0)
-- Dependencies: 241
-- Name: COLUMN webhook_log.page_request_uid; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.webhook_log.page_request_uid IS 'PayPlus page request UID for tracking';


--
-- TOC entry 4497 (class 0 OID 0)
-- Dependencies: 241
-- Name: COLUMN webhook_log.payplus_transaction_uid; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.webhook_log.payplus_transaction_uid IS 'PayPlus transaction UID for tracking';


--
-- TOC entry 4498 (class 0 OID 0)
-- Dependencies: 241
-- Name: COLUMN webhook_log.transaction_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.webhook_log.transaction_id IS 'Related transaction ID if found';


--
-- TOC entry 4499 (class 0 OID 0)
-- Dependencies: 241
-- Name: COLUMN webhook_log.subscription_id; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.webhook_log.subscription_id IS 'Related subscription ID if found';


--
-- TOC entry 4500 (class 0 OID 0)
-- Dependencies: 241
-- Name: COLUMN webhook_log.error_message; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.webhook_log.error_message IS 'Error message if processing failed';


--
-- TOC entry 4501 (class 0 OID 0)
-- Dependencies: 241
-- Name: COLUMN webhook_log.processing_duration_ms; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.webhook_log.processing_duration_ms IS 'Time taken to process webhook in milliseconds';


--
-- TOC entry 242 (class 1259 OID 46246)
-- Name: workshop; Type: TABLE; Schema: public; Owner: -
--

CREATE TABLE public.workshop (
    id character varying(255) NOT NULL,
    title character varying(255) NOT NULL,
    description text,
    short_description text,
    category character varying(255),
    price numeric DEFAULT '0'::numeric NOT NULL,
    is_published boolean DEFAULT false NOT NULL,
    image_url character varying(255),
    image_is_private boolean DEFAULT false,
    tags jsonb,
    target_audience character varying(255),
    difficulty_level character varying(255),
    access_days integer,
    is_lifetime_access boolean DEFAULT false,
    workshop_type character varying(255) DEFAULT 'recorded'::character varying NOT NULL,
    video_file_url character varying(500),
    scheduled_date timestamp with time zone,
    meeting_link character varying(255),
    meeting_password character varying(255),
    meeting_platform character varying(255),
    max_participants integer,
    duration_minutes integer,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    has_video boolean DEFAULT false NOT NULL,
    video_filename character varying(255)
);


--
-- TOC entry 4502 (class 0 OID 0)
-- Dependencies: 242
-- Name: TABLE workshop; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON TABLE public.workshop IS 'Workshop content (recorded and live)';


--
-- TOC entry 4503 (class 0 OID 0)
-- Dependencies: 242
-- Name: COLUMN workshop.video_file_url; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.workshop.video_file_url IS 'DEPRECATED: Use has_video and video_filename instead. Kept for backward compatibility.';


--
-- TOC entry 4504 (class 0 OID 0)
-- Dependencies: 242
-- Name: COLUMN workshop.has_video; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.workshop.has_video IS 'Clear boolean indicator for content video existence';


--
-- TOC entry 4505 (class 0 OID 0)
-- Dependencies: 242
-- Name: COLUMN workshop.video_filename; Type: COMMENT; Schema: public; Owner: -
--

COMMENT ON COLUMN public.workshop.video_filename IS 'Standardized video filename storage (replaces video_file_url)';


--
-- TOC entry 3874 (class 2604 OID 46256)
-- Name: logs id; Type: DEFAULT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.logs ALTER COLUMN id SET DEFAULT nextval('public.logs_id_seq'::regclass);


--
-- TOC entry 3951 (class 2606 OID 46263)
-- Name: SequelizeMeta SequelizeMeta_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public."SequelizeMeta"
    ADD CONSTRAINT "SequelizeMeta_pkey" PRIMARY KEY (name);


--
-- TOC entry 3953 (class 2606 OID 46265)
-- Name: audiofile audiofile_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.audiofile
    ADD CONSTRAINT audiofile_pkey PRIMARY KEY (id);


--
-- TOC entry 3957 (class 2606 OID 46267)
-- Name: category category_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.category
    ADD CONSTRAINT category_pkey PRIMARY KEY (id);


--
-- TOC entry 3959 (class 2606 OID 46269)
-- Name: classroom classroom_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.classroom
    ADD CONSTRAINT classroom_pkey PRIMARY KEY (id);


--
-- TOC entry 3965 (class 2606 OID 46271)
-- Name: classroommembership classroommembership_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.classroommembership
    ADD CONSTRAINT classroommembership_pkey PRIMARY KEY (id);


--
-- TOC entry 3969 (class 2606 OID 46275)
-- Name: coupon coupon_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.coupon
    ADD CONSTRAINT coupon_pkey PRIMARY KEY (id);


--
-- TOC entry 3976 (class 2606 OID 46277)
-- Name: course course_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.course
    ADD CONSTRAINT course_pkey PRIMARY KEY (id);


--
-- TOC entry 4000 (class 2606 OID 46279)
-- Name: curriculum_item curriculum_item_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.curriculum_item
    ADD CONSTRAINT curriculum_item_pkey PRIMARY KEY (id);


--
-- TOC entry 3986 (class 2606 OID 46281)
-- Name: curriculum curriculum_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.curriculum
    ADD CONSTRAINT curriculum_pkey PRIMARY KEY (id);


--
-- TOC entry 4004 (class 2606 OID 46283)
-- Name: curriculum_product curriculum_product_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.curriculum_product
    ADD CONSTRAINT curriculum_product_pkey PRIMARY KEY (curriculum_item_id, product_id);


--
-- TOC entry 4152 (class 2606 OID 46674)
-- Name: emaillog emaillog_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.emaillog
    ADD CONSTRAINT emaillog_pkey PRIMARY KEY (id);


--
-- TOC entry 4146 (class 2606 OID 46663)
-- Name: emailtemplate emailtemplate_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.emailtemplate
    ADD CONSTRAINT emailtemplate_pkey PRIMARY KEY (id);


--
-- TOC entry 4008 (class 2606 OID 46285)
-- Name: file file_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.file
    ADD CONSTRAINT file_pkey PRIMARY KEY (id);


--
-- TOC entry 4136 (class 2606 OID 46622)
-- Name: game_content_link game_content_link_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.game_content_link
    ADD CONSTRAINT game_content_link_pkey PRIMARY KEY (id);


--
-- TOC entry 4129 (class 2606 OID 46577)
-- Name: game_content_relation game_content_relation_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.game_content_relation
    ADD CONSTRAINT game_content_relation_pkey PRIMARY KEY (id);


--
-- TOC entry 4015 (class 2606 OID 46287)
-- Name: game game_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.game
    ADD CONSTRAINT game_pkey PRIMARY KEY (id);


--
-- TOC entry 4127 (class 2606 OID 46545)
-- Name: gamecontent gamecontent_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.gamecontent
    ADD CONSTRAINT gamecontent_pkey PRIMARY KEY (id);


--
-- TOC entry 4025 (class 2606 OID 46289)
-- Name: lesson_plan lesson_plan_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.lesson_plan
    ADD CONSTRAINT lesson_plan_pkey PRIMARY KEY (id);


--
-- TOC entry 4031 (class 2606 OID 46291)
-- Name: logs logs_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.logs
    ADD CONSTRAINT logs_pkey PRIMARY KEY (id);


--
-- TOC entry 4035 (class 2606 OID 46293)
-- Name: product product_entity_unique; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.product
    ADD CONSTRAINT product_entity_unique UNIQUE (product_type, entity_id);


--
-- TOC entry 4037 (class 2606 OID 46295)
-- Name: product product_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.product
    ADD CONSTRAINT product_pkey PRIMARY KEY (id);


--
-- TOC entry 4044 (class 2606 OID 46297)
-- Name: purchase purchase_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.purchase
    ADD CONSTRAINT purchase_pkey PRIMARY KEY (id);


--
-- TOC entry 4054 (class 2606 OID 46299)
-- Name: school school_institution_symbol_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.school
    ADD CONSTRAINT school_institution_symbol_key UNIQUE (institution_symbol);


--
-- TOC entry 4056 (class 2606 OID 46301)
-- Name: school school_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.school
    ADD CONSTRAINT school_pkey PRIMARY KEY (id);


--
-- TOC entry 4063 (class 2606 OID 46303)
-- Name: settings settings_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.settings
    ADD CONSTRAINT settings_pkey PRIMARY KEY (id);


--
-- TOC entry 4066 (class 2606 OID 46305)
-- Name: studentinvitation studentinvitation_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.studentinvitation
    ADD CONSTRAINT studentinvitation_pkey PRIMARY KEY (id);


--
-- TOC entry 4078 (class 2606 OID 46307)
-- Name: subscription subscription_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.subscription
    ADD CONSTRAINT subscription_pkey PRIMARY KEY (id);


--
-- TOC entry 4087 (class 2606 OID 46309)
-- Name: subscriptionhistory subscriptionhistory_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.subscriptionhistory
    ADD CONSTRAINT subscriptionhistory_pkey PRIMARY KEY (id);


--
-- TOC entry 4089 (class 2606 OID 46311)
-- Name: subscriptionplan subscriptionplan_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.subscriptionplan
    ADD CONSTRAINT subscriptionplan_pkey PRIMARY KEY (id);


--
-- TOC entry 4164 (class 2606 OID 46698)
-- Name: supportmessage supportmessage_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.supportmessage
    ADD CONSTRAINT supportmessage_pkey PRIMARY KEY (id);


--
-- TOC entry 4144 (class 2606 OID 46640)
-- Name: system_templates system_templates_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.system_templates
    ADD CONSTRAINT system_templates_pkey PRIMARY KEY (id);


--
-- TOC entry 4092 (class 2606 OID 46313)
-- Name: tool tool_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.tool
    ADD CONSTRAINT tool_pkey PRIMARY KEY (id);


--
-- TOC entry 4094 (class 2606 OID 46315)
-- Name: tool tool_tool_key_key; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.tool
    ADD CONSTRAINT tool_tool_key_key UNIQUE (tool_key);


--
-- TOC entry 4098 (class 2606 OID 46317)
-- Name: transaction transaction_final_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.transaction
    ADD CONSTRAINT transaction_final_pkey PRIMARY KEY (id);


--
-- TOC entry 4058 (class 2606 OID 46321)
-- Name: school unique_school_location; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.school
    ADD CONSTRAINT unique_school_location UNIQUE (name, city, address);


--
-- TOC entry 4109 (class 2606 OID 46323)
-- Name: user user_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public."user"
    ADD CONSTRAINT user_pkey PRIMARY KEY (id);


--
-- TOC entry 4118 (class 2606 OID 46325)
-- Name: webhook_log webhook_log_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.webhook_log
    ADD CONSTRAINT webhook_log_pkey PRIMARY KEY (id);


--
-- TOC entry 4125 (class 2606 OID 46327)
-- Name: workshop workshop_pkey; Type: CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.workshop
    ADD CONSTRAINT workshop_pkey PRIMARY KEY (id);


--
-- TOC entry 3981 (class 1259 OID 46330)
-- Name: curriculum_class_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX curriculum_class_id ON public.curriculum USING btree (class_id);


--
-- TOC entry 3982 (class 1259 OID 46331)
-- Name: curriculum_grade; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX curriculum_grade ON public.curriculum USING btree (grade);


--
-- TOC entry 3983 (class 1259 OID 46332)
-- Name: curriculum_is_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX curriculum_is_active ON public.curriculum USING btree (is_active);


--
-- TOC entry 3991 (class 1259 OID 46333)
-- Name: curriculum_item_content_topic; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX curriculum_item_content_topic ON public.curriculum_item USING btree (content_topic);


--
-- TOC entry 3992 (class 1259 OID 46334)
-- Name: curriculum_item_curriculum_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX curriculum_item_curriculum_id ON public.curriculum_item USING btree (curriculum_id);


--
-- TOC entry 3993 (class 1259 OID 46335)
-- Name: curriculum_item_curriculum_id_custom_order; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX curriculum_item_curriculum_id_custom_order ON public.curriculum_item USING btree (curriculum_id, custom_order);


--
-- TOC entry 3994 (class 1259 OID 46336)
-- Name: curriculum_item_curriculum_id_mandatory_order; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX curriculum_item_curriculum_id_mandatory_order ON public.curriculum_item USING btree (curriculum_id, mandatory_order);


--
-- TOC entry 3995 (class 1259 OID 46337)
-- Name: curriculum_item_custom_order; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX curriculum_item_custom_order ON public.curriculum_item USING btree (custom_order);


--
-- TOC entry 3996 (class 1259 OID 46338)
-- Name: curriculum_item_is_completed; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX curriculum_item_is_completed ON public.curriculum_item USING btree (is_completed);


--
-- TOC entry 3997 (class 1259 OID 46339)
-- Name: curriculum_item_is_mandatory; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX curriculum_item_is_mandatory ON public.curriculum_item USING btree (is_mandatory);


--
-- TOC entry 3998 (class 1259 OID 46340)
-- Name: curriculum_item_mandatory_order; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX curriculum_item_mandatory_order ON public.curriculum_item USING btree (mandatory_order);


--
-- TOC entry 4001 (class 1259 OID 46341)
-- Name: curriculum_item_study_topic; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX curriculum_item_study_topic ON public.curriculum_item USING btree (study_topic);


--
-- TOC entry 3984 (class 1259 OID 46342)
-- Name: curriculum_original_curriculum_id_idx; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX curriculum_original_curriculum_id_idx ON public.curriculum USING btree (original_curriculum_id);


--
-- TOC entry 4002 (class 1259 OID 46343)
-- Name: curriculum_product_curriculum_item_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX curriculum_product_curriculum_item_id ON public.curriculum_product USING btree (curriculum_item_id);


--
-- TOC entry 4005 (class 1259 OID 46344)
-- Name: curriculum_product_product_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX curriculum_product_product_id ON public.curriculum_product USING btree (product_id);


--
-- TOC entry 3987 (class 1259 OID 46345)
-- Name: curriculum_subject; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX curriculum_subject ON public.curriculum USING btree (subject);


--
-- TOC entry 3988 (class 1259 OID 46346)
-- Name: curriculum_subject_grade; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX curriculum_subject_grade ON public.curriculum USING btree (subject, grade);


--
-- TOC entry 3989 (class 1259 OID 46347)
-- Name: curriculum_teacher_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX curriculum_teacher_user_id ON public.curriculum USING btree (teacher_user_id);


--
-- TOC entry 3990 (class 1259 OID 46348)
-- Name: curriculum_teacher_user_id_class_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX curriculum_teacher_user_id_class_id ON public.curriculum USING btree (teacher_user_id, class_id);


--
-- TOC entry 4006 (class 1259 OID 46349)
-- Name: file_is_asset_only; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX file_is_asset_only ON public.file USING btree (is_asset_only);


--
-- TOC entry 4133 (class 1259 OID 46628)
-- Name: game_content_link_game_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX game_content_link_game_id ON public.game_content_link USING btree (game_id);


--
-- TOC entry 4134 (class 1259 OID 46629)
-- Name: game_content_link_link_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX game_content_link_link_type ON public.game_content_link USING btree (link_type);


--
-- TOC entry 4131 (class 1259 OID 46607)
-- Name: game_content_relation_items_content_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX game_content_relation_items_content_id ON public.game_content_relation_items USING btree (content_id);


--
-- TOC entry 4132 (class 1259 OID 46606)
-- Name: game_content_relation_items_relation_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX game_content_relation_items_relation_id ON public.game_content_relation_items USING btree (relation_id);


--
-- TOC entry 4130 (class 1259 OID 46605)
-- Name: game_content_relation_relation_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX game_content_relation_relation_type ON public.game_content_relation USING btree (relation_type);


--
-- TOC entry 3954 (class 1259 OID 46523)
-- Name: idx_audiofile_file_filename; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audiofile_file_filename ON public.audiofile USING btree (file_filename);


--
-- TOC entry 3955 (class 1259 OID 46522)
-- Name: idx_audiofile_has_file; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_audiofile_has_file ON public.audiofile USING btree (has_file);


--
-- TOC entry 3960 (class 1259 OID 46350)
-- Name: idx_classroom_school_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_classroom_school_id ON public.classroom USING btree (school_id);


--
-- TOC entry 3961 (class 1259 OID 46351)
-- Name: idx_classroom_school_teacher; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_classroom_school_teacher ON public.classroom USING btree (school_id, teacher_id);


--
-- TOC entry 3962 (class 1259 OID 46352)
-- Name: idx_classroom_teacher_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_classroom_teacher_active ON public.classroom USING btree (teacher_id, is_active);


--
-- TOC entry 3963 (class 1259 OID 46353)
-- Name: idx_classroom_teacher_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_classroom_teacher_id ON public.classroom USING btree (teacher_id);


--
-- TOC entry 3966 (class 1259 OID 46354)
-- Name: idx_classroommembership_classroom_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_classroommembership_classroom_id ON public.classroommembership USING btree (classroom_id);


--
-- TOC entry 3967 (class 1259 OID 46355)
-- Name: idx_classroommembership_student_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_classroommembership_student_user_id ON public.classroommembership USING btree (student_user_id);


--
-- TOC entry 3970 (class 1259 OID 46356)
-- Name: idx_coupon_active_visibility; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_coupon_active_visibility ON public.coupon USING btree (is_active, visibility);


--
-- TOC entry 3971 (class 1259 OID 46357)
-- Name: idx_coupon_priority_level; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_coupon_priority_level ON public.coupon USING btree (priority_level);


--
-- TOC entry 3972 (class 1259 OID 46358)
-- Name: idx_coupon_targeting_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_coupon_targeting_type ON public.coupon USING btree (targeting_type);


--
-- TOC entry 3973 (class 1259 OID 46359)
-- Name: idx_coupon_valid_until; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_coupon_valid_until ON public.coupon USING btree (valid_until);


--
-- TOC entry 3974 (class 1259 OID 46360)
-- Name: idx_coupon_visibility; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_coupon_visibility ON public.coupon USING btree (visibility);


--
-- TOC entry 3977 (class 1259 OID 46361)
-- Name: idx_course_category; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_course_category ON public.course USING btree (category);


--
-- TOC entry 3978 (class 1259 OID 46515)
-- Name: idx_course_has_video; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_course_has_video ON public.course USING btree (has_video);


--
-- TOC entry 3979 (class 1259 OID 46362)
-- Name: idx_course_is_published; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_course_is_published ON public.course USING btree (is_published);


--
-- TOC entry 3980 (class 1259 OID 46516)
-- Name: idx_course_video_filename; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_course_video_filename ON public.course USING btree (video_filename);


--
-- TOC entry 4153 (class 1259 OID 46680)
-- Name: idx_emaillog_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_emaillog_created_at ON public.emaillog USING btree (created_at);


--
-- TOC entry 4154 (class 1259 OID 46675)
-- Name: idx_emaillog_recipient_email; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_emaillog_recipient_email ON public.emaillog USING btree (recipient_email);


--
-- TOC entry 4155 (class 1259 OID 46679)
-- Name: idx_emaillog_related_purchase_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_emaillog_related_purchase_id ON public.emaillog USING btree (related_purchase_id);


--
-- TOC entry 4156 (class 1259 OID 46677)
-- Name: idx_emaillog_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_emaillog_status ON public.emaillog USING btree (status);


--
-- TOC entry 4157 (class 1259 OID 46676)
-- Name: idx_emaillog_template_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_emaillog_template_id ON public.emaillog USING btree (template_id);


--
-- TOC entry 4158 (class 1259 OID 46678)
-- Name: idx_emaillog_trigger_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_emaillog_trigger_type ON public.emaillog USING btree (trigger_type);


--
-- TOC entry 4147 (class 1259 OID 46665)
-- Name: idx_emailtemplate_is_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_emailtemplate_is_active ON public.emailtemplate USING btree (is_active);


--
-- TOC entry 4148 (class 1259 OID 46667)
-- Name: idx_emailtemplate_send_to_admins; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_emailtemplate_send_to_admins ON public.emailtemplate USING btree (send_to_admins);


--
-- TOC entry 4149 (class 1259 OID 46666)
-- Name: idx_emailtemplate_trigger_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_emailtemplate_trigger_active ON public.emailtemplate USING btree (trigger_type, is_active);


--
-- TOC entry 4150 (class 1259 OID 46664)
-- Name: idx_emailtemplate_trigger_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_emailtemplate_trigger_type ON public.emailtemplate USING btree (trigger_type);


--
-- TOC entry 4009 (class 1259 OID 46649)
-- Name: idx_file_accessible_pages; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_file_accessible_pages ON public.file USING btree (accessible_pages);


--
-- TOC entry 4010 (class 1259 OID 46363)
-- Name: idx_file_category; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_file_category ON public.file USING btree (category);


--
-- TOC entry 4011 (class 1259 OID 46526)
-- Name: idx_file_footer_overrides; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_file_footer_overrides ON public.file USING btree (footer_overrides);


--
-- TOC entry 4012 (class 1259 OID 46646)
-- Name: idx_file_footer_template_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_file_footer_template_id ON public.file USING btree (footer_template_id);


--
-- TOC entry 4013 (class 1259 OID 46650)
-- Name: idx_file_watermark_template_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_file_watermark_template_id ON public.file USING btree (watermark_template_id);


--
-- TOC entry 4016 (class 1259 OID 46364)
-- Name: idx_game_creator_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_game_creator_user_id ON public.game USING btree (creator_user_id);


--
-- TOC entry 4017 (class 1259 OID 46365)
-- Name: idx_game_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_game_type ON public.game USING btree (game_type);


--
-- TOC entry 4018 (class 1259 OID 46652)
-- Name: idx_lesson_plan_accessible_slides; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_lesson_plan_accessible_slides ON public.lesson_plan USING btree (accessible_slides);


--
-- TOC entry 4019 (class 1259 OID 46653)
-- Name: idx_lesson_plan_allow_slide_preview; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_lesson_plan_allow_slide_preview ON public.lesson_plan USING btree (allow_slide_preview);


--
-- TOC entry 4020 (class 1259 OID 46366)
-- Name: idx_lesson_plan_file_configs_gin; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_lesson_plan_file_configs_gin ON public.lesson_plan USING gin (file_configs);


--
-- TOC entry 4021 (class 1259 OID 46654)
-- Name: idx_lesson_plan_watermark_template_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_lesson_plan_watermark_template_id ON public.lesson_plan USING btree (watermark_template_id);


--
-- TOC entry 4026 (class 1259 OID 46367)
-- Name: idx_logs_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_logs_created_at ON public.logs USING btree (created_at);


--
-- TOC entry 4027 (class 1259 OID 46368)
-- Name: idx_logs_log_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_logs_log_type ON public.logs USING btree (log_type);


--
-- TOC entry 4028 (class 1259 OID 46369)
-- Name: idx_logs_source_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_logs_source_type ON public.logs USING btree (source_type);


--
-- TOC entry 4029 (class 1259 OID 46370)
-- Name: idx_logs_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_logs_user_id ON public.logs USING btree (user_id);


--
-- TOC entry 4032 (class 1259 OID 46509)
-- Name: idx_product_has_image; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_product_has_image ON public.product USING btree (has_image);


--
-- TOC entry 4033 (class 1259 OID 46510)
-- Name: idx_product_image_filename; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_product_image_filename ON public.product USING btree (image_filename);


--
-- TOC entry 4038 (class 1259 OID 46371)
-- Name: idx_purchase_access_expires; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_purchase_access_expires ON public.purchase USING btree (access_expires_at);


--
-- TOC entry 4039 (class 1259 OID 46372)
-- Name: idx_purchase_buyer_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_purchase_buyer_user_id ON public.purchase USING btree (buyer_user_id);


--
-- TOC entry 4040 (class 1259 OID 46373)
-- Name: idx_purchase_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_purchase_created_at ON public.purchase USING btree (created_at);


--
-- TOC entry 4041 (class 1259 OID 46374)
-- Name: idx_purchase_payment_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_purchase_payment_status ON public.purchase USING btree (payment_status);


--
-- TOC entry 4042 (class 1259 OID 46375)
-- Name: idx_purchase_polymorphic; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_purchase_polymorphic ON public.purchase USING btree (purchasable_type, purchasable_id);


--
-- TOC entry 4045 (class 1259 OID 46376)
-- Name: idx_school_city; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_school_city ON public.school USING btree (city);


--
-- TOC entry 4046 (class 1259 OID 46377)
-- Name: idx_school_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_school_created_at ON public.school USING btree (created_at);


--
-- TOC entry 4047 (class 1259 OID 46378)
-- Name: idx_school_district; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_school_district ON public.school USING btree (district);


--
-- TOC entry 4048 (class 1259 OID 46379)
-- Name: idx_school_edu_system_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_school_edu_system_id ON public.school USING btree (edu_system_id);


--
-- TOC entry 4049 (class 1259 OID 46520)
-- Name: idx_school_has_logo; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_school_has_logo ON public.school USING btree (has_logo);


--
-- TOC entry 4050 (class 1259 OID 46380)
-- Name: idx_school_headmaster_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_school_headmaster_id ON public.school USING btree (school_headmaster_id);


--
-- TOC entry 4051 (class 1259 OID 46381)
-- Name: idx_school_institution_symbol; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX idx_school_institution_symbol ON public.school USING btree (institution_symbol);


--
-- TOC entry 4052 (class 1259 OID 46521)
-- Name: idx_school_logo_filename; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_school_logo_filename ON public.school USING btree (logo_filename);


--
-- TOC entry 4059 (class 1259 OID 46524)
-- Name: idx_settings_has_logo; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_settings_has_logo ON public.settings USING btree (has_logo);


--
-- TOC entry 4060 (class 1259 OID 46525)
-- Name: idx_settings_logo_filename; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_settings_logo_filename ON public.settings USING btree (logo_filename);


--
-- TOC entry 4070 (class 1259 OID 46382)
-- Name: idx_subscription_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_subscription_created_at ON public.subscription USING btree (created_at);


--
-- TOC entry 4071 (class 1259 OID 46383)
-- Name: idx_subscription_next_billing; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_subscription_next_billing ON public.subscription USING btree (next_billing_date);


--
-- TOC entry 4072 (class 1259 OID 46384)
-- Name: idx_subscription_original_price; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_subscription_original_price ON public.subscription USING btree (original_price);


--
-- TOC entry 4073 (class 1259 OID 46385)
-- Name: idx_subscription_payplus_uid; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_subscription_payplus_uid ON public.subscription USING btree (payplus_subscription_uid);


--
-- TOC entry 4074 (class 1259 OID 46386)
-- Name: idx_subscription_plan_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_subscription_plan_id ON public.subscription USING btree (subscription_plan_id);


--
-- TOC entry 4075 (class 1259 OID 46387)
-- Name: idx_subscription_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_subscription_status ON public.subscription USING btree (status);


--
-- TOC entry 4076 (class 1259 OID 46388)
-- Name: idx_subscription_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_subscription_user_id ON public.subscription USING btree (user_id);


--
-- TOC entry 4079 (class 1259 OID 46389)
-- Name: idx_subscriptionhistory_action_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_subscriptionhistory_action_type ON public.subscriptionhistory USING btree (action_type);


--
-- TOC entry 4080 (class 1259 OID 46390)
-- Name: idx_subscriptionhistory_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_subscriptionhistory_created_at ON public.subscriptionhistory USING btree (created_at);


--
-- TOC entry 4081 (class 1259 OID 46391)
-- Name: idx_subscriptionhistory_payplus_uid; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_subscriptionhistory_payplus_uid ON public.subscriptionhistory USING btree (payplus_subscription_uid);


--
-- TOC entry 4082 (class 1259 OID 46392)
-- Name: idx_subscriptionhistory_plan_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_subscriptionhistory_plan_id ON public.subscriptionhistory USING btree (subscription_plan_id);


--
-- TOC entry 4083 (class 1259 OID 46393)
-- Name: idx_subscriptionhistory_subscription_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_subscriptionhistory_subscription_id ON public.subscriptionhistory USING btree (subscription_id);


--
-- TOC entry 4084 (class 1259 OID 46394)
-- Name: idx_subscriptionhistory_user_date; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_subscriptionhistory_user_date ON public.subscriptionhistory USING btree (user_id, created_at);


--
-- TOC entry 4085 (class 1259 OID 46395)
-- Name: idx_subscriptionhistory_user_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_subscriptionhistory_user_id ON public.subscriptionhistory USING btree (user_id);


--
-- TOC entry 4159 (class 1259 OID 46701)
-- Name: idx_supportmessage_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_supportmessage_created_at ON public.supportmessage USING btree (created_at);


--
-- TOC entry 4160 (class 1259 OID 46699)
-- Name: idx_supportmessage_email; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_supportmessage_email ON public.supportmessage USING btree (email);


--
-- TOC entry 4161 (class 1259 OID 46700)
-- Name: idx_supportmessage_is_read; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_supportmessage_is_read ON public.supportmessage USING btree (is_read);


--
-- TOC entry 4162 (class 1259 OID 46702)
-- Name: idx_supportmessage_read_created; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_supportmessage_read_created ON public.supportmessage USING btree (is_read, created_at);


--
-- TOC entry 4137 (class 1259 OID 46642)
-- Name: idx_system_templates_category; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_system_templates_category ON public.system_templates USING btree (category);


--
-- TOC entry 4138 (class 1259 OID 46645)
-- Name: idx_system_templates_created_by; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_system_templates_created_by ON public.system_templates USING btree (created_by);


--
-- TOC entry 4139 (class 1259 OID 46643)
-- Name: idx_system_templates_default; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_system_templates_default ON public.system_templates USING btree (is_default);


--
-- TOC entry 4140 (class 1259 OID 46648)
-- Name: idx_system_templates_file_types; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_system_templates_file_types ON public.system_templates USING btree (target_file_types);


--
-- TOC entry 4141 (class 1259 OID 46641)
-- Name: idx_system_templates_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_system_templates_type ON public.system_templates USING btree (template_type);


--
-- TOC entry 4142 (class 1259 OID 46644)
-- Name: idx_system_templates_type_default; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_system_templates_type_default ON public.system_templates USING btree (template_type, is_default);


--
-- TOC entry 4096 (class 1259 OID 46396)
-- Name: idx_transaction_page_request_uid; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_transaction_page_request_uid ON public.transaction USING btree (page_request_uid);


--
-- TOC entry 4099 (class 1259 OID 46397)
-- Name: idx_user_email; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_email ON public."user" USING btree (email);


--
-- TOC entry 4100 (class 1259 OID 46398)
-- Name: idx_user_is_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_is_active ON public."user" USING btree (is_active);


--
-- TOC entry 4101 (class 1259 OID 46399)
-- Name: idx_user_role; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_role ON public."user" USING btree (role);


--
-- TOC entry 4102 (class 1259 OID 46400)
-- Name: idx_user_school_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_school_id ON public."user" USING btree (school_id);


--
-- TOC entry 4103 (class 1259 OID 46401)
-- Name: idx_user_school_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_school_type ON public."user" USING btree (school_id, user_type);


--
-- TOC entry 4104 (class 1259 OID 46402)
-- Name: idx_user_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_user_type ON public."user" USING btree (user_type);


--
-- TOC entry 4110 (class 1259 OID 46403)
-- Name: idx_webhook_log_created_at; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_webhook_log_created_at ON public.webhook_log USING btree (created_at);


--
-- TOC entry 4111 (class 1259 OID 46404)
-- Name: idx_webhook_log_page_request_uid; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_webhook_log_page_request_uid ON public.webhook_log USING btree (page_request_uid);


--
-- TOC entry 4112 (class 1259 OID 46405)
-- Name: idx_webhook_log_payplus_transaction_uid; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_webhook_log_payplus_transaction_uid ON public.webhook_log USING btree (payplus_transaction_uid);


--
-- TOC entry 4113 (class 1259 OID 46406)
-- Name: idx_webhook_log_provider; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_webhook_log_provider ON public.webhook_log USING btree (provider);


--
-- TOC entry 4114 (class 1259 OID 46407)
-- Name: idx_webhook_log_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_webhook_log_status ON public.webhook_log USING btree (status);


--
-- TOC entry 4115 (class 1259 OID 46408)
-- Name: idx_webhook_log_subscription_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_webhook_log_subscription_id ON public.webhook_log USING btree (subscription_id);


--
-- TOC entry 4116 (class 1259 OID 46409)
-- Name: idx_webhook_log_transaction_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_webhook_log_transaction_id ON public.webhook_log USING btree (transaction_id);


--
-- TOC entry 4119 (class 1259 OID 46410)
-- Name: idx_workshop_category; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_workshop_category ON public.workshop USING btree (category);


--
-- TOC entry 4120 (class 1259 OID 46513)
-- Name: idx_workshop_has_video; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_workshop_has_video ON public.workshop USING btree (has_video);


--
-- TOC entry 4121 (class 1259 OID 46411)
-- Name: idx_workshop_is_published; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_workshop_is_published ON public.workshop USING btree (is_published);


--
-- TOC entry 4122 (class 1259 OID 46412)
-- Name: idx_workshop_type; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_workshop_type ON public.workshop USING btree (workshop_type);


--
-- TOC entry 4123 (class 1259 OID 46514)
-- Name: idx_workshop_video_filename; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX idx_workshop_video_filename ON public.workshop USING btree (video_filename);


--
-- TOC entry 4022 (class 1259 OID 46413)
-- Name: lesson_plan_context; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX lesson_plan_context ON public.lesson_plan USING btree (context);


--
-- TOC entry 4023 (class 1259 OID 46414)
-- Name: lesson_plan_is_active; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX lesson_plan_is_active ON public.lesson_plan USING btree (is_active);


--
-- TOC entry 4061 (class 1259 OID 46415)
-- Name: settings_available_dashboard_widgets_index; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX settings_available_dashboard_widgets_index ON public.settings USING gin (available_dashboard_widgets);


--
-- TOC entry 4064 (class 1259 OID 46416)
-- Name: studentinvitation_classroom_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX studentinvitation_classroom_id ON public.studentinvitation USING btree (classroom_id);


--
-- TOC entry 4067 (class 1259 OID 46417)
-- Name: studentinvitation_status; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX studentinvitation_status ON public.studentinvitation USING btree (status);


--
-- TOC entry 4068 (class 1259 OID 46418)
-- Name: studentinvitation_student_email; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX studentinvitation_student_email ON public.studentinvitation USING btree (student_email);


--
-- TOC entry 4069 (class 1259 OID 46419)
-- Name: studentinvitation_teacher_id; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX studentinvitation_teacher_id ON public.studentinvitation USING btree (teacher_id);


--
-- TOC entry 4090 (class 1259 OID 46420)
-- Name: tool_category_idx; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX tool_category_idx ON public.tool USING btree (category);


--
-- TOC entry 4095 (class 1259 OID 46421)
-- Name: tool_tool_key_unique; Type: INDEX; Schema: public; Owner: -
--

CREATE UNIQUE INDEX tool_tool_key_unique ON public.tool USING btree (tool_key);


--
-- TOC entry 4105 (class 1259 OID 46422)
-- Name: user_birth_date_idx; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX user_birth_date_idx ON public."user" USING btree (birth_date);


--
-- TOC entry 4106 (class 1259 OID 46423)
-- Name: user_dashboard_settings_index; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX user_dashboard_settings_index ON public."user" USING gin (dashboard_settings);


--
-- TOC entry 4107 (class 1259 OID 46424)
-- Name: user_onboarding_completed_index; Type: INDEX; Schema: public; Owner: -
--

CREATE INDEX user_onboarding_completed_index ON public."user" USING btree (onboarding_completed);


--
-- TOC entry 4165 (class 2606 OID 46425)
-- Name: classroom classroom_school_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.classroom
    ADD CONSTRAINT classroom_school_id_fkey FOREIGN KEY (school_id) REFERENCES public.school(id);


--
-- TOC entry 4166 (class 2606 OID 46430)
-- Name: curriculum curriculum_class_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.curriculum
    ADD CONSTRAINT curriculum_class_id_fkey FOREIGN KEY (class_id) REFERENCES public.classroom(id) ON UPDATE CASCADE ON DELETE CASCADE;


--
-- TOC entry 4169 (class 2606 OID 46435)
-- Name: curriculum_item curriculum_item_curriculum_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.curriculum_item
    ADD CONSTRAINT curriculum_item_curriculum_id_fkey FOREIGN KEY (curriculum_id) REFERENCES public.curriculum(id) ON UPDATE CASCADE ON DELETE CASCADE;


--
-- TOC entry 4167 (class 2606 OID 46440)
-- Name: curriculum curriculum_original_curriculum_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.curriculum
    ADD CONSTRAINT curriculum_original_curriculum_id_fkey FOREIGN KEY (original_curriculum_id) REFERENCES public.curriculum(id);


--
-- TOC entry 4170 (class 2606 OID 46445)
-- Name: curriculum_product curriculum_product_curriculum_item_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.curriculum_product
    ADD CONSTRAINT curriculum_product_curriculum_item_id_fkey FOREIGN KEY (curriculum_item_id) REFERENCES public.curriculum_item(id) ON UPDATE CASCADE ON DELETE CASCADE;


--
-- TOC entry 4171 (class 2606 OID 46450)
-- Name: curriculum_product curriculum_product_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.curriculum_product
    ADD CONSTRAINT curriculum_product_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.product(id) ON UPDATE CASCADE ON DELETE CASCADE;


--
-- TOC entry 4168 (class 2606 OID 46455)
-- Name: curriculum curriculum_teacher_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.curriculum
    ADD CONSTRAINT curriculum_teacher_user_id_fkey FOREIGN KEY (teacher_user_id) REFERENCES public."user"(id) ON UPDATE CASCADE ON DELETE SET NULL;


--
-- TOC entry 4184 (class 2606 OID 46686)
-- Name: emaillog fk_emaillog_purchase; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.emaillog
    ADD CONSTRAINT fk_emaillog_purchase FOREIGN KEY (related_purchase_id) REFERENCES public.purchase(id) ON UPDATE CASCADE ON DELETE SET NULL;


--
-- TOC entry 4185 (class 2606 OID 46681)
-- Name: emaillog fk_emaillog_template; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.emaillog
    ADD CONSTRAINT fk_emaillog_template FOREIGN KEY (template_id) REFERENCES public.emailtemplate(id) ON UPDATE CASCADE ON DELETE SET NULL;


--
-- TOC entry 4183 (class 2606 OID 46623)
-- Name: game_content_link game_content_link_game_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.game_content_link
    ADD CONSTRAINT game_content_link_game_id_fkey FOREIGN KEY (game_id) REFERENCES public.game(id) ON DELETE CASCADE;


--
-- TOC entry 4181 (class 2606 OID 46600)
-- Name: game_content_relation_items game_content_relation_items_content_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.game_content_relation_items
    ADD CONSTRAINT game_content_relation_items_content_id_fkey FOREIGN KEY (content_id) REFERENCES public.gamecontent(id) ON DELETE CASCADE;


--
-- TOC entry 4182 (class 2606 OID 46595)
-- Name: game_content_relation_items game_content_relation_items_relation_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.game_content_relation_items
    ADD CONSTRAINT game_content_relation_items_relation_id_fkey FOREIGN KEY (relation_id) REFERENCES public.game_content_relation(id) ON DELETE CASCADE;


--
-- TOC entry 4172 (class 2606 OID 46460)
-- Name: game game_creator_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.game
    ADD CONSTRAINT game_creator_user_id_fkey FOREIGN KEY (creator_user_id) REFERENCES public."user"(id) ON UPDATE CASCADE ON DELETE SET NULL;


--
-- TOC entry 4173 (class 2606 OID 46465)
-- Name: purchase purchase_buyer_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.purchase
    ADD CONSTRAINT purchase_buyer_user_id_fkey FOREIGN KEY (buyer_user_id) REFERENCES public."user"(id);


--
-- TOC entry 4174 (class 2606 OID 46470)
-- Name: school school_school_headmaster_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.school
    ADD CONSTRAINT school_school_headmaster_id_fkey FOREIGN KEY (school_headmaster_id) REFERENCES public."user"(id);


--
-- TOC entry 4175 (class 2606 OID 46475)
-- Name: subscription subscription_subscription_plan_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.subscription
    ADD CONSTRAINT subscription_subscription_plan_id_fkey FOREIGN KEY (subscription_plan_id) REFERENCES public.subscriptionplan(id);


--
-- TOC entry 4176 (class 2606 OID 46480)
-- Name: subscription subscription_transaction_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.subscription
    ADD CONSTRAINT subscription_transaction_id_fkey FOREIGN KEY (transaction_id) REFERENCES public.transaction(id);


--
-- TOC entry 4177 (class 2606 OID 46485)
-- Name: subscription subscription_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.subscription
    ADD CONSTRAINT subscription_user_id_fkey FOREIGN KEY (user_id) REFERENCES public."user"(id);


--
-- TOC entry 4178 (class 2606 OID 46490)
-- Name: user user_school_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public."user"
    ADD CONSTRAINT user_school_id_fkey FOREIGN KEY (school_id) REFERENCES public.school(id);


--
-- TOC entry 4179 (class 2606 OID 46495)
-- Name: webhook_log webhook_log_subscription_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.webhook_log
    ADD CONSTRAINT webhook_log_subscription_id_fkey FOREIGN KEY (subscription_id) REFERENCES public.subscription(id) ON UPDATE CASCADE ON DELETE SET NULL;


--
-- TOC entry 4180 (class 2606 OID 46500)
-- Name: webhook_log webhook_log_transaction_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: -
--

ALTER TABLE ONLY public.webhook_log
    ADD CONSTRAINT webhook_log_transaction_id_fkey FOREIGN KEY (transaction_id) REFERENCES public.transaction(id) ON UPDATE CASCADE ON DELETE SET NULL;


-- Completed on 2025-11-07 16:16:04 +07

--
-- PostgreSQL database dump complete
--

\unrestrict T0tb3aB8XldOiWOp8PQIRozjrRnrXGhOXFG7ZCLhhicgJXCz6qGiafhnkVBh9ZF

